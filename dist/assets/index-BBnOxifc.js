var ln=Object.defineProperty;var un=(w,D,T)=>D in w?ln(w,D,{enumerable:!0,configurable:!0,writable:!0,value:T}):w[D]=T;var E=(w,D,T)=>un(w,typeof D!="symbol"?D+"":D,T);(function(){const D=document.createElement("link").relList;if(D&&D.supports&&D.supports("modulepreload"))return;for(const P of document.querySelectorAll('link[rel="modulepreload"]'))c(P);new MutationObserver(P=>{for(const R of P)if(R.type==="childList")for(const f of R.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&c(f)}).observe(document,{childList:!0,subtree:!0});function T(P){const R={};return P.integrity&&(R.integrity=P.integrity),P.referrerPolicy&&(R.referrerPolicy=P.referrerPolicy),P.crossOrigin==="use-credentials"?R.credentials="include":P.crossOrigin==="anonymous"?R.credentials="omit":R.credentials="same-origin",R}function c(P){if(P.ep)return;P.ep=!0;const R=T(P);fetch(P.href,R)}})();var ns=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Fr={},gr={exports:{}},Ar,as;function fn(){if(as)return Ar;as=1;var w=1e3,D=w*60,T=D*60,c=T*24,P=c*7,R=c*365.25;Ar=function(h,n){n=n||{};var y=typeof h;if(y==="string"&&h.length>0)return f(h);if(y==="number"&&isFinite(h))return n.long?C(h):_(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))};function f(h){if(h=String(h),!(h.length>100)){var n=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(h);if(n){var y=parseFloat(n[1]),u=(n[2]||"ms").toLowerCase();switch(u){case"years":case"year":case"yrs":case"yr":case"y":return y*R;case"weeks":case"week":case"w":return y*P;case"days":case"day":case"d":return y*c;case"hours":case"hour":case"hrs":case"hr":case"h":return y*T;case"minutes":case"minute":case"mins":case"min":case"m":return y*D;case"seconds":case"second":case"secs":case"sec":case"s":return y*w;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return y;default:return}}}}function _(h){var n=Math.abs(h);return n>=c?Math.round(h/c)+"d":n>=T?Math.round(h/T)+"h":n>=D?Math.round(h/D)+"m":n>=w?Math.round(h/w)+"s":h+"ms"}function C(h){var n=Math.abs(h);return n>=c?g(h,n,c,"day"):n>=T?g(h,n,T,"hour"):n>=D?g(h,n,D,"minute"):n>=w?g(h,n,w,"second"):h+" ms"}function g(h,n,y,u){var v=n>=y*1.5;return Math.round(h/y)+" "+u+(v?"s":"")}return Ar}var Nr,os;function hn(){if(os)return Nr;os=1;function w(D){c.debug=c,c.default=c,c.coerce=g,c.disable=_,c.enable=R,c.enabled=C,c.humanize=fn(),c.destroy=h,Object.keys(D).forEach(n=>{c[n]=D[n]}),c.names=[],c.skips=[],c.formatters={};function T(n){let y=0;for(let u=0;u<n.length;u++)y=(y<<5)-y+n.charCodeAt(u),y|=0;return c.colors[Math.abs(y)%c.colors.length]}c.selectColor=T;function c(n){let y,u=null,v,a;function s(...e){if(!s.enabled)return;const r=s,t=Number(new Date),i=t-(y||t);r.diff=i,r.prev=y,r.curr=t,y=t,e[0]=c.coerce(e[0]),typeof e[0]!="string"&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(p,m)=>{if(p==="%%")return"%";o++;const l=c.formatters[m];if(typeof l=="function"){const b=e[o];p=l.call(r,b),e.splice(o,1),o--}return p}),c.formatArgs.call(r,e),(r.log||c.log).apply(r,e)}return s.namespace=n,s.useColors=c.useColors(),s.color=c.selectColor(n),s.extend=P,s.destroy=c.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(v!==c.namespaces&&(v=c.namespaces,a=c.enabled(n)),a),set:e=>{u=e}}),typeof c.init=="function"&&c.init(s),s}function P(n,y){const u=c(this.namespace+(typeof y>"u"?":":y)+n);return u.log=this.log,u}function R(n){c.save(n),c.namespaces=n,c.names=[],c.skips=[];const y=(typeof n=="string"?n:"").trim().replace(" ",",").split(",").filter(Boolean);for(const u of y)u[0]==="-"?c.skips.push(u.slice(1)):c.names.push(u)}function f(n,y){let u=0,v=0,a=-1,s=0;for(;u<n.length;)if(v<y.length&&(y[v]===n[u]||y[v]==="*"))y[v]==="*"?(a=v,s=u,v++):(u++,v++);else if(a!==-1)v=a+1,s++,u=s;else return!1;for(;v<y.length&&y[v]==="*";)v++;return v===y.length}function _(){const n=[...c.names,...c.skips.map(y=>"-"+y)].join(",");return c.enable(""),n}function C(n){for(const y of c.skips)if(f(n,y))return!1;for(const y of c.names)if(f(n,y))return!0;return!1}function g(n){return n instanceof Error?n.stack||n.message:n}function h(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return c.enable(c.load()),c}return Nr=w,Nr}var cs;function xi(){return cs||(cs=1,function(w,D){var T={};D.formatArgs=P,D.save=R,D.load=f,D.useColors=c,D.storage=_(),D.destroy=(()=>{let g=!1;return()=>{g||(g=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),D.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function c(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let g;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(g=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(g[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function P(g){if(g[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+g[0]+(this.useColors?"%c ":" ")+"+"+w.exports.humanize(this.diff),!this.useColors)return;const h="color: "+this.color;g.splice(1,0,h,"color: inherit");let n=0,y=0;g[0].replace(/%[a-zA-Z%]/g,u=>{u!=="%%"&&(n++,u==="%c"&&(y=n))}),g.splice(y,0,h)}D.log=console.debug||console.log||(()=>{});function R(g){try{g?D.storage.setItem("debug",g):D.storage.removeItem("debug")}catch{}}function f(){let g;try{g=D.storage.getItem("debug")}catch{}return!g&&typeof process<"u"&&"env"in process&&(g=T.DEBUG),g}function _(){try{return localStorage}catch{}}w.exports=hn()(D);const{formatters:C}=w.exports;C.j=function(g){try{return JSON.stringify(g)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}}(gr,gr.exports)),gr.exports}var Ve={},nt={},ir={exports:{}},mn=ir.exports,ds;function gn(){return ds||(ds=1,function(w,D){(function(T,c){var P="2.0.3",R=500,f="user-agent",_="",C="?",g="function",h="undefined",n="object",y="string",u="browser",v="cpu",a="device",s="engine",e="os",r="result",t="name",i="type",o="vendor",d="version",p="architecture",m="major",l="model",b="console",k="mobile",L="tablet",S="smarttv",x="wearable",F="xr",I="embedded",N="inapp",V="brands",Q="formFactors",we="fullVersionList",oe="platform",ee="platformVersion",me="bitness",de="sec-ch-ua",$e=de+"-full-version-list",Le=de+"-arch",Ue=de+"-"+me,xe=de+"-form-factors",Er=de+"-"+k,ar=de+"-"+l,ct=de+"-"+oe,dt=ct+"-version",pt=[V,we,k,l,oe,ee,p,Q,me],Xe="Amazon",Re="Apple",Ce="ASUS",lt="BlackBerry",pe="Google",or="Huawei",cr="Lenovo",ut="Honor",Je="LG",ze="Microsoft",Ze="Motorola",et="Nvidia",dr="OnePlus",ft="OPPO",He="Samsung",pr="Sharp",Ie="Sony",O="Xiaomi",M="Zebra",A="Chrome",B="Chromium",U="Chromecast",te="Edge",ie="Firefox",Z="Opera",le="Facebook",Me="Sogou",Oe="Mobile ",Te=" Browser",tt="Windows",Jr=typeof T!==h,ue=Jr&&T.navigator?T.navigator:c,Fe=ue&&ue.userAgentData?ue.userAgentData:c,on=function(j,q){var $={},G=q;if(!ur(q)){G={};for(var H in q)for(var Y in q[H])G[Y]=q[H][Y].concat(G[Y]?G[Y]:[])}for(var z in j)$[z]=G[z]&&G[z].length%2===0?G[z].concat(j[z]):j[z];return $},lr=function(j){for(var q={},$=0;$<j.length;$++)q[j[$].toUpperCase()]=j[$];return q},kr=function(j,q){if(typeof j===n&&j.length>0){for(var $ in j)if(De(j[$])==De(q))return!0;return!1}return rt(j)?De(q).indexOf(De(j))!==-1:!1},ur=function(j,q){for(var $ in j)return/^(browser|cpu|device|engine|os)$/.test($)||(q?ur(j[$]):!1)},rt=function(j){return typeof j===y},Lr=function(j){if(!j)return c;for(var q=[],$=st(/\\?\"/g,j).split(","),G=0;G<$.length;G++)if($[G].indexOf(";")>-1){var H=mt($[G]).split(";v=");q[G]={brand:H[0],version:H[1]}}else q[G]=mt($[G]);return q},De=function(j){return rt(j)?j.toLowerCase():j},xr=function(j){return rt(j)?st(/[^\d\.]/g,j).split(".")[0]:c},Pe=function(j){for(var q in j){var $=j[q];typeof $==n&&$.length==2?this[$[0]]=$[1]:this[$]=c}return this},st=function(j,q){return rt(q)?q.replace(j,_):q},ht=function(j){return st(/\\?\"/g,j)},mt=function(j,q){if(rt(j))return j=st(/^\s\s*/,j),typeof q===h?j:j.substring(0,R)},Ir=function(j,q){if(!(!j||!q))for(var $=0,G,H,Y,z,W,K;$<q.length&&!W;){var X=q[$],Ee=q[$+1];for(G=H=0;G<X.length&&!W&&X[G];)if(W=X[G++].exec(j),W)for(Y=0;Y<Ee.length;Y++)K=W[++H],z=Ee[Y],typeof z===n&&z.length>0?z.length===2?typeof z[1]==g?this[z[0]]=z[1].call(this,K):this[z[0]]=z[1]:z.length===3?typeof z[1]===g&&!(z[1].exec&&z[1].test)?this[z[0]]=K?z[1].call(this,K,z[2]):c:this[z[0]]=K?K.replace(z[1],z[2]):c:z.length===4&&(this[z[0]]=K?z[3].call(this,K.replace(z[1],z[2])):c):this[z]=K||c;$+=2}},Ae=function(j,q){for(var $ in q)if(typeof q[$]===n&&q[$].length>0){for(var G=0;G<q[$].length;G++)if(kr(q[$][G],j))return $===C?c:$}else if(kr(q[$],j))return $===C?c:$;return q.hasOwnProperty("*")?q["*"]:j},Zr={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},es={embedded:"Automotive",mobile:"Mobile",tablet:["Tablet","EInk"],smarttv:"TV",wearable:"Watch",xr:["VR","XR"],"?":["Desktop","Unknown"],"*":c},ts={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[d,[t,Oe+"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[d,[t,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[t,d],[/opios[\/ ]+([\w\.]+)/i],[d,[t,Z+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[d,[t,Z+" GX"]],[/\bopr\/([\w\.]+)/i],[d,[t,Z]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[d,[t,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[d,[t,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon|otter|dooble|(?:lg |qute)browser)\/([-\w\.]+)/i,/(heytap|ovi|115|surf)browser\/([\d\.]+)/i,/(ecosia|weibo)(?:__| \w+@)([\d\.]+)/i],[t,d],[/quark(?:pc)?\/([-\w\.]+)/i],[d,[t,"Quark"]],[/\bddg\/([\w\.]+)/i],[d,[t,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[d,[t,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[d,[t,"WeChat"]],[/konqueror\/([\w\.]+)/i],[d,[t,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[d,[t,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[d,[t,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[d,[t,"Smart "+cr+Te]],[/(avast|avg)\/([\w\.]+)/i],[[t,/(.+)/,"$1 Secure"+Te],d],[/\bfocus\/([\w\.]+)/i],[d,[t,ie+" Focus"]],[/\bopt\/([\w\.]+)/i],[d,[t,Z+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[d,[t,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[d,[t,"Dolphin"]],[/coast\/([\w\.]+)/i],[d,[t,Z+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[d,[t,"MIUI"+Te]],[/fxios\/([\w\.-]+)/i],[d,[t,Oe+ie]],[/\bqihoobrowser\/?([\w\.]*)/i],[d,[t,"360"]],[/\b(qq)\/([\w\.]+)/i],[[t,/(.+)/,"$1Browser"],d],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[t,/(.+)/,"$1"+Te],d],[/samsungbrowser\/([\w\.]+)/i],[d,[t,He+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[d,[t,Me+" Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[t,Me+" Mobile"],d],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[t,d],[/(lbbrowser|rekonq)/i],[t],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[d,t],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[t,le],d,[i,N]],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(instagram|snapchat)[\/ ]([-\w\.]+)/i],[t,d,[i,N]],[/\bgsa\/([\w\.]+) .*safari\//i],[d,[t,"GSA"],[i,N]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[d,[t,"TikTok"],[i,N]],[/\[(linkedin)app\]/i],[t,[i,N]],[/(chromium)[\/ ]([-\w\.]+)/i],[t,d],[/headlesschrome(?:\/([\w\.]+)| )/i],[d,[t,A+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[t,A+" WebView"],d],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[d,[t,"Android"+Te]],[/chrome\/([\w\.]+) mobile/i],[d,[t,Oe+"Chrome"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[t,d],[/version\/([\w\.\,]+) .*mobile(?:\/\w+ | ?)safari/i],[d,[t,Oe+"Safari"]],[/iphone .*mobile(?:\/\w+ | ?)safari/i],[[t,Oe+"Safari"]],[/version\/([\w\.\,]+) .*(safari)/i],[d,t],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[t,[d,"1"]],[/(webkit|khtml)\/([\w\.]+)/i],[t,d],[/(?:mobile|tablet);.*(firefox)\/([\w\.-]+)/i],[[t,Oe+ie],d],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[t,"Netscape"],d],[/(wolvic|librewolf)\/([\w\.]+)/i],[t,d],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[d,[t,ie+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[t,[d,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[t,[d,/[^\d\.]+./,_]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[p,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[p,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[p,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[p,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[p,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[p,/ower/,_,De]],[/ sun4\w[;\)]/i],[[p,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[p,De]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[l,[o,He],[i,L]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[l,[o,He],[i,k]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[l,[o,Re],[i,k]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[l,[o,Re],[i,L]],[/(macintosh);/i],[l,[o,Re]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[l,[o,pr],[i,k]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[l,[o,ut],[i,L]],[/honor([-\w ]+)[;\)]/i],[l,[o,ut],[i,k]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[l,[o,or],[i,L]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[l,[o,or],[i,k]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[l,/_/g," "],[o,O],[i,L]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[l,/_/g," "],[o,O],[i,k]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[l,[o,ft],[i,k]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[l,[o,Ae,{OnePlus:["304","403","203"],"*":ft}],[i,L]],[/(vivo (5r?|6|8l?|go|one|s|x[il]?[2-4]?)[\w\+ ]*)(?: bui|\))/i],[l,[o,"BLU"],[i,k]],[/; vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[l,[o,"Vivo"],[i,k]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[l,[o,"Realme"],[i,k]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[l,[o,Ze],[i,k]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[l,[o,Ze],[i,L]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[l,[o,Je],[i,L]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+(?!.*(?:browser|netcast|android tv|watch))(\w+)/i,/\blg-?([\d\w]+) bui/i],[l,[o,Je],[i,k]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[l,[o,cr],[i,L]],[/(nokia) (t[12][01])/i],[o,l,[i,L]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[l,/_/g," "],[i,k],[o,"Nokia"]],[/(pixel (c|tablet))\b/i],[l,[o,pe],[i,L]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[l,[o,pe],[i,k]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[l,[o,Ie],[i,k]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[l,"Xperia Tablet"],[o,Ie],[i,L]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[l,[o,dr],[i,k]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[l,[o,Xe],[i,L]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[l,/(.+)/g,"Fire Phone $1"],[o,Xe],[i,k]],[/(playbook);[-\w\),; ]+(rim)/i],[l,o,[i,L]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[l,[o,lt],[i,k]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[l,[o,Ce],[i,L]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[l,[o,Ce],[i,k]],[/(nexus 9)/i],[l,[o,"HTC"],[i,L]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[o,[l,/_/g," "],[i,k]],[/tcl (xess p17aa)/i,/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])(_\w(\w|\w\w))?(\)| bui)/i],[l,[o,"TCL"],[i,L]],[/droid [\w\.]+; (418(?:7d|8v)|5087z|5102l|61(?:02[dh]|25[adfh]|27[ai]|56[dh]|59k|65[ah])|a509dl|t(?:43(?:0w|1[adepqu])|50(?:6d|7[adju])|6(?:09dl|10k|12b|71[efho]|76[hjk])|7(?:66[ahju]|67[hw]|7[045][bh]|71[hk]|73o|76[ho]|79w|81[hks]?|82h|90[bhsy]|99b)|810[hs]))(_\w(\w|\w\w))?(\)| bui)/i],[l,[o,"TCL"],[i,k]],[/(itel) ((\w+))/i],[[o,De],l,[i,Ae,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[l,[o,"Acer"],[i,L]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[l,[o,"Meizu"],[i,k]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[l,[o,"Ulefone"],[i,k]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[l,[o,"Energizer"],[i,k]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[l,[o,"Cat"],[i,k]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[l,[o,"Smartfren"],[i,k]],[/droid.+; (a(?:015|06[35]|142p?))/i],[l,[o,"Nothing"],[i,k]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[l,[o,"Archos"],[i,L]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[l,[o,"Archos"],[i,k]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[o,l,[i,L]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (blu|hmd|imo|tcl)[_ ]([\w\+ ]+?)(?: bui|\)|; r)/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[o,l,[i,k]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i],[o,l,[i,L]],[/(surface duo)/i],[l,[o,ze],[i,L]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[l,[o,"Fairphone"],[i,k]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[l,[o,et],[i,L]],[/(sprint) (\w+)/i],[o,l,[i,k]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[o,ze],[i,k]],[/droid.+; ([c6]+|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[l,[o,M],[i,L]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[l,[o,M],[i,k]],[/smart-tv.+(samsung)/i],[o,[i,S]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[o,He],[i,S]],[/tcast.+(lg)e?. ([-\w]+)/i],[o,l,[i,S]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[o,Je],[i,S]],[/(apple) ?tv/i],[o,[l,Re+" TV"],[i,S]],[/crkey.*devicetype\/chromecast/i],[[l,U+" Third Generation"],[o,pe],[i,S]],[/crkey.*devicetype\/([^/]*)/i],[[l,/^/,"Chromecast "],[o,pe],[i,S]],[/fuchsia.*crkey/i],[[l,U+" Nest Hub"],[o,pe],[i,S]],[/crkey/i],[[l,U],[o,pe],[i,S]],[/(portaltv)/i],[l,[o,le],[i,S]],[/droid.+aft(\w+)( bui|\))/i],[l,[o,Xe],[i,S]],[/(shield \w+ tv)/i],[l,[o,et],[i,S]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[l,[o,pr],[i,S]],[/(bravia[\w ]+)( bui|\))/i],[l,[o,Ie],[i,S]],[/(mi(tv|box)-?\w+) bui/i],[l,[o,O],[i,S]],[/Hbbtv.*(technisat) (.*);/i],[o,l,[i,S]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[o,mt],[l,mt],[i,S]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[l,[i,S]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[i,S]],[/(ouya)/i,/(nintendo) (\w+)/i],[o,l,[i,b]],[/droid.+; (shield)( bui|\))/i],[l,[o,et],[i,b]],[/(playstation \w+)/i],[l,[o,Ie],[i,b]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[l,[o,ze],[i,b]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[l,[o,He],[i,x]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[o,l,[i,x]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[l,[o,ft],[i,x]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[l,[o,Re],[i,x]],[/(opwwe\d{3})/i],[l,[o,dr],[i,x]],[/(moto 360)/i],[l,[o,Ze],[i,x]],[/(smartwatch 3)/i],[l,[o,Ie],[i,x]],[/(g watch r)/i],[l,[o,Je],[i,x]],[/droid.+; (wt63?0{2,3})\)/i],[l,[o,M],[i,x]],[/droid.+; (glass) \d/i],[l,[o,pe],[i,F]],[/(pico) (4|neo3(?: link|pro)?)/i],[o,l,[i,F]],[/(quest( \d| pro)?s?).+vr/i],[l,[o,le],[i,F]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[o,[i,I]],[/(aeobc)\b/i],[l,[o,Xe],[i,I]],[/(homepod).+mac os/i],[l,[o,Re],[i,I]],[/windows iot/i],[[i,I]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+?(mobile|vr|\d) safari/i],[l,[i,Ae,{mobile:"Mobile",xr:"VR","*":L}]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[i,L]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[i,k]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[l,[o,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[d,[t,te+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[t,d],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[d,[t,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[t,d],[/ladybird\//i],[[t,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[d,t]],os:[[/microsoft (windows) (vista|xp)/i],[t,d],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[t,[d,Ae,Zr]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[d,Ae,Zr],[t,tt]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[d,/_/g,"."],[t,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[t,"macOS"],[d,/_/g,"."]],[/android ([\d\.]+).*crkey/i],[d,[t,U+" Android"]],[/fuchsia.*crkey\/([\d\.]+)/i],[d,[t,U+" Fuchsia"]],[/crkey\/([\d\.]+).*devicetype\/smartspeaker/i],[d,[t,U+" SmartSpeaker"]],[/linux.*crkey\/([\d\.]+)/i],[d,[t,U+" Linux"]],[/crkey\/([\d\.]+)/i],[d,[t,U]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[d,t],[/(ubuntu) ([\w\.]+) like android/i],[[t,/(.+)/,"$1 Touch"],d],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/\.; ]?([\d\.]*)/i],[t,d],[/\(bb(10);/i],[d,[t,lt]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[d,[t,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[d,[t,ie+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[d,[t,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[d,[t,"watchOS"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[t,"Chrome OS"],d],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) (\w+)/i,/(xbox); +xbox ([^\);]+)/i,/(pico) .+os([\w\.]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[t,d],[/(sunos) ?([\w\.\d]*)/i],[[t,"Solaris"],d],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[t,d]]},fr=function(){var j={init:{},isIgnore:{},isIgnoreRgx:{},toString:{}};return Pe.call(j.init,[[u,[t,d,m,i]],[v,[p]],[a,[i,l,o]],[s,[t,d]],[e,[t,d]]]),Pe.call(j.isIgnore,[[u,[d,m]],[s,[d]],[e,[d]]]),Pe.call(j.isIgnoreRgx,[[u,/ ?browser$/i],[e,/ ?os$/i]]),Pe.call(j.toString,[[u,[t,d]],[v,[p]],[a,[o,l]],[s,[t,d]],[e,[t,d]]]),j}(),cn=function(j,q){var $=fr.init[q],G=fr.isIgnore[q]||0,H=fr.isIgnoreRgx[q]||0,Y=fr.toString[q]||0;function z(){Pe.call(this,$)}return z.prototype.getItem=function(){return j},z.prototype.withClientHints=function(){return Fe?Fe.getHighEntropyValues(pt).then(function(W){return j.setCH(new rs(W,!1)).parseCH().get()}):j.parseCH().get()},z.prototype.withFeatureCheck=function(){return j.detectFeature().get()},q!=r&&(z.prototype.is=function(W){var K=!1;for(var X in this)if(this.hasOwnProperty(X)&&!kr(G,X)&&De(H?st(H,this[X]):this[X])==De(H?st(H,W):W)){if(K=!0,W!=h)break}else if(W==h&&K){K=!K;break}return K},z.prototype.toString=function(){var W=_;for(var K in Y)typeof this[Y[K]]!==h&&(W+=(W?" ":_)+this[Y[K]]);return W||h}),Fe||(z.prototype.then=function(W){var K=this,X=function(){for(var Ne in K)K.hasOwnProperty(Ne)&&(this[Ne]=K[Ne])};X.prototype={is:z.prototype.is,toString:z.prototype.toString};var Ee=new X;return W(Ee),Ee}),new z};function rs(j,q){if(j=j||{},Pe.call(this,pt),q)Pe.call(this,[[V,Lr(j[de])],[we,Lr(j[$e])],[k,/\?1/.test(j[Er])],[l,ht(j[ar])],[oe,ht(j[ct])],[ee,ht(j[dt])],[p,ht(j[Le])],[Q,Lr(j[xe])],[me,ht(j[Ue])]]);else for(var $ in j)this.hasOwnProperty($)&&typeof j[$]!==h&&(this[$]=j[$])}function ss(j,q,$,G){return this.get=function(H){return H?this.data.hasOwnProperty(H)?this.data[H]:c:this.data},this.set=function(H,Y){return this.data[H]=Y,this},this.setCH=function(H){return this.uaCH=H,this},this.detectFeature=function(){if(ue&&ue.userAgent==this.ua)switch(this.itemType){case u:ue.brave&&typeof ue.brave.isBrave==g&&this.set(t,"Brave");break;case a:!this.get(i)&&Fe&&Fe[k]&&this.set(i,k),this.get(l)=="Macintosh"&&ue&&typeof ue.standalone!==h&&ue.maxTouchPoints&&ue.maxTouchPoints>2&&this.set(l,"iPad").set(i,L);break;case e:!this.get(t)&&Fe&&Fe[oe]&&this.set(t,Fe[oe]);break;case r:var H=this.data,Y=function(z){return H[z].getItem().detectFeature().get()};this.set(u,Y(u)).set(v,Y(v)).set(a,Y(a)).set(s,Y(s)).set(e,Y(e))}return this},this.parseUA=function(){return this.itemType!=r&&Ir.call(this.data,this.ua,this.rgxMap),this.itemType==u&&this.set(m,xr(this.get(d))),this},this.parseCH=function(){var H=this.uaCH,Y=this.rgxMap;switch(this.itemType){case u:case s:var z=H[we]||H[V],W;if(z)for(var K in z){var X=z[K].brand||z[K],Ee=z[K].version;this.itemType==u&&!/not.a.brand/i.test(X)&&(!W||/chrom/i.test(W)&&X!=B)&&(X=Ae(X,{Chrome:"Google Chrome",Edge:"Microsoft Edge","Chrome WebView":"Android WebView","Chrome Headless":"HeadlessChrome","Huawei Browser":"HuaweiBrowser","MIUI Browser":"Miui Browser","Opera Mobi":"OperaMobile",Yandex:"YaBrowser"}),this.set(t,X).set(d,Ee).set(m,xr(Ee)),W=X),this.itemType==s&&X==B&&this.set(d,Ee)}break;case v:var Ne=H[p];Ne&&(Ne&&H[me]=="64"&&(Ne+="64"),Ir.call(this.data,Ne+";",Y));break;case a:if(H[k]&&this.set(i,k),H[l]&&(this.set(l,H[l]),!this.get(i)||!this.get(o))){var gt={};Ir.call(gt,"droid 9; "+H[l]+")",Y),!this.get(i)&&gt.type&&this.set(i,gt.type),!this.get(o)&&gt.vendor&&this.set(o,gt.vendor)}if(H[Q]){var mr;if(typeof H[Q]!="string")for(var is=0;!mr&&is<H[Q].length;)mr=Ae(H[Q][is++],es);else mr=Ae(H[Q],es);this.set(i,mr)}break;case e:var Mr=H[oe];if(Mr){var Or=H[ee];Mr==tt&&(Or=parseInt(xr(Or),10)>=13?"11":"10"),this.set(t,Mr).set(d,Or)}this.get(t)==tt&&H[l]=="Xbox"&&this.set(t,"Xbox").set(d,c);break;case r:var dn=this.data,_t=function(pn){return dn[pn].getItem().setCH(H).parseCH().get()};this.set(u,_t(u)).set(v,_t(v)).set(a,_t(a)).set(s,_t(s)).set(e,_t(e))}return this},Pe.call(this,[["itemType",j],["ua",q],["uaCH",G],["rgxMap",$],["data",cn(this,j)]]),this}function ve(j,q,$){if(typeof j===n?(ur(j,!0)?(typeof q===n&&($=q),q=j):($=j,q=c),j=c):typeof j===y&&!ur(q,!0)&&($=q,q=c),$&&typeof $.append===g){var G={};$.forEach(function(K,X){G[X]=K}),$=G}if(!(this instanceof ve))return new ve(j,q,$).getResult();var H=typeof j===y?j:$&&$[f]?$[f]:ue&&ue.userAgent?ue.userAgent:_,Y=new rs($,!0),z=q?on(ts,q):ts,W=function(K){return K==r?function(){return new ss(K,H,z,Y).set("ua",H).set(u,this.getBrowser()).set(v,this.getCPU()).set(a,this.getDevice()).set(s,this.getEngine()).set(e,this.getOS()).get()}:function(){return new ss(K,H,z[K],Y).parseUA().get()}};return Pe.call(this,[["getBrowser",W(u)],["getCPU",W(v)],["getDevice",W(a)],["getEngine",W(s)],["getOS",W(e)],["getResult",W(r)],["getUA",function(){return H}],["setUA",function(K){return rt(K)&&(H=K.length>R?mt(K,R):K),this}]]).setUA(H),this}ve.VERSION=P,ve.BROWSER=lr([t,d,m,i]),ve.CPU=lr([p]),ve.DEVICE=lr([l,o,i,b,k,S,L,x,I]),ve.ENGINE=ve.OS=lr([t,d]),w.exports&&(D=w.exports=ve),D.UAParser=ve;var it=Jr&&(T.jQuery||T.Zepto);if(it&&!it.ua){var hr=new ve;it.ua=hr.getResult(),it.ua.get=function(){return hr.getUA()},it.ua.set=function(j){hr.setUA(j);var q=hr.getResult();for(var $ in q)it.ua[$]=q[$]}}})(typeof window=="object"?window:mn)}(ir,ir.exports)),ir.exports}var wt={},ps;function J(){if(ps)return wt;ps=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.Logger=void 0;const w=xi(),D="mediasoup-client";class T{constructor(P){E(this,"_debug");E(this,"_warn");E(this,"_error");P?(this._debug=(0,w.default)(`${D}:${P}`),this._warn=(0,w.default)(`${D}:WARN:${P}`),this._error=(0,w.default)(`${D}:ERROR:${P}`)):(this._debug=(0,w.default)(D),this._warn=(0,w.default)(`${D}:WARN`),this._error=(0,w.default)(`${D}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}return wt.Logger=T,wt}var vt={},_r={exports:{}},ls;function _n(){if(ls)return _r.exports;ls=1;var w=typeof Reflect=="object"?Reflect:null,D=w&&typeof w.apply=="function"?w.apply:function(o,d,p){return Function.prototype.apply.call(o,d,p)},T;w&&typeof w.ownKeys=="function"?T=w.ownKeys:Object.getOwnPropertySymbols?T=function(o){return Object.getOwnPropertyNames(o).concat(Object.getOwnPropertySymbols(o))}:T=function(o){return Object.getOwnPropertyNames(o)};function c(i){console&&console.warn&&console.warn(i)}var P=Number.isNaN||function(o){return o!==o};function R(){R.init.call(this)}_r.exports=R,_r.exports.once=e,R.EventEmitter=R,R.prototype._events=void 0,R.prototype._eventsCount=0,R.prototype._maxListeners=void 0;var f=10;function _(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(R,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(i){if(typeof i!="number"||i<0||P(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");f=i}}),R.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},R.prototype.setMaxListeners=function(o){if(typeof o!="number"||o<0||P(o))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+o+".");return this._maxListeners=o,this};function C(i){return i._maxListeners===void 0?R.defaultMaxListeners:i._maxListeners}R.prototype.getMaxListeners=function(){return C(this)},R.prototype.emit=function(o){for(var d=[],p=1;p<arguments.length;p++)d.push(arguments[p]);var m=o==="error",l=this._events;if(l!==void 0)m=m&&l.error===void 0;else if(!m)return!1;if(m){var b;if(d.length>0&&(b=d[0]),b instanceof Error)throw b;var k=new Error("Unhandled error."+(b?" ("+b.message+")":""));throw k.context=b,k}var L=l[o];if(L===void 0)return!1;if(typeof L=="function")D(L,this,d);else for(var S=L.length,x=v(L,S),p=0;p<S;++p)D(x[p],this,d);return!0};function g(i,o,d,p){var m,l,b;if(_(d),l=i._events,l===void 0?(l=i._events=Object.create(null),i._eventsCount=0):(l.newListener!==void 0&&(i.emit("newListener",o,d.listener?d.listener:d),l=i._events),b=l[o]),b===void 0)b=l[o]=d,++i._eventsCount;else if(typeof b=="function"?b=l[o]=p?[d,b]:[b,d]:p?b.unshift(d):b.push(d),m=C(i),m>0&&b.length>m&&!b.warned){b.warned=!0;var k=new Error("Possible EventEmitter memory leak detected. "+b.length+" "+String(o)+" listeners added. Use emitter.setMaxListeners() to increase limit");k.name="MaxListenersExceededWarning",k.emitter=i,k.type=o,k.count=b.length,c(k)}return i}R.prototype.addListener=function(o,d){return g(this,o,d,!1)},R.prototype.on=R.prototype.addListener,R.prototype.prependListener=function(o,d){return g(this,o,d,!0)};function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function n(i,o,d){var p={fired:!1,wrapFn:void 0,target:i,type:o,listener:d},m=h.bind(p);return m.listener=d,p.wrapFn=m,m}R.prototype.once=function(o,d){return _(d),this.on(o,n(this,o,d)),this},R.prototype.prependOnceListener=function(o,d){return _(d),this.prependListener(o,n(this,o,d)),this},R.prototype.removeListener=function(o,d){var p,m,l,b,k;if(_(d),m=this._events,m===void 0)return this;if(p=m[o],p===void 0)return this;if(p===d||p.listener===d)--this._eventsCount===0?this._events=Object.create(null):(delete m[o],m.removeListener&&this.emit("removeListener",o,p.listener||d));else if(typeof p!="function"){for(l=-1,b=p.length-1;b>=0;b--)if(p[b]===d||p[b].listener===d){k=p[b].listener,l=b;break}if(l<0)return this;l===0?p.shift():a(p,l),p.length===1&&(m[o]=p[0]),m.removeListener!==void 0&&this.emit("removeListener",o,k||d)}return this},R.prototype.off=R.prototype.removeListener,R.prototype.removeAllListeners=function(o){var d,p,m;if(p=this._events,p===void 0)return this;if(p.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):p[o]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete p[o]),this;if(arguments.length===0){var l=Object.keys(p),b;for(m=0;m<l.length;++m)b=l[m],b!=="removeListener"&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(d=p[o],typeof d=="function")this.removeListener(o,d);else if(d!==void 0)for(m=d.length-1;m>=0;m--)this.removeListener(o,d[m]);return this};function y(i,o,d){var p=i._events;if(p===void 0)return[];var m=p[o];return m===void 0?[]:typeof m=="function"?d?[m.listener||m]:[m]:d?s(m):v(m,m.length)}R.prototype.listeners=function(o){return y(this,o,!0)},R.prototype.rawListeners=function(o){return y(this,o,!1)},R.listenerCount=function(i,o){return typeof i.listenerCount=="function"?i.listenerCount(o):u.call(i,o)},R.prototype.listenerCount=u;function u(i){var o=this._events;if(o!==void 0){var d=o[i];if(typeof d=="function")return 1;if(d!==void 0)return d.length}return 0}R.prototype.eventNames=function(){return this._eventsCount>0?T(this._events):[]};function v(i,o){for(var d=new Array(o),p=0;p<o;++p)d[p]=i[p];return d}function a(i,o){for(;o+1<i.length;o++)i[o]=i[o+1];i.pop()}function s(i){for(var o=new Array(i.length),d=0;d<o.length;++d)o[d]=i[d].listener||i[d];return o}function e(i,o){return new Promise(function(d,p){function m(b){i.removeListener(o,l),p(b)}function l(){typeof i.removeListener=="function"&&i.removeListener("error",m),d([].slice.call(arguments))}t(i,o,l,{once:!0}),o!=="error"&&r(i,m,{once:!0})})}function r(i,o,d){typeof i.on=="function"&&t(i,"error",o,d)}function t(i,o,d,p){if(typeof i.on=="function")p.once?i.once(o,d):i.on(o,d);else if(typeof i.addEventListener=="function")i.addEventListener(o,function m(l){p.once&&i.removeEventListener(o,m),d(l)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}return _r.exports}var us;function Be(){if(us)return vt;us=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.EnhancedEventEmitter=void 0;const w=_n(),D=J(),T=new D.Logger("EnhancedEventEmitter");class c extends w.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(R,...f){return super.emit(R,...f)}safeEmit(R,...f){try{return super.emit(R,...f)}catch(_){T.error("safeEmit() | event listener threw an error [eventName:%s]:%o",R,_);try{super.emit("listenererror",R,_)}catch{}return!!super.listenerCount(R)}}on(R,f){return super.on(R,f),this}off(R,f){return super.off(R,f),this}addListener(R,f){return super.on(R,f),this}prependListener(R,f){return super.prependListener(R,f),this}once(R,f){return super.once(R,f),this}prependOnceListener(R,f){return super.prependOnceListener(R,f),this}removeListener(R,f){return super.off(R,f),this}removeAllListeners(R){return super.removeAllListeners(R),this}listenerCount(R){return super.listenerCount(R)}listeners(R){return super.listeners(R)}rawListeners(R){return super.rawListeners(R)}}return vt.EnhancedEventEmitter=c,vt}var Ke={},fs;function ne(){if(fs)return Ke;fs=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.InvalidStateError=Ke.UnsupportedError=void 0;class w extends Error{constructor(c){super(c),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,w):this.stack=new Error(c).stack}}Ke.UnsupportedError=w;class D extends Error{constructor(c){super(c),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,D):this.stack=new Error(c).stack}}return Ke.InvalidStateError=D,Ke}var at={},hs;function re(){if(hs)return at;hs=1,Object.defineProperty(at,"__esModule",{value:!0}),at.clone=w,at.generateRandomNumber=D,at.deepFreeze=T;function w(c){if(c!==void 0)return Number.isNaN(c)?NaN:typeof structuredClone=="function"?structuredClone(c):JSON.parse(JSON.stringify(c))}function D(){return Math.round(Math.random()*1e7)}function T(c){const P=Reflect.ownKeys(c);for(const R of P){const f=c[R];(f&&typeof f=="object"||typeof f=="function")&&T(f)}return Object.freeze(c)}return at}var ce={},se={},Ge={},wr={exports:{}},jr,ms;function wn(){if(ms)return jr;ms=1;var w=1e3,D=w*60,T=D*60,c=T*24,P=c*7,R=c*365.25;jr=function(h,n){n=n||{};var y=typeof h;if(y==="string"&&h.length>0)return f(h);if(y==="number"&&isFinite(h))return n.long?C(h):_(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))};function f(h){if(h=String(h),!(h.length>100)){var n=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(h);if(n){var y=parseFloat(n[1]),u=(n[2]||"ms").toLowerCase();switch(u){case"years":case"year":case"yrs":case"yr":case"y":return y*R;case"weeks":case"week":case"w":return y*P;case"days":case"day":case"d":return y*c;case"hours":case"hour":case"hrs":case"hr":case"h":return y*T;case"minutes":case"minute":case"mins":case"min":case"m":return y*D;case"seconds":case"second":case"secs":case"sec":case"s":return y*w;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return y;default:return}}}}function _(h){var n=Math.abs(h);return n>=c?Math.round(h/c)+"d":n>=T?Math.round(h/T)+"h":n>=D?Math.round(h/D)+"m":n>=w?Math.round(h/w)+"s":h+"ms"}function C(h){var n=Math.abs(h);return n>=c?g(h,n,c,"day"):n>=T?g(h,n,T,"hour"):n>=D?g(h,n,D,"minute"):n>=w?g(h,n,w,"second"):h+" ms"}function g(h,n,y,u){var v=n>=y*1.5;return Math.round(h/y)+" "+u+(v?"s":"")}return jr}var Br,gs;function vn(){if(gs)return Br;gs=1;function w(D){c.debug=c,c.default=c,c.coerce=g,c.disable=_,c.enable=R,c.enabled=C,c.humanize=wn(),c.destroy=h,Object.keys(D).forEach(n=>{c[n]=D[n]}),c.names=[],c.skips=[],c.formatters={};function T(n){let y=0;for(let u=0;u<n.length;u++)y=(y<<5)-y+n.charCodeAt(u),y|=0;return c.colors[Math.abs(y)%c.colors.length]}c.selectColor=T;function c(n){let y,u=null,v,a;function s(...e){if(!s.enabled)return;const r=s,t=Number(new Date),i=t-(y||t);r.diff=i,r.prev=y,r.curr=t,y=t,e[0]=c.coerce(e[0]),typeof e[0]!="string"&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(p,m)=>{if(p==="%%")return"%";o++;const l=c.formatters[m];if(typeof l=="function"){const b=e[o];p=l.call(r,b),e.splice(o,1),o--}return p}),c.formatArgs.call(r,e),(r.log||c.log).apply(r,e)}return s.namespace=n,s.useColors=c.useColors(),s.color=c.selectColor(n),s.extend=P,s.destroy=c.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(v!==c.namespaces&&(v=c.namespaces,a=c.enabled(n)),a),set:e=>{u=e}}),typeof c.init=="function"&&c.init(s),s}function P(n,y){const u=c(this.namespace+(typeof y>"u"?":":y)+n);return u.log=this.log,u}function R(n){c.save(n),c.namespaces=n,c.names=[],c.skips=[];const y=(typeof n=="string"?n:"").trim().replace(" ",",").split(",").filter(Boolean);for(const u of y)u[0]==="-"?c.skips.push(u.slice(1)):c.names.push(u)}function f(n,y){let u=0,v=0,a=-1,s=0;for(;u<n.length;)if(v<y.length&&(y[v]===n[u]||y[v]==="*"))y[v]==="*"?(a=v,s=u,v++):(u++,v++);else if(a!==-1)v=a+1,s++,u=s;else return!1;for(;v<y.length&&y[v]==="*";)v++;return v===y.length}function _(){const n=[...c.names,...c.skips.map(y=>"-"+y)].join(",");return c.enable(""),n}function C(n){for(const y of c.skips)if(f(n,y))return!1;for(const y of c.names)if(f(n,y))return!0;return!1}function g(n){return n instanceof Error?n.stack||n.message:n}function h(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return c.enable(c.load()),c}return Br=w,Br}var _s;function bn(){return _s||(_s=1,function(w,D){var T={};D.formatArgs=P,D.save=R,D.load=f,D.useColors=c,D.storage=_(),D.destroy=(()=>{let g=!1;return()=>{g||(g=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),D.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function c(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let g;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(g=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(g[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function P(g){if(g[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+g[0]+(this.useColors?"%c ":" ")+"+"+w.exports.humanize(this.diff),!this.useColors)return;const h="color: "+this.color;g.splice(1,0,h,"color: inherit");let n=0,y=0;g[0].replace(/%[a-zA-Z%]/g,u=>{u!=="%%"&&(n++,u==="%c"&&(y=n))}),g.splice(y,0,h)}D.log=console.debug||console.log||(()=>{});function R(g){try{g?D.storage.setItem("debug",g):D.storage.removeItem("debug")}catch{}}function f(){let g;try{g=D.storage.getItem("debug")}catch{}return!g&&typeof process<"u"&&"env"in process&&(g=T.DEBUG),g}function _(){try{return localStorage}catch{}}w.exports=vn()(D);const{formatters:C}=w.exports;C.j=function(g){try{return JSON.stringify(g)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}}(wr,wr.exports)),wr.exports}var ws;function yn(){if(ws)return Ge;ws=1;var w=Ge&&Ge.__importDefault||function(P){return P&&P.__esModule?P:{default:P}};Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.Logger=void 0;const D=w(bn()),T="h264-profile-level-id";class c{constructor(R){R?(this._debug=(0,D.default)(`${T}:${R}`),this._warn=(0,D.default)(`${T}:WARN:${R}`),this._error=(0,D.default)(`${T}:ERROR:${R}`)):(this._debug=(0,D.default)(T),this._warn=(0,D.default)(`${T}:WARN`),this._error=(0,D.default)(`${T}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}return Ge.Logger=c,Ge}var vs;function Sn(){if(vs)return se;vs=1,Object.defineProperty(se,"__esModule",{value:!0}),se.ProfileLevelId=se.Level=se.Profile=void 0,se.parseProfileLevelId=h,se.profileLevelIdToString=n,se.profileToString=y,se.levelToString=u,se.parseSdpProfileLevelId=v,se.isSameProfile=a,se.isSameProfileAndLevel=s,se.generateProfileLevelIdStringForAnswer=e,se.supportedLevel=r;const w=yn(),D=new w.Logger;var T;(function(p){p[p.ConstrainedBaseline=1]="ConstrainedBaseline",p[p.Baseline=2]="Baseline",p[p.Main=3]="Main",p[p.ConstrainedHigh=4]="ConstrainedHigh",p[p.High=5]="High",p[p.PredictiveHigh444=6]="PredictiveHigh444"})(T||(se.Profile=T={}));var c;(function(p){p[p.L1_b=0]="L1_b",p[p.L1=10]="L1",p[p.L1_1=11]="L1_1",p[p.L1_2=12]="L1_2",p[p.L1_3=13]="L1_3",p[p.L2=20]="L2",p[p.L2_1=21]="L2_1",p[p.L2_2=22]="L2_2",p[p.L3=30]="L3",p[p.L3_1=31]="L3_1",p[p.L3_2=32]="L3_2",p[p.L4=40]="L4",p[p.L4_1=41]="L4_1",p[p.L4_2=42]="L4_2",p[p.L5=50]="L5",p[p.L5_1=51]="L5_1",p[p.L5_2=52]="L5_2"})(c||(se.Level=c={}));class P{constructor(m,l){this.profile=m,this.level=l}}se.ProfileLevelId=P;const R=new P(T.ConstrainedBaseline,c.L3_1);class f{constructor(m){this.mask=~t("x",m),this.masked_value=t("1",m)}isMatch(m){return this.masked_value===(m&this.mask)}}class _{constructor(m,l,b){this.profile_idc=m,this.profile_iop=l,this.profile=b}}const C=[new _(66,new f("x1xx0000"),T.ConstrainedBaseline),new _(77,new f("1xxx0000"),T.ConstrainedBaseline),new _(88,new f("11xx0000"),T.ConstrainedBaseline),new _(66,new f("x0xx0000"),T.Baseline),new _(88,new f("10xx0000"),T.Baseline),new _(77,new f("0x0x0000"),T.Main),new _(100,new f("00000000"),T.High),new _(100,new f("00001100"),T.ConstrainedHigh),new _(244,new f("00000000"),T.PredictiveHigh444)],g=[{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:c.L1},{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:c.L1_b},{max_macroblocks_per_second:3e3,max_macroblock_frame_size:396,level:c.L1_1},{max_macroblocks_per_second:6e3,max_macroblock_frame_size:396,level:c.L1_2},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:c.L1_3},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:c.L2},{max_macroblocks_per_second:19800,max_macroblock_frame_size:792,level:c.L2_1},{max_macroblocks_per_second:20250,max_macroblock_frame_size:1620,level:c.L2_2},{max_macroblocks_per_second:40500,max_macroblock_frame_size:1620,level:c.L3},{max_macroblocks_per_second:108e3,max_macroblock_frame_size:3600,level:c.L3_1},{max_macroblocks_per_second:216e3,max_macroblock_frame_size:5120,level:c.L3_2},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:c.L4},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:c.L4_1},{max_macroblocks_per_second:522240,max_macroblock_frame_size:8704,level:c.L4_2},{max_macroblocks_per_second:589824,max_macroblock_frame_size:22080,level:c.L5},{max_macroblocks_per_second:983040,max_macroblock_frame_size:36864,level:c.L5_1},{max_macroblocks_per_second:2073600,max_macroblock_frame_size:36864,level:c.L5_2}];function h(p){if(typeof p!="string"||p.length!==6)return;const l=parseInt(p,16);if(l===0)return;const b=l&255,k=l>>8&255,L=l>>16&255;let S;switch(b){case c.L1_1:{S=(k&16)!==0?c.L1_b:c.L1_1;break}case c.L1:case c.L1_2:case c.L1_3:case c.L2:case c.L2_1:case c.L2_2:case c.L3:case c.L3_1:case c.L3_2:case c.L4:case c.L4_1:case c.L4_2:case c.L5:case c.L5_1:case c.L5_2:{S=b;break}default:{D.warn(`parseProfileLevelId() | unrecognized level_idc [str:${p}, level_idc:${b}]`);return}}for(const x of C)if(L===x.profile_idc&&x.profile_iop.isMatch(k))return D.debug(`parseProfileLevelId() | result [str:${p}, profile:${x.profile}, level:${S}]`),new P(x.profile,S);D.warn(`parseProfileLevelId() | unrecognized profile_idc/profile_iop combination [str:${p}, profile_idc:${L}, profile_iop:${k}]`)}function n(p){if(p.level==c.L1_b)switch(p.profile){case T.ConstrainedBaseline:return"42f00b";case T.Baseline:return"42100b";case T.Main:return"4d100b";default:{D.warn(`profileLevelIdToString() | Level 1_b not is allowed for profile ${p.profile}`);return}}let m;switch(p.profile){case T.ConstrainedBaseline:{m="42e0";break}case T.Baseline:{m="4200";break}case T.Main:{m="4d00";break}case T.ConstrainedHigh:{m="640c";break}case T.High:{m="6400";break}case T.PredictiveHigh444:{m="f400";break}default:{D.warn(`profileLevelIdToString() | unrecognized profile ${p.profile}`);return}}let l=p.level.toString(16);return l.length===1&&(l=`0${l}`),`${m}${l}`}function y(p){switch(p){case T.ConstrainedBaseline:return"ConstrainedBaseline";case T.Baseline:return"Baseline";case T.Main:return"Main";case T.ConstrainedHigh:return"ConstrainedHigh";case T.High:return"High";case T.PredictiveHigh444:return"PredictiveHigh444";default:{D.warn(`profileToString() | unrecognized profile ${p}`);return}}}function u(p){switch(p){case c.L1_b:return"1b";case c.L1:return"1";case c.L1_1:return"1.1";case c.L1_2:return"1.2";case c.L1_3:return"1.3";case c.L2:return"2";case c.L2_1:return"2.1";case c.L2_2:return"2.2";case c.L3:return"3";case c.L3_1:return"3.1";case c.L3_2:return"3.2";case c.L4:return"4";case c.L4_1:return"4.1";case c.L4_2:return"4.2";case c.L5:return"5";case c.L5_1:return"5.1";case c.L5_2:return"5.2";default:{D.warn(`levelToString() | unrecognized level ${p}`);return}}}function v(p={}){const m=p["profile-level-id"];return m?h(m):R}function a(p={},m={}){const l=v(p),b=v(m);return!!(l&&b&&l.profile===b.profile)}function s(p={},m={}){const l=v(p),b=v(m);return!!(l&&b&&l.profile===b.profile&&l.level==b.level)}function e(p={},m={}){if(!p["profile-level-id"]&&!m["profile-level-id"]){D.warn("generateProfileLevelIdStringForAnswer() | profile-level-id missing in local and remote params");return}const l=v(p),b=v(m);if(!l)throw new TypeError("invalid local_profile_level_id");if(!b)throw new TypeError("invalid remote_profile_level_id");if(l.profile!==b.profile)throw new TypeError("H264 Profile mismatch");const k=d(p)&&d(m),L=l.level,S=b.level,x=o(L,S),F=k?L:x;return D.debug(`generateProfileLevelIdStringForAnswer() | result [profile:${l.profile}, level:${F}]`),n(new P(l.profile,F))}function r(p,m){for(let b=g.length-1;b>=0;--b){const k=g[b];if(k.max_macroblock_frame_size*256<=p&&k.max_macroblocks_per_second<=m*k.max_macroblock_frame_size)return D.debug(`supportedLevel() | result [max_frame_pixel_count:${p}, max_fps:${m}, level:${k.level}]`),k.level}D.warn(`supportedLevel() | no level supported [max_frame_pixel_count:${p}, max_fps:${m}]`)}function t(p,m){return+(m[0]===p)<<7|+(m[1]===p)<<6|+(m[2]===p)<<5|+(m[3]===p)<<4|+(m[4]===p)<<3|+(m[5]===p)<<2|+(m[6]===p)<<1|+(m[7]===p)<<0}function i(p,m){return p===c.L1_b?m!==c.L1&&m!==c.L1_b:m===c.L1_b?p!==c.L1:p<m}function o(p,m){return i(p,m)?p:m}function d(p={}){const m=p["level-asymmetry-allowed"];return m===!0||m===1||m==="1"}return se}var bs;function ae(){if(bs)return ce;bs=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.validateRtpCapabilities=R,ce.validateRtpParameters=f,ce.validateSctpStreamParameters=_,ce.validateSctpCapabilities=C,ce.getExtendedRtpCapabilities=g,ce.getRecvRtpCapabilities=h,ce.getSendingRtpParameters=n,ce.getSendingRemoteRtpParameters=y,ce.reduceCodecs=u,ce.generateProbatorRtpParameters=v,ce.canSend=a,ce.canReceive=s;const w=Sn(),D=re(),T="probator",c=1234,P=127;function R(S){if(typeof S!="object")throw new TypeError("caps is not an object");if(S.codecs&&!Array.isArray(S.codecs))throw new TypeError("caps.codecs is not an array");S.codecs||(S.codecs=[]);for(const x of S.codecs)e(x);if(S.headerExtensions&&!Array.isArray(S.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");S.headerExtensions||(S.headerExtensions=[]);for(const x of S.headerExtensions)t(x)}function f(S){if(typeof S!="object")throw new TypeError("params is not an object");if(S.mid&&typeof S.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(S.codecs))throw new TypeError("missing params.codecs");for(const x of S.codecs)i(x);if(S.headerExtensions&&!Array.isArray(S.headerExtensions))throw new TypeError("params.headerExtensions is not an array");S.headerExtensions||(S.headerExtensions=[]);for(const x of S.headerExtensions)o(x);if(S.encodings&&!Array.isArray(S.encodings))throw new TypeError("params.encodings is not an array");S.encodings||(S.encodings=[]);for(const x of S.encodings)d(x);if(S.rtcp&&typeof S.rtcp!="object")throw new TypeError("params.rtcp is not an object");S.rtcp||(S.rtcp={}),p(S.rtcp)}function _(S){if(typeof S!="object")throw new TypeError("params is not an object");if(typeof S.streamId!="number")throw new TypeError("missing params.streamId");let x=!1;if(typeof S.ordered=="boolean"?x=!0:S.ordered=!0,S.maxPacketLifeTime&&typeof S.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(S.maxRetransmits&&typeof S.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(S.maxPacketLifeTime&&S.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(x&&S.ordered&&(S.maxPacketLifeTime||S.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!x&&(S.maxPacketLifeTime||S.maxRetransmits)&&(S.ordered=!1),S.label&&typeof S.label!="string")throw new TypeError("invalid params.label");if(S.protocol&&typeof S.protocol!="string")throw new TypeError("invalid params.protocol")}function C(S){if(typeof S!="object")throw new TypeError("caps is not an object");if(!S.numStreams||typeof S.numStreams!="object")throw new TypeError("missing caps.numStreams");m(S.numStreams)}function g(S,x){const F={codecs:[],headerExtensions:[]};for(const I of x.codecs??[]){if(l(I))continue;const N=(S.codecs??[]).find(Q=>b(Q,I,{strict:!0,modify:!0}));if(!N)continue;const V={mimeType:N.mimeType,kind:N.kind,clockRate:N.clockRate,channels:N.channels,localPayloadType:N.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:I.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:N.parameters,remoteParameters:I.parameters,rtcpFeedback:L(N,I)};F.codecs.push(V)}for(const I of F.codecs){const N=S.codecs.find(Q=>l(Q)&&Q.parameters.apt===I.localPayloadType),V=x.codecs.find(Q=>l(Q)&&Q.parameters.apt===I.remotePayloadType);N&&V&&(I.localRtxPayloadType=N.preferredPayloadType,I.remoteRtxPayloadType=V.preferredPayloadType)}for(const I of x.headerExtensions){const N=S.headerExtensions.find(Q=>k(Q,I));if(!N)continue;const V={kind:I.kind,uri:I.uri,sendId:N.preferredId,recvId:I.preferredId,encrypt:N.preferredEncrypt,direction:"sendrecv"};switch(I.direction){case"sendrecv":{V.direction="sendrecv";break}case"recvonly":{V.direction="sendonly";break}case"sendonly":{V.direction="recvonly";break}case"inactive":{V.direction="inactive";break}}F.headerExtensions.push(V)}return F}function h(S){const x={codecs:[],headerExtensions:[]};for(const F of S.codecs){const I={mimeType:F.mimeType,kind:F.kind,preferredPayloadType:F.remotePayloadType,clockRate:F.clockRate,channels:F.channels,parameters:F.localParameters,rtcpFeedback:F.rtcpFeedback};if(x.codecs.push(I),!F.remoteRtxPayloadType)continue;const N={mimeType:`${F.kind}/rtx`,kind:F.kind,preferredPayloadType:F.remoteRtxPayloadType,clockRate:F.clockRate,parameters:{apt:F.remotePayloadType},rtcpFeedback:[]};x.codecs.push(N)}for(const F of S.headerExtensions){if(F.direction!=="sendrecv"&&F.direction!=="recvonly")continue;const I={kind:F.kind,uri:F.uri,preferredId:F.recvId,preferredEncrypt:F.encrypt,direction:F.direction};x.headerExtensions.push(I)}return x}function n(S,x){const F={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const I of x.codecs){if(I.kind!==S)continue;const N={mimeType:I.mimeType,payloadType:I.localPayloadType,clockRate:I.clockRate,channels:I.channels,parameters:I.localParameters,rtcpFeedback:I.rtcpFeedback};if(F.codecs.push(N),I.localRtxPayloadType){const V={mimeType:`${I.kind}/rtx`,payloadType:I.localRtxPayloadType,clockRate:I.clockRate,parameters:{apt:I.localPayloadType},rtcpFeedback:[]};F.codecs.push(V)}}for(const I of x.headerExtensions){if(I.kind&&I.kind!==S||I.direction!=="sendrecv"&&I.direction!=="sendonly")continue;const N={uri:I.uri,id:I.sendId,encrypt:I.encrypt,parameters:{}};F.headerExtensions.push(N)}return F}function y(S,x){const F={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const I of x.codecs){if(I.kind!==S)continue;const N={mimeType:I.mimeType,payloadType:I.localPayloadType,clockRate:I.clockRate,channels:I.channels,parameters:I.remoteParameters,rtcpFeedback:I.rtcpFeedback};if(F.codecs.push(N),I.localRtxPayloadType){const V={mimeType:`${I.kind}/rtx`,payloadType:I.localRtxPayloadType,clockRate:I.clockRate,parameters:{apt:I.localPayloadType},rtcpFeedback:[]};F.codecs.push(V)}}for(const I of x.headerExtensions){if(I.kind&&I.kind!==S||I.direction!=="sendrecv"&&I.direction!=="sendonly")continue;const N={uri:I.uri,id:I.sendId,encrypt:I.encrypt,parameters:{}};F.headerExtensions.push(N)}if(F.headerExtensions.some(I=>I.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(const I of F.codecs)I.rtcpFeedback=(I.rtcpFeedback??[]).filter(N=>N.type!=="goog-remb");else if(F.headerExtensions.some(I=>I.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(const I of F.codecs)I.rtcpFeedback=(I.rtcpFeedback??[]).filter(N=>N.type!=="transport-cc");else for(const I of F.codecs)I.rtcpFeedback=(I.rtcpFeedback??[]).filter(N=>N.type!=="transport-cc"&&N.type!=="goog-remb");return F}function u(S,x){const F=[];if(!x)F.push(S[0]),l(S[1])&&F.push(S[1]);else{for(let I=0;I<S.length;++I)if(b(S[I],x,{strict:!0})){F.push(S[I]),l(S[I+1])&&F.push(S[I+1]);break}if(F.length===0)throw new TypeError("no matching codec found")}return F}function v(S){S=D.clone(S),f(S);const x={mid:T,codecs:[],headerExtensions:[],encodings:[{ssrc:c}],rtcp:{cname:"probator"}};return x.codecs.push(S.codecs[0]),x.codecs[0].payloadType=P,x.headerExtensions=S.headerExtensions,x}function a(S,x){return x.codecs.some(F=>F.kind===S)}function s(S,x){if(f(S),S.codecs.length===0)return!1;const F=S.codecs[0];return x.codecs.some(I=>I.remotePayloadType===F.payloadType)}function e(S){const x=new RegExp("^(audio|video)/(.+)","i");if(typeof S!="object")throw new TypeError("codec is not an object");if(!S.mimeType||typeof S.mimeType!="string")throw new TypeError("missing codec.mimeType");const F=x.exec(S.mimeType);if(!F)throw new TypeError("invalid codec.mimeType");if(S.kind=F[1].toLowerCase(),S.preferredPayloadType&&typeof S.preferredPayloadType!="number")throw new TypeError("invalid codec.preferredPayloadType");if(typeof S.clockRate!="number")throw new TypeError("missing codec.clockRate");S.kind==="audio"?typeof S.channels!="number"&&(S.channels=1):delete S.channels,(!S.parameters||typeof S.parameters!="object")&&(S.parameters={});for(const I of Object.keys(S.parameters)){let N=S.parameters[I];if(N===void 0&&(S.parameters[I]="",N=""),typeof N!="string"&&typeof N!="number")throw new TypeError(`invalid codec parameter [key:${I}s, value:${N}]`);if(I==="apt"&&typeof N!="number")throw new TypeError("invalid codec apt parameter")}(!S.rtcpFeedback||!Array.isArray(S.rtcpFeedback))&&(S.rtcpFeedback=[]);for(const I of S.rtcpFeedback)r(I)}function r(S){if(typeof S!="object")throw new TypeError("fb is not an object");if(!S.type||typeof S.type!="string")throw new TypeError("missing fb.type");(!S.parameter||typeof S.parameter!="string")&&(S.parameter="")}function t(S){if(typeof S!="object")throw new TypeError("ext is not an object");if(S.kind!=="audio"&&S.kind!=="video")throw new TypeError("invalid ext.kind");if(!S.uri||typeof S.uri!="string")throw new TypeError("missing ext.uri");if(typeof S.preferredId!="number")throw new TypeError("missing ext.preferredId");if(S.preferredEncrypt&&typeof S.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(S.preferredEncrypt||(S.preferredEncrypt=!1),S.direction&&typeof S.direction!="string")throw new TypeError("invalid ext.direction");S.direction||(S.direction="sendrecv")}function i(S){const x=new RegExp("^(audio|video)/(.+)","i");if(typeof S!="object")throw new TypeError("codec is not an object");if(!S.mimeType||typeof S.mimeType!="string")throw new TypeError("missing codec.mimeType");const F=x.exec(S.mimeType);if(!F)throw new TypeError("invalid codec.mimeType");if(typeof S.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof S.clockRate!="number")throw new TypeError("missing codec.clockRate");F[1].toLowerCase()==="audio"?typeof S.channels!="number"&&(S.channels=1):delete S.channels,(!S.parameters||typeof S.parameters!="object")&&(S.parameters={});for(const N of Object.keys(S.parameters)){let V=S.parameters[N];if(V===void 0&&(S.parameters[N]="",V=""),typeof V!="string"&&typeof V!="number")throw new TypeError(`invalid codec parameter [key:${N}s, value:${V}]`);if(N==="apt"&&typeof V!="number")throw new TypeError("invalid codec apt parameter")}(!S.rtcpFeedback||!Array.isArray(S.rtcpFeedback))&&(S.rtcpFeedback=[]);for(const N of S.rtcpFeedback)r(N)}function o(S){if(typeof S!="object")throw new TypeError("ext is not an object");if(!S.uri||typeof S.uri!="string")throw new TypeError("missing ext.uri");if(typeof S.id!="number")throw new TypeError("missing ext.id");if(S.encrypt&&typeof S.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");S.encrypt||(S.encrypt=!1),(!S.parameters||typeof S.parameters!="object")&&(S.parameters={});for(const x of Object.keys(S.parameters)){let F=S.parameters[x];if(F===void 0&&(S.parameters[x]="",F=""),typeof F!="string"&&typeof F!="number")throw new TypeError("invalid header extension parameter")}}function d(S){if(typeof S!="object")throw new TypeError("encoding is not an object");if(S.ssrc&&typeof S.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(S.rid&&typeof S.rid!="string")throw new TypeError("invalid encoding.rid");if(S.rtx&&typeof S.rtx!="object")throw new TypeError("invalid encoding.rtx");if(S.rtx&&typeof S.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if((!S.dtx||typeof S.dtx!="boolean")&&(S.dtx=!1),S.scalabilityMode&&typeof S.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}function p(S){if(typeof S!="object")throw new TypeError("rtcp is not an object");if(S.cname&&typeof S.cname!="string")throw new TypeError("invalid rtcp.cname");(!S.reducedSize||typeof S.reducedSize!="boolean")&&(S.reducedSize=!0)}function m(S){if(typeof S!="object")throw new TypeError("numStreams is not an object");if(typeof S.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof S.MIS!="number")throw new TypeError("missing numStreams.MIS")}function l(S){return S?/.+\/rtx$/i.test(S.mimeType):!1}function b(S,x,{strict:F=!1,modify:I=!1}={}){const N=S.mimeType.toLowerCase(),V=x.mimeType.toLowerCase();if(N!==V||S.clockRate!==x.clockRate||S.channels!==x.channels)return!1;switch(N){case"video/h264":{if(F){const Q=S.parameters["packetization-mode"]??0,we=x.parameters["packetization-mode"]??0;if(Q!==we||!w.isSameProfile(S.parameters,x.parameters))return!1;let oe;try{oe=w.generateProfileLevelIdStringForAnswer(S.parameters,x.parameters)}catch{return!1}I&&(oe?(S.parameters["profile-level-id"]=oe,x.parameters["profile-level-id"]=oe):(delete S.parameters["profile-level-id"],delete x.parameters["profile-level-id"]))}break}case"video/vp9":{if(F){const Q=S.parameters["profile-id"]??0,we=x.parameters["profile-id"]??0;if(Q!==we)return!1}break}}return!0}function k(S,x){return!(S.kind&&x.kind&&S.kind!==x.kind||S.uri!==x.uri)}function L(S,x){const F=[];for(const I of S.rtcpFeedback??[]){const N=(x.rtcpFeedback??[]).find(V=>V.type===I.type&&(V.parameter===I.parameter||!V.parameter&&!I.parameter));N&&F.push(N)}return F}return ce}var bt={},qr={},yt={},St={},vr={exports:{}},$r,ys;function Rn(){if(ys)return $r;ys=1;var w=1e3,D=w*60,T=D*60,c=T*24,P=c*7,R=c*365.25;$r=function(h,n){n=n||{};var y=typeof h;if(y==="string"&&h.length>0)return f(h);if(y==="number"&&isFinite(h))return n.long?C(h):_(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))};function f(h){if(h=String(h),!(h.length>100)){var n=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(h);if(n){var y=parseFloat(n[1]),u=(n[2]||"ms").toLowerCase();switch(u){case"years":case"year":case"yrs":case"yr":case"y":return y*R;case"weeks":case"week":case"w":return y*P;case"days":case"day":case"d":return y*c;case"hours":case"hour":case"hrs":case"hr":case"h":return y*T;case"minutes":case"minute":case"mins":case"min":case"m":return y*D;case"seconds":case"second":case"secs":case"sec":case"s":return y*w;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return y;default:return}}}}function _(h){var n=Math.abs(h);return n>=c?Math.round(h/c)+"d":n>=T?Math.round(h/T)+"h":n>=D?Math.round(h/D)+"m":n>=w?Math.round(h/w)+"s":h+"ms"}function C(h){var n=Math.abs(h);return n>=c?g(h,n,c,"day"):n>=T?g(h,n,T,"hour"):n>=D?g(h,n,D,"minute"):n>=w?g(h,n,w,"second"):h+" ms"}function g(h,n,y,u){var v=n>=y*1.5;return Math.round(h/y)+" "+u+(v?"s":"")}return $r}var Ur,Ss;function Cn(){if(Ss)return Ur;Ss=1;function w(D){c.debug=c,c.default=c,c.coerce=g,c.disable=_,c.enable=R,c.enabled=C,c.humanize=Rn(),c.destroy=h,Object.keys(D).forEach(n=>{c[n]=D[n]}),c.names=[],c.skips=[],c.formatters={};function T(n){let y=0;for(let u=0;u<n.length;u++)y=(y<<5)-y+n.charCodeAt(u),y|=0;return c.colors[Math.abs(y)%c.colors.length]}c.selectColor=T;function c(n){let y,u=null,v,a;function s(...e){if(!s.enabled)return;const r=s,t=Number(new Date),i=t-(y||t);r.diff=i,r.prev=y,r.curr=t,y=t,e[0]=c.coerce(e[0]),typeof e[0]!="string"&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(p,m)=>{if(p==="%%")return"%";o++;const l=c.formatters[m];if(typeof l=="function"){const b=e[o];p=l.call(r,b),e.splice(o,1),o--}return p}),c.formatArgs.call(r,e),(r.log||c.log).apply(r,e)}return s.namespace=n,s.useColors=c.useColors(),s.color=c.selectColor(n),s.extend=P,s.destroy=c.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(v!==c.namespaces&&(v=c.namespaces,a=c.enabled(n)),a),set:e=>{u=e}}),typeof c.init=="function"&&c.init(s),s}function P(n,y){const u=c(this.namespace+(typeof y>"u"?":":y)+n);return u.log=this.log,u}function R(n){c.save(n),c.namespaces=n,c.names=[],c.skips=[];const y=(typeof n=="string"?n:"").trim().replace(" ",",").split(",").filter(Boolean);for(const u of y)u[0]==="-"?c.skips.push(u.slice(1)):c.names.push(u)}function f(n,y){let u=0,v=0,a=-1,s=0;for(;u<n.length;)if(v<y.length&&(y[v]===n[u]||y[v]==="*"))y[v]==="*"?(a=v,s=u,v++):(u++,v++);else if(a!==-1)v=a+1,s++,u=s;else return!1;for(;v<y.length&&y[v]==="*";)v++;return v===y.length}function _(){const n=[...c.names,...c.skips.map(y=>"-"+y)].join(",");return c.enable(""),n}function C(n){for(const y of c.skips)if(f(n,y))return!1;for(const y of c.names)if(f(n,y))return!0;return!1}function g(n){return n instanceof Error?n.stack||n.message:n}function h(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return c.enable(c.load()),c}return Ur=w,Ur}var Rs;function Tn(){return Rs||(Rs=1,function(w,D){var T={};D.formatArgs=P,D.save=R,D.load=f,D.useColors=c,D.storage=_(),D.destroy=(()=>{let g=!1;return()=>{g||(g=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),D.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function c(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let g;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(g=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(g[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function P(g){if(g[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+g[0]+(this.useColors?"%c ":" ")+"+"+w.exports.humanize(this.diff),!this.useColors)return;const h="color: "+this.color;g.splice(1,0,h,"color: inherit");let n=0,y=0;g[0].replace(/%[a-zA-Z%]/g,u=>{u!=="%%"&&(n++,u==="%c"&&(y=n))}),g.splice(y,0,h)}D.log=console.debug||console.log||(()=>{});function R(g){try{g?D.storage.setItem("debug",g):D.storage.removeItem("debug")}catch{}}function f(){let g;try{g=D.storage.getItem("debug")}catch{}return!g&&typeof process<"u"&&"env"in process&&(g=T.DEBUG),g}function _(){try{return localStorage}catch{}}w.exports=Cn()(D);const{formatters:C}=w.exports;C.j=function(g){try{return JSON.stringify(g)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}}(vr,vr.exports)),vr.exports}var Cs;function Dn(){if(Cs)return St;Cs=1,Object.defineProperty(St,"__esModule",{value:!0}),St.Logger=void 0;const w=Tn(),D="awaitqueue";let T=class{constructor(P){E(this,"_debug");E(this,"_warn");E(this,"_error");P?(this._debug=w(`${D}:${P}`),this._warn=w(`${D}:WARN:${P}`),this._error=w(`${D}:ERROR:${P}`)):(this._debug=w(D),this._warn=w(`${D}:WARN`),this._error=w(`${D}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};return St.Logger=T,St}var We={},Ts;function Ii(){if(Ts)return We;Ts=1,Object.defineProperty(We,"__esModule",{value:!0}),We.AwaitQueueRemovedTaskError=We.AwaitQueueStoppedError=void 0;class w extends Error{constructor(c){super(c??"queue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,w)}}We.AwaitQueueStoppedError=w;class D extends Error{constructor(c){super(c??"queue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,D)}}return We.AwaitQueueRemovedTaskError=D,We}var Ds;function Pn(){if(Ds)return yt;Ds=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.AwaitQueue=void 0;const w=Dn(),D=Ii(),T=new w.Logger("AwaitQueue");let c=class{constructor(){E(this,"pendingTasks",new Map);E(this,"nextTaskId",0);E(this,"stopping",!1);T.debug("constructor()")}get size(){return this.pendingTasks.size}async push(R,f){if(f=f??R.name,T.debug(`push() [name:${f}]`),typeof R!="function")throw new TypeError("given task is not a function");if(f)try{Object.defineProperty(R,"name",{value:f})}catch{}return new Promise((_,C)=>{const g={id:this.nextTaskId++,task:R,name:f,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:h=>{if(g.completed)return;g.completed=!0,this.pendingTasks.delete(g.id),T.debug(`resolving task [name:${g.name}]`),_(h);const[n]=this.pendingTasks.values();n&&!n.executedAt&&this.execute(n)},reject:h=>{if(!g.completed&&(g.completed=!0,this.pendingTasks.delete(g.id),T.debug(`rejecting task [name:${g.name}]: %s`,String(h)),C(h),!this.stopping)){const[n]=this.pendingTasks.values();n&&!n.executedAt&&this.execute(n)}}};this.pendingTasks.set(g.id,g),this.pendingTasks.size===1&&this.execute(g)})}stop(){T.debug("stop()"),this.stopping=!0;for(const R of this.pendingTasks.values())T.debug(`stop() | stopping task [name:${R.name}]`),R.reject(new D.AwaitQueueStoppedError);this.stopping=!1}remove(R){T.debug(`remove() [taskIdx:${R}]`);const f=Array.from(this.pendingTasks.values())[R];if(!f){T.debug(`stop() | no task with given idx [taskIdx:${R}]`);return}f.reject(new D.AwaitQueueRemovedTaskError)}dump(){const R=Date.now();let f=0;return Array.from(this.pendingTasks.values()).map(_=>({idx:f++,task:_.task,name:_.name,enqueuedTime:_.executedAt?_.executedAt-_.enqueuedAt:R-_.enqueuedAt,executionTime:_.executedAt?R-_.executedAt:0}))}async execute(R){if(T.debug(`execute() [name:${R.name}]`),R.executedAt)throw new Error("task already being executed");R.executedAt=Date.now();try{const f=await R.task();R.resolve(f)}catch(f){R.reject(f)}}};return yt.AwaitQueue=c,yt}var Ps;function En(){return Ps||(Ps=1,function(w){Object.defineProperty(w,"__esModule",{value:!0}),w.AwaitQueueRemovedTaskError=w.AwaitQueueStoppedError=w.AwaitQueue=void 0;var D=Pn();Object.defineProperty(w,"AwaitQueue",{enumerable:!0,get:function(){return D.AwaitQueue}});var T=Ii();Object.defineProperty(w,"AwaitQueueStoppedError",{enumerable:!0,get:function(){return T.AwaitQueueStoppedError}}),Object.defineProperty(w,"AwaitQueueRemovedTaskError",{enumerable:!0,get:function(){return T.AwaitQueueRemovedTaskError}})}(qr)),qr}var Rt={},Es;function Mi(){if(Es)return Rt;Es=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.Producer=void 0;const w=J(),D=Be(),T=ne(),c=new w.Logger("Producer");let P=class extends D.EnhancedEventEmitter{constructor({id:_,localId:C,rtpSender:g,track:h,rtpParameters:n,stopTracks:y,disableTrackOnPause:u,zeroRtpOnPause:v,appData:a}){super();E(this,"_id");E(this,"_localId");E(this,"_closed",!1);E(this,"_rtpSender");E(this,"_track");E(this,"_kind");E(this,"_rtpParameters");E(this,"_paused");E(this,"_maxSpatialLayer");E(this,"_stopTracks");E(this,"_disableTrackOnPause");E(this,"_zeroRtpOnPause");E(this,"_appData");E(this,"_observer",new D.EnhancedEventEmitter);c.debug("constructor()"),this._id=_,this._localId=C,this._rtpSender=g,this._track=h,this._kind=h.kind,this._rtpParameters=n,this._paused=u?!h.enabled:!1,this._maxSpatialLayer=void 0,this._stopTracks=y,this._disableTrackOnPause=u,this._zeroRtpOnPause=v,this._appData=a??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(_){this._appData=_}get observer(){return this._observer}close(){this._closed||(c.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(c.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new T.InvalidStateError("closed");return new Promise((_,C)=>{this.safeEmit("@getstats",_,C)})}pause(){if(c.debug("pause()"),this._closed){c.error("pause() | Producer closed");return}this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((_,C)=>{this.safeEmit("@pause",_,C)}).catch(()=>{}),this._observer.safeEmit("pause")}resume(){if(c.debug("resume()"),this._closed){c.error("resume() | Producer closed");return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((_,C)=>{this.safeEmit("@resume",_,C)}).catch(()=>{}),this._observer.safeEmit("resume")}async replaceTrack({track:_}){if(c.debug("replaceTrack() [track:%o]",_),this._closed){if(_&&this._stopTracks)try{_.stop()}catch{}throw new T.InvalidStateError("closed")}else if(_&&_.readyState==="ended")throw new T.InvalidStateError("track ended");if(_===this._track){c.debug("replaceTrack() | same track, ignored");return}await new Promise((C,g)=>{this.safeEmit("@replacetrack",_,C,g)}),this.destroyTrack(),this._track=_,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()}async setMaxSpatialLayer(_){if(this._closed)throw new T.InvalidStateError("closed");if(this._kind!=="video")throw new T.UnsupportedError("not a video Producer");if(typeof _!="number")throw new TypeError("invalid spatialLayer");_!==this._maxSpatialLayer&&(await new Promise((C,g)=>{this.safeEmit("@setmaxspatiallayer",_,C,g)}).catch(()=>{}),this._maxSpatialLayer=_)}async setRtpEncodingParameters(_){if(this._closed)throw new T.InvalidStateError("closed");if(typeof _!="object")throw new TypeError("invalid params");await new Promise((C,g)=>{this.safeEmit("@setrtpencodingparameters",_,C,g)})}onTrackEnded(){c.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch{}}};return Rt.Producer=P,Rt}var Ct={},ks;function Oi(){if(ks)return Ct;ks=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.Consumer=void 0;const w=J(),D=Be(),T=ne(),c=new w.Logger("Consumer");let P=class extends D.EnhancedEventEmitter{constructor({id:_,localId:C,producerId:g,rtpReceiver:h,track:n,rtpParameters:y,appData:u}){super();E(this,"_id");E(this,"_localId");E(this,"_producerId");E(this,"_closed",!1);E(this,"_rtpReceiver");E(this,"_track");E(this,"_rtpParameters");E(this,"_paused");E(this,"_appData");E(this,"_observer",new D.EnhancedEventEmitter);c.debug("constructor()"),this._id=_,this._localId=C,this._producerId=g,this._rtpReceiver=h,this._track=n,this._rtpParameters=y,this._paused=!n.enabled,this._appData=u??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(_){this._appData=_}get observer(){return this._observer}close(){this._closed||(c.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(c.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new T.InvalidStateError("closed");return new Promise((_,C)=>{this.safeEmit("@getstats",_,C)})}pause(){if(c.debug("pause()"),this._closed){c.error("pause() | Consumer closed");return}if(this._paused){c.debug("pause() | Consumer is already paused");return}this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause")}resume(){if(c.debug("resume()"),this._closed){c.error("resume() | Consumer closed");return}if(!this._paused){c.debug("resume() | Consumer is already resumed");return}this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")}onTrackEnded(){c.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch{}}};return Ct.Consumer=P,Ct}var Tt={},Ls;function Fi(){if(Ls)return Tt;Ls=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.DataProducer=void 0;const w=J(),D=Be(),T=ne(),c=new w.Logger("DataProducer");let P=class extends D.EnhancedEventEmitter{constructor({id:_,dataChannel:C,sctpStreamParameters:g,appData:h}){super();E(this,"_id");E(this,"_dataChannel");E(this,"_closed",!1);E(this,"_sctpStreamParameters");E(this,"_appData");E(this,"_observer",new D.EnhancedEventEmitter);c.debug("constructor()"),this._id=_,this._dataChannel=C,this._sctpStreamParameters=g,this._appData=h??{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(_){this._dataChannel.bufferedAmountLowThreshold=_}get appData(){return this._appData}set appData(_){this._appData=_}get observer(){return this._observer}close(){this._closed||(c.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(c.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(_){if(c.debug("send()"),this._closed)throw new T.InvalidStateError("closed");this._dataChannel.send(_)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(c.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",_=>{if(this._closed)return;let{error:C}=_;C||(C=new Error("unknown DataChannel error")),C.errorDetail==="sctp-failure"?c.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",C.sctpCauseCode,C.message):c.error('DataChannel "error" event: %o',C),this.safeEmit("error",C)}),this._dataChannel.addEventListener("close",()=>{this._closed||(c.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||c.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}};return Tt.DataProducer=P,Tt}var Dt={},xs;function Ai(){if(xs)return Dt;xs=1,Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.DataConsumer=void 0;const w=J(),D=Be(),T=new w.Logger("DataConsumer");let c=class extends D.EnhancedEventEmitter{constructor({id:f,dataProducerId:_,dataChannel:C,sctpStreamParameters:g,appData:h}){super();E(this,"_id");E(this,"_dataProducerId");E(this,"_dataChannel");E(this,"_closed",!1);E(this,"_sctpStreamParameters");E(this,"_appData");E(this,"_observer",new D.EnhancedEventEmitter);T.debug("constructor()"),this._id=f,this._dataProducerId=_,this._dataChannel=C,this._sctpStreamParameters=g,this._appData=h??{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(f){this._dataChannel.binaryType=f}get appData(){return this._appData}set appData(f){this._appData=f}get observer(){return this._observer}close(){this._closed||(T.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(T.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(T.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",f=>{if(this._closed)return;let{error:_}=f;_||(_=new Error("unknown DataChannel error")),_.errorDetail==="sctp-failure"?T.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",_.sctpCauseCode,_.message):T.error('DataChannel "error" event: %o',_),this.safeEmit("error",_)}),this._dataChannel.addEventListener("close",()=>{this._closed||(T.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",f=>{this._closed||this.safeEmit("message",f.data)})}};return Dt.DataConsumer=c,Dt}var Is;function Ni(){if(Is)return bt;Is=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.Transport=void 0;const w=En(),D=J(),T=Be(),c=ne(),P=re(),R=ae(),f=Mi(),_=Oi(),C=Fi(),g=Ai(),h=new D.Logger("Transport");class n{constructor(v){E(this,"consumerOptions");E(this,"promise");E(this,"resolve");E(this,"reject");this.consumerOptions=v,this.promise=new Promise((a,s)=>{this.resolve=a,this.reject=s})}}let y=class extends T.EnhancedEventEmitter{constructor({direction:a,id:s,iceParameters:e,iceCandidates:r,dtlsParameters:t,sctpParameters:i,iceServers:o,iceTransportPolicy:d,additionalSettings:p,proprietaryConstraints:m,appData:l,handlerFactory:b,extendedRtpCapabilities:k,canProduceByKind:L}){super();E(this,"_id");E(this,"_closed",!1);E(this,"_direction");E(this,"_extendedRtpCapabilities");E(this,"_canProduceByKind");E(this,"_maxSctpMessageSize");E(this,"_handler");E(this,"_iceGatheringState","new");E(this,"_connectionState","new");E(this,"_appData");E(this,"_producers",new Map);E(this,"_consumers",new Map);E(this,"_dataProducers",new Map);E(this,"_dataConsumers",new Map);E(this,"_probatorConsumerCreated",!1);E(this,"_awaitQueue",new w.AwaitQueue);E(this,"_pendingConsumerTasks",[]);E(this,"_consumerCreationInProgress",!1);E(this,"_pendingPauseConsumers",new Map);E(this,"_consumerPauseInProgress",!1);E(this,"_pendingResumeConsumers",new Map);E(this,"_consumerResumeInProgress",!1);E(this,"_pendingCloseConsumers",new Map);E(this,"_consumerCloseInProgress",!1);E(this,"_observer",new T.EnhancedEventEmitter);h.debug("constructor() [id:%s, direction:%s]",s,a),this._id=s,this._direction=a,this._extendedRtpCapabilities=k,this._canProduceByKind=L,this._maxSctpMessageSize=i?i.maxMessageSize:null;const S=P.clone(p)??{};delete S.iceServers,delete S.iceTransportPolicy,delete S.bundlePolicy,delete S.rtcpMuxPolicy,delete S.sdpSemantics,this._handler=b(),this._handler.run({direction:a,iceParameters:e,iceCandidates:r,dtlsParameters:t,sctpParameters:i,iceServers:o,iceTransportPolicy:d,additionalSettings:S,proprietaryConstraints:m,extendedRtpCapabilities:k}),this._appData=l??{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get iceGatheringState(){return this._iceGatheringState}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(a){this._appData=a}get observer(){return this._observer}close(){if(!this._closed){h.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";for(const a of this._producers.values())a.transportClosed();this._producers.clear();for(const a of this._consumers.values())a.transportClosed();this._consumers.clear();for(const a of this._dataProducers.values())a.transportClosed();this._dataProducers.clear();for(const a of this._dataConsumers.values())a.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new c.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:a}){if(h.debug("restartIce()"),this._closed)throw new c.InvalidStateError("closed");if(!a)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>await this._handler.restartIce(a),"transport.restartIce()")}async updateIceServers({iceServers:a}={}){if(h.debug("updateIceServers()"),this._closed)throw new c.InvalidStateError("closed");if(!Array.isArray(a))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(a),"transport.updateIceServers()")}async produce({track:a,encodings:s,codecOptions:e,codec:r,stopTracks:t=!0,disableTrackOnPause:i=!0,zeroRtpOnPause:o=!1,onRtpSender:d,appData:p={}}={}){if(h.debug("produce() [track:%o]",a),this._closed)throw new c.InvalidStateError("closed");if(a){if(this._direction!=="send")throw new c.UnsupportedError("not a sending Transport");if(this._canProduceByKind[a.kind]){if(a.readyState==="ended")throw new c.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(p&&typeof p!="object")throw new TypeError("if given, appData must be an object")}else throw new c.UnsupportedError(`cannot produce ${a.kind}`)}else throw new TypeError("missing track");return this._awaitQueue.push(async()=>{let m;if(s&&!Array.isArray(s))throw TypeError("encodings must be an array");s&&s.length===0?m=void 0:s&&(m=s.map(L=>{const S={active:!0};return L.active===!1&&(S.active=!1),typeof L.dtx=="boolean"&&(S.dtx=L.dtx),typeof L.scalabilityMode=="string"&&(S.scalabilityMode=L.scalabilityMode),typeof L.scaleResolutionDownBy=="number"&&(S.scaleResolutionDownBy=L.scaleResolutionDownBy),typeof L.maxBitrate=="number"&&(S.maxBitrate=L.maxBitrate),typeof L.maxFramerate=="number"&&(S.maxFramerate=L.maxFramerate),typeof L.adaptivePtime=="boolean"&&(S.adaptivePtime=L.adaptivePtime),typeof L.priority=="string"&&(S.priority=L.priority),typeof L.networkPriority=="string"&&(S.networkPriority=L.networkPriority),S}));const{localId:l,rtpParameters:b,rtpSender:k}=await this._handler.send({track:a,encodings:m,codecOptions:e,codec:r,onRtpSender:d});try{R.validateRtpParameters(b);const{id:L}=await new Promise((x,F)=>{this.safeEmit("produce",{kind:a.kind,rtpParameters:b,appData:p},x,F)}),S=new f.Producer({id:L,localId:l,rtpSender:k,track:a,rtpParameters:b,stopTracks:t,disableTrackOnPause:i,zeroRtpOnPause:o,appData:p});return this._producers.set(S.id,S),this.handleProducer(S),this._observer.safeEmit("newproducer",S),S}catch(L){throw this._handler.stopSending(l).catch(()=>{}),L}},"transport.produce()").catch(m=>{if(t)try{a.stop()}catch{}throw m})}async consume({id:a,producerId:s,kind:e,rtpParameters:r,streamId:t,onRtpReceiver:i,appData:o={}}){if(h.debug("consume()"),this._closed)throw new c.InvalidStateError("closed");if(this._direction!=="recv")throw new c.UnsupportedError("not a receiving Transport");if(typeof a!="string")throw new TypeError("missing id");if(typeof s!="string")throw new TypeError("missing producerId");if(e!=="audio"&&e!=="video")throw new TypeError(`invalid kind '${e}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(o&&typeof o!="object")throw new TypeError("if given, appData must be an object");const d=P.clone(r);if(!R.canReceive(d,this._extendedRtpCapabilities))throw new c.UnsupportedError("cannot consume this Producer");const m=new n({id:a,producerId:s,kind:e,rtpParameters:d,streamId:t,onRtpReceiver:i,appData:o});return this._pendingConsumerTasks.push(m),queueMicrotask(()=>{this._closed||this._consumerCreationInProgress===!1&&this.createPendingConsumers()}),m.promise}async produceData({ordered:a=!0,maxPacketLifeTime:s,maxRetransmits:e,label:r="",protocol:t="",appData:i={}}={}){if(h.debug("produceData()"),this._closed)throw new c.InvalidStateError("closed");if(this._direction!=="send")throw new c.UnsupportedError("not a sending Transport");if(this._maxSctpMessageSize){if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(i&&typeof i!="object")throw new TypeError("if given, appData must be an object")}else throw new c.UnsupportedError("SCTP not enabled by remote Transport");return(s||e)&&(a=!1),this._awaitQueue.push(async()=>{const{dataChannel:o,sctpStreamParameters:d}=await this._handler.sendDataChannel({ordered:a,maxPacketLifeTime:s,maxRetransmits:e,label:r,protocol:t});R.validateSctpStreamParameters(d);const{id:p}=await new Promise((l,b)=>{this.safeEmit("producedata",{sctpStreamParameters:d,label:r,protocol:t,appData:i},l,b)}),m=new C.DataProducer({id:p,dataChannel:o,sctpStreamParameters:d,appData:i});return this._dataProducers.set(m.id,m),this.handleDataProducer(m),this._observer.safeEmit("newdataproducer",m),m},"transport.produceData()")}async consumeData({id:a,dataProducerId:s,sctpStreamParameters:e,label:r="",protocol:t="",appData:i={}}){if(h.debug("consumeData()"),this._closed)throw new c.InvalidStateError("closed");if(this._direction!=="recv")throw new c.UnsupportedError("not a receiving Transport");if(this._maxSctpMessageSize){if(typeof a!="string")throw new TypeError("missing id");if(typeof s!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(i&&typeof i!="object")throw new TypeError("if given, appData must be an object")}else throw new c.UnsupportedError("SCTP not enabled by remote Transport");const o=P.clone(e);return R.validateSctpStreamParameters(o),this._awaitQueue.push(async()=>{const{dataChannel:d}=await this._handler.receiveDataChannel({sctpStreamParameters:o,label:r,protocol:t}),p=new g.DataConsumer({id:a,dataProducerId:s,dataChannel:d,sctpStreamParameters:o,appData:i});return this._dataConsumers.set(p.id,p),this.handleDataConsumer(p),this._observer.safeEmit("newdataconsumer",p),p},"transport.consumeData()")}async createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingConsumerTasks.length===0){h.debug("createPendingConsumers() | there is no Consumer to be created");return}const a=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let s;const e=[];for(const r of a){const{id:t,kind:i,rtpParameters:o,streamId:d,onRtpReceiver:p}=r.consumerOptions;e.push({trackId:t,kind:i,rtpParameters:o,streamId:d,onRtpReceiver:p})}try{const r=await this._handler.receive(e);for(let t=0;t<r.length;++t){const i=a[t],o=r[t],{id:d,producerId:p,kind:m,rtpParameters:l,appData:b}=i.consumerOptions,{localId:k,rtpReceiver:L,track:S}=o,x=new _.Consumer({id:d,localId:k,producerId:p,rtpReceiver:L,track:S,rtpParameters:l,appData:b});this._consumers.set(x.id,x),this.handleConsumer(x),!this._probatorConsumerCreated&&!s&&m==="video"&&(s=x),this._observer.safeEmit("newconsumer",x),i.resolve(x)}}catch(r){for(const t of a)t.reject(r)}if(s)try{const r=R.generateProbatorRtpParameters(s.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:r}]),h.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(r){h.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",r)}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingPauseConsumers.size===0){h.debug("pausePendingConsumers() | there is no Consumer to be paused");return}const a=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const s=a.map(e=>e.localId);await this._handler.pauseReceiving(s)}catch(s){h.error("pausePendingConsumers() | failed to pause Consumers:",s)}},"transport.pausePendingConsumers").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingResumeConsumers.size===0){h.debug("resumePendingConsumers() | there is no Consumer to be resumed");return}const a=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const s=a.map(e=>e.localId);await this._handler.resumeReceiving(s)}catch(s){h.error("resumePendingConsumers() | failed to resume Consumers:",s)}},"transport.resumePendingConsumers").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingCloseConsumers.size===0){h.debug("closePendingConsumers() | there is no Consumer to be closed");return}const a=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(a.map(s=>s.localId))}catch(s){h.error("closePendingConsumers() | failed to close Consumers:",s)}},"transport.closePendingConsumers").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){const a=this._handler;a.on("@connect",({dtlsParameters:s},e,r)=>{if(this._closed){r(new c.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:s},e,r)}),a.on("@icegatheringstatechange",s=>{s!==this._iceGatheringState&&(h.debug("ICE gathering state changed to %s",s),this._iceGatheringState=s,this._closed||this.safeEmit("icegatheringstatechange",s))}),a.on("@icecandidateerror",s=>{h.warn(`ICE candidate error [url:${s.url}, localAddress:${s.address}, localPort:${s.port}]: ${s.errorCode} "${s.errorText}"`),this.safeEmit("icecandidateerror",s)}),a.on("@connectionstatechange",s=>{s!==this._connectionState&&(h.debug("connection state changed to %s",s),this._connectionState=s,this._closed||this.safeEmit("connectionstatechange",s))})}handleProducer(a){a.on("@close",()=>{this._producers.delete(a.id),!this._closed&&this._awaitQueue.push(async()=>await this._handler.stopSending(a.localId),"producer @close event").catch(s=>h.warn("producer.close() failed:%o",s))}),a.on("@pause",(s,e)=>{this._awaitQueue.push(async()=>await this._handler.pauseSending(a.localId),"producer @pause event").then(s).catch(e)}),a.on("@resume",(s,e)=>{this._awaitQueue.push(async()=>await this._handler.resumeSending(a.localId),"producer @resume event").then(s).catch(e)}),a.on("@replacetrack",(s,e,r)=>{this._awaitQueue.push(async()=>await this._handler.replaceTrack(a.localId,s),"producer @replacetrack event").then(e).catch(r)}),a.on("@setmaxspatiallayer",(s,e,r)=>{this._awaitQueue.push(async()=>await this._handler.setMaxSpatialLayer(a.localId,s),"producer @setmaxspatiallayer event").then(e).catch(r)}),a.on("@setrtpencodingparameters",(s,e,r)=>{this._awaitQueue.push(async()=>await this._handler.setRtpEncodingParameters(a.localId,s),"producer @setrtpencodingparameters event").then(e).catch(r)}),a.on("@getstats",(s,e)=>{if(this._closed)return e(new c.InvalidStateError("closed"));this._handler.getSenderStats(a.localId).then(s).catch(e)})}handleConsumer(a){a.on("@close",()=>{this._consumers.delete(a.id),this._pendingPauseConsumers.delete(a.id),this._pendingResumeConsumers.delete(a.id),!this._closed&&(this._pendingCloseConsumers.set(a.id,a),this._consumerCloseInProgress===!1&&this.closePendingConsumers())}),a.on("@pause",()=>{this._pendingResumeConsumers.has(a.id)&&this._pendingResumeConsumers.delete(a.id),this._pendingPauseConsumers.set(a.id,a),queueMicrotask(()=>{this._closed||this._consumerPauseInProgress===!1&&this.pausePendingConsumers()})}),a.on("@resume",()=>{this._pendingPauseConsumers.has(a.id)&&this._pendingPauseConsumers.delete(a.id),this._pendingResumeConsumers.set(a.id,a),queueMicrotask(()=>{this._closed||this._consumerResumeInProgress===!1&&this.resumePendingConsumers()})}),a.on("@getstats",(s,e)=>{if(this._closed)return e(new c.InvalidStateError("closed"));this._handler.getReceiverStats(a.localId).then(s).catch(e)})}handleDataProducer(a){a.on("@close",()=>{this._dataProducers.delete(a.id)})}handleDataConsumer(a){a.on("@close",()=>{this._dataConsumers.delete(a.id)})}};return bt.Transport=y,bt}var Pt={},be={},zr={},Hr={exports:{}},Ms;function Yr(){if(Ms)return Hr.exports;Ms=1;var w=Hr.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(D){return D.encoding?"rtpmap:%d %s/%s/%s":D.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(D){return D.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(D){return D.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(D){return"extmap:%d"+(D.direction?"/%s":"%v")+(D["encrypt-uri"]?" %s":"%v")+" %s"+(D.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(D){return D.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(D){var T="candidate:%s %d %s %d %s %d typ %s";return T+=D.raddr!=null?" raddr %s rport %d":"%v%v",T+=D.tcptype!=null?" tcptype %s":"%v",D.generation!=null&&(T+=" generation %d"),T+=D["network-id"]!=null?" network-id %d":"%v",T+=D["network-cost"]!=null?" network-cost %d":"%v",T}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(D){var T="ssrc:%d";return D.attribute!=null&&(T+=" %s",D.value!=null&&(T+=":%s")),T}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(D){return D.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(D){return D.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(D){return"imageattr:%s %s %s"+(D.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(D){return"simulcast:%s %s"+(D.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(D){return"ts-refclk:%s"+(D.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(D){var T="mediaclk:";return T+=D.id!=null?"id=%s %s":"%v%s",T+=D.mediaClockValue!=null?"=%s":"",T+=D.rateNumerator!=null?" rate=%s":"",T+=D.rateDenominator!=null?"/%s":"",T}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(w).forEach(function(D){var T=w[D];T.forEach(function(c){c.reg||(c.reg=/(.*)/),c.format||(c.format="%s")})}),Hr.exports}var Os;function kn(){return Os||(Os=1,function(w){var D=function(_){return String(Number(_))===_?Number(_):_},T=function(_,C,g,h){if(h&&!g)C[h]=D(_[1]);else for(var n=0;n<g.length;n+=1)_[n+1]!=null&&(C[g[n]]=D(_[n+1]))},c=function(_,C,g){var h=_.name&&_.names;_.push&&!C[_.push]?C[_.push]=[]:h&&!C[_.name]&&(C[_.name]={});var n=_.push?{}:h?C[_.name]:C;T(g.match(_.reg),n,_.names,_.name),_.push&&C[_.push].push(n)},P=Yr(),R=RegExp.prototype.test.bind(/^([a-z])=(.*)/);w.parse=function(_){var C={},g=[],h=C;return _.split(/(\r\n|\r|\n)/).filter(R).forEach(function(n){var y=n[0],u=n.slice(2);y==="m"&&(g.push({rtp:[],fmtp:[]}),h=g[g.length-1]);for(var v=0;v<(P[y]||[]).length;v+=1){var a=P[y][v];if(a.reg.test(u))return c(a,h,u)}}),C.media=g,C};var f=function(_,C){var g=C.split(/=(.+)/,2);return g.length===2?_[g[0]]=D(g[1]):g.length===1&&C.length>1&&(_[g[0]]=void 0),_};w.parseParams=function(_){return _.split(/;\s?/).reduce(f,{})},w.parseFmtpConfig=w.parseParams,w.parsePayloads=function(_){return _.toString().split(" ").map(Number)},w.parseRemoteCandidates=function(_){for(var C=[],g=_.split(" ").map(D),h=0;h<g.length;h+=3)C.push({component:g[h],ip:g[h+1],port:g[h+2]});return C},w.parseImageAttributes=function(_){return _.split(" ").map(function(C){return C.substring(1,C.length-1).split(",").reduce(f,{})})},w.parseSimulcastStreamList=function(_){return _.split(";").map(function(C){return C.split(",").map(function(g){var h,n=!1;return g[0]!=="~"?h=D(g):(h=D(g.substring(1,g.length)),n=!0),{scid:h,paused:n}})})}}(zr)),zr}var Vr,Fs;function Ln(){if(Fs)return Vr;Fs=1;var w=Yr(),D=/%[sdv%]/g,T=function(f){var _=1,C=arguments,g=C.length;return f.replace(D,function(h){if(_>=g)return h;var n=C[_];switch(_+=1,h){case"%%":return"%";case"%s":return String(n);case"%d":return Number(n);case"%v":return""}})},c=function(f,_,C){var g=_.format instanceof Function?_.format(_.push?C:C[_.name]):_.format,h=[f+"="+g];if(_.names)for(var n=0;n<_.names.length;n+=1){var y=_.names[n];_.name?h.push(C[_.name][y]):h.push(C[_.names[n]])}else h.push(C[_.name]);return T.apply(null,h)},P=["v","o","s","i","u","e","p","c","b","t","r","z","a"],R=["i","c","b","a"];return Vr=function(f,_){_=_||{},f.version==null&&(f.version=0),f.name==null&&(f.name=" "),f.media.forEach(function(n){n.payloads==null&&(n.payloads="")});var C=_.outerOrder||P,g=_.innerOrder||R,h=[];return C.forEach(function(n){w[n].forEach(function(y){y.name in f&&f[y.name]!=null?h.push(c(n,y,f)):y.push in f&&f[y.push]!=null&&f[y.push].forEach(function(u){h.push(c(n,y,u))})})}),f.media.forEach(function(n){h.push(c("m",w.m[0],n)),g.forEach(function(y){w[y].forEach(function(u){u.name in n&&n[u.name]!=null?h.push(c(y,u,n)):u.push in n&&n[u.push]!=null&&n[u.push].forEach(function(v){h.push(c(y,u,v))})})})}),h.join(`\r
`)+`\r
`},Vr}var As;function fe(){if(As)return be;As=1;var w=kn(),D=Ln(),T=Yr();return be.grammar=T,be.write=D,be.parse=w.parse,be.parseParams=w.parseParams,be.parseFmtpConfig=w.parseFmtpConfig,be.parsePayloads=w.parsePayloads,be.parseRemoteCandidates=w.parseRemoteCandidates,be.parseImageAttributes=w.parseImageAttributes,be.parseSimulcastStreamList=w.parseSimulcastStreamList,be}var Qe={},Ns;function ye(){if(Ns)return Qe;Ns=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.extractRtpCapabilities=D,Qe.extractDtlsParameters=T,Qe.getCname=c,Qe.applyCodecParameters=P;const w=fe();function D({sdpObject:R}){const f=new Map,_=[];let C=!1,g=!1;for(const n of R.media){const y=n.type;switch(y){case"audio":{if(C)continue;C=!0;break}case"video":{if(g)continue;g=!0;break}default:continue}for(const u of n.rtp){const v={kind:y,mimeType:`${y}/${u.codec}`,preferredPayloadType:u.payload,clockRate:u.rate,channels:u.encoding,parameters:{},rtcpFeedback:[]};f.set(v.preferredPayloadType,v)}for(const u of n.fmtp??[]){const v=w.parseParams(u.config),a=f.get(u.payload);a&&(v!=null&&v.hasOwnProperty("profile-level-id")&&(v["profile-level-id"]=String(v["profile-level-id"])),a.parameters=v)}for(const u of n.rtcpFb??[]){const v={type:u.type,parameter:u.subtype};if(v.parameter||delete v.parameter,u.payload!=="*"){const a=f.get(u.payload);if(!a)continue;a.rtcpFeedback.push(v)}else for(const a of f.values())a.kind===y&&!/.+\/rtx$/i.test(a.mimeType)&&a.rtcpFeedback.push(v)}for(const u of n.ext??[]){if(u["encrypt-uri"])continue;const v={kind:y,uri:u.uri,preferredId:u.value};_.push(v)}}return{codecs:Array.from(f.values()),headerExtensions:_}}function T({sdpObject:R}){let f=R.setup,_=R.fingerprint;if(!f||!_){const h=(R.media??[]).find(n=>n.port!==0);h&&(f??(f=h.setup),_??(_=h.fingerprint))}if(f){if(!_)throw new Error("no a=fingerprint found at SDP session or media level")}else throw new Error("no a=setup found at SDP session or media level");let C;switch(f){case"active":{C="client";break}case"passive":{C="server";break}case"actpass":{C="auto";break}}return{role:C,fingerprints:[{algorithm:_.type,value:_.hash}]}}function c({offerMediaObject:R}){const f=(R.ssrcs??[]).find(_=>_.attribute==="cname");return f?f.value:""}function P({offerRtpParameters:R,answerMediaObject:f}){for(const _ of R.codecs){const C=_.mimeType.toLowerCase();if(C!=="audio/opus"||!(f.rtp??[]).find(y=>y.payload===_.payloadType))continue;f.fmtp=f.fmtp??[];let h=f.fmtp.find(y=>y.payload===_.payloadType);h||(h={payload:_.payloadType,config:""},f.fmtp.push(h));const n=w.parseParams(h.config);switch(C){case"audio/opus":{const y=_.parameters["sprop-stereo"];y!==void 0&&(n.stereo=Number(y)?1:0);break}}h.config="";for(const y of Object.keys(n))h.config&&(h.config+=";"),h.config+=`${y}=${n[y]}`}}return Qe}var Et={},js;function Ye(){if(js)return Et;js=1,Object.defineProperty(Et,"__esModule",{value:!0}),Et.getRtpEncodings=w,Et.addLegacySimulcast=D;function w({offerMediaObject:T}){const c=new Set;for(const f of T.ssrcs??[]){const _=f.id;c.add(_)}if(c.size===0)throw new Error("no a=ssrc lines found");const P=new Map;for(const f of T.ssrcGroups??[]){if(f.semantics!=="FID")continue;let[_,C]=f.ssrcs.split(/\s+/);_=Number(_),C=Number(C),c.has(_)&&(c.delete(_),c.delete(C),P.set(_,C))}for(const f of c)P.set(f,null);const R=[];for(const[f,_]of P){const C={ssrc:f};_&&(C.rtx={ssrc:_}),R.push(C)}return R}function D({offerMediaObject:T,numStreams:c}){if(c<=1)throw new TypeError("numStreams must be greater than 1");const P=(T.ssrcs??[]).find(u=>u.attribute==="msid");if(!P)throw new Error("a=ssrc line with msid information not found");const[R,f]=P.value.split(" "),_=Number(P.id);let C;(T.ssrcGroups??[]).some(u=>{if(u.semantics!=="FID")return!1;const v=u.ssrcs.split(/\s+/);return Number(v[0])===_?(C=Number(v[1]),!0):!1});const g=T.ssrcs.find(u=>u.attribute==="cname");if(!g)throw new Error("a=ssrc line with cname information not found");const h=g.value,n=[],y=[];for(let u=0;u<c;++u)n.push(_+u),C&&y.push(C+u);T.ssrcGroups=[],T.ssrcs=[],T.ssrcGroups.push({semantics:"SIM",ssrcs:n.join(" ")});for(const u of n)T.ssrcs.push({id:u,attribute:"cname",value:h}),T.ssrcs.push({id:u,attribute:"msid",value:`${R} ${f}`});for(let u=0;u<y.length;++u){const v=n[u],a=y[u];T.ssrcs.push({id:a,attribute:"cname",value:h}),T.ssrcs.push({id:a,attribute:"msid",value:`${R} ${f}`}),T.ssrcGroups.push({semantics:"FID",ssrcs:`${v} ${a}`})}}return Et}var br={},Bs;function Rr(){if(Bs)return br;Bs=1,Object.defineProperty(br,"__esModule",{value:!0}),br.addNackSupportForOpus=w;function w(D){var T;for(const c of D.codecs??[])(c.mimeType.toLowerCase()==="audio/opus"||c.mimeType.toLowerCase()==="audio/multiopus")&&!((T=c.rtcpFeedback)!=null&&T.some(P=>P.type==="nack"&&!P.parameter))&&(c.rtcpFeedback||(c.rtcpFeedback=[]),c.rtcpFeedback.push({type:"nack"}))}return br}var kt={},qs;function he(){if(qs)return kt;qs=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.HandlerInterface=void 0;const w=Be();let D=class extends w.EnhancedEventEmitter{constructor(){super()}};return kt.HandlerInterface=D,kt}var Lt={},ke={},$s;function xn(){if($s)return ke;$s=1,Object.defineProperty(ke,"__esModule",{value:!0}),ke.OfferMediaSection=ke.AnswerMediaSection=ke.MediaSection=void 0;const w=fe(),D=re();let T=class{constructor({iceParameters:_,iceCandidates:C,dtlsParameters:g,planB:h=!1}){E(this,"_mediaObject");E(this,"_planB");if(this._mediaObject={},this._planB=h,_&&this.setIceParameters(_),C){this._mediaObject.candidates=[];for(const n of C){const y={};y.component=1,y.foundation=n.foundation,y.ip=n.address??n.ip,y.port=n.port,y.priority=n.priority,y.transport=n.protocol,y.type=n.type,n.tcpType&&(y.tcptype=n.tcpType),this._mediaObject.candidates.push(y)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}g&&this.setDtlsRole(g.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(_){this._mediaObject.iceUfrag=_.usernameFragment,this._mediaObject.icePwd=_.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}};ke.MediaSection=T;class c extends T{constructor({iceParameters:_,iceCandidates:C,dtlsParameters:g,sctpParameters:h,plainRtpParameters:n,planB:y=!1,offerMediaObject:u,offerRtpParameters:v,answerRtpParameters:a,codecOptions:s}){switch(super({iceParameters:_,iceCandidates:C,dtlsParameters:g,planB:y}),this._mediaObject.mid=String(u.mid),this._mediaObject.type=u.type,this._mediaObject.protocol=u.protocol,n?(this._mediaObject.connection={ip:n.ip,version:n.ipVersion},this._mediaObject.port=n.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),u.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const e of a.codecs){const r={payload:e.payloadType,codec:R(e),rate:e.clockRate};e.channels>1&&(r.encoding=e.channels),this._mediaObject.rtp.push(r);const t=D.clone(e.parameters)??{};let i=D.clone(e.rtcpFeedback)??[];if(s){const{opusStereo:d,opusFec:p,opusDtx:m,opusMaxPlaybackRate:l,opusMaxAverageBitrate:b,opusPtime:k,opusNack:L,videoGoogleStartBitrate:S,videoGoogleMaxBitrate:x,videoGoogleMinBitrate:F}=s,I=v.codecs.find(N=>N.payloadType===e.payloadType);switch(e.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":{d!==void 0&&(I.parameters["sprop-stereo"]=d?1:0,t.stereo=d?1:0),p!==void 0&&(I.parameters.useinbandfec=p?1:0,t.useinbandfec=p?1:0),m!==void 0&&(I.parameters.usedtx=m?1:0,t.usedtx=m?1:0),l!==void 0&&(t.maxplaybackrate=l),b!==void 0&&(t.maxaveragebitrate=b),k!==void 0&&(I.parameters.ptime=k,t.ptime=k),L||(I.rtcpFeedback=I.rtcpFeedback.filter(N=>N.type!=="nack"||N.parameter),i=i.filter(N=>N.type!=="nack"||N.parameter));break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":{S!==void 0&&(t["x-google-start-bitrate"]=S),x!==void 0&&(t["x-google-max-bitrate"]=x),F!==void 0&&(t["x-google-min-bitrate"]=F);break}}}const o={payload:e.payloadType,config:""};for(const d of Object.keys(t))o.config&&(o.config+=";"),o.config+=`${d}=${t[d]}`;o.config&&this._mediaObject.fmtp.push(o);for(const d of i)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:d.type,subtype:d.parameter})}this._mediaObject.payloads=a.codecs.map(e=>e.payloadType).join(" "),this._mediaObject.ext=[];for(const e of a.headerExtensions)(u.ext??[]).some(t=>t.uri===e.uri)&&this._mediaObject.ext.push({uri:e.uri,value:e.id});if(u.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),u.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:u.simulcast.list1},this._mediaObject.rids=[];for(const e of u.rids??[])e.direction==="send"&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}else if(u.simulcast_03){this._mediaObject.simulcast_03={value:u.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const e of u.rids??[])e.direction==="send"&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&this._mediaObject.type==="video"&&(this._mediaObject.xGoogleFlag="conference");break}case"application":{typeof u.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=h.port,this._mediaObject.maxMessageSize=h.maxMessageSize):u.sctpmap&&(this._mediaObject.payloads=h.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:h.port,maxMessageSize:h.maxMessageSize});break}}}setDtlsRole(_){switch(_){case"client":{this._mediaObject.setup="active";break}case"server":{this._mediaObject.setup="passive";break}case"auto":{this._mediaObject.setup="actpass";break}}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(_){var n,y;if(!((n=this._mediaObject.simulcast)!=null&&n.list1))return;const C={};for(const u of _)u.rid&&(C[u.rid]=u);const g=this._mediaObject.simulcast.list1,h=w.parseSimulcastStreamList(g);for(const u of h)for(const v of u)v.paused=!((y=C[v.scid])!=null&&y.active);this._mediaObject.simulcast.list1=h.map(u=>u.map(v=>`${v.paused?"~":""}${v.scid}`).join(",")).join(";")}}ke.AnswerMediaSection=c;class P extends T{constructor({iceParameters:_,iceCandidates:C,dtlsParameters:g,sctpParameters:h,plainRtpParameters:n,planB:y=!1,mid:u,kind:v,offerRtpParameters:a,streamId:s,trackId:e,oldDataChannelSpec:r=!1}){var t;switch(super({iceParameters:_,iceCandidates:C,dtlsParameters:g,planB:y}),this._mediaObject.mid=String(u),this._mediaObject.type=v,n?(this._mediaObject.connection={ip:n.ip,version:n.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=n.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},h?this._mediaObject.protocol="UDP/DTLS/SCTP":this._mediaObject.protocol="UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),v){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${s??"-"} ${e}`);for(const p of a.codecs){const m={payload:p.payloadType,codec:R(p),rate:p.clockRate};p.channels>1&&(m.encoding=p.channels),this._mediaObject.rtp.push(m);const l={payload:p.payloadType,config:""};for(const b of Object.keys(p.parameters))l.config&&(l.config+=";"),l.config+=`${b}=${p.parameters[b]}`;l.config&&this._mediaObject.fmtp.push(l);for(const b of p.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:p.payloadType,type:b.type,subtype:b.parameter})}this._mediaObject.payloads=a.codecs.map(p=>p.payloadType).join(" "),this._mediaObject.ext=[];for(const p of a.headerExtensions)this._mediaObject.ext.push({uri:p.uri,value:p.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const i=a.encodings[0],o=i.ssrc,d=(t=i.rtx)==null?void 0:t.ssrc;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],a.rtcp.cname&&this._mediaObject.ssrcs.push({id:o,attribute:"cname",value:a.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:o,attribute:"msid",value:`${s??"-"} ${e}`}),d&&(a.rtcp.cname&&this._mediaObject.ssrcs.push({id:d,attribute:"cname",value:a.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:d,attribute:"msid",value:`${s??"-"} ${e}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${o} ${d}`}));break}case"application":{r?(this._mediaObject.payloads=h.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:h.port,maxMessageSize:h.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=h.port,this._mediaObject.maxMessageSize=h.maxMessageSize);break}}}setDtlsRole(_){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}planBReceive({offerRtpParameters:_,streamId:C,trackId:g}){var v;const h=_.encodings[0],n=h.ssrc,y=(v=h.rtx)==null?void 0:v.ssrc,u=this._mediaObject.payloads.split(" ");for(const a of _.codecs){if(u.includes(String(a.payloadType)))continue;const s={payload:a.payloadType,codec:R(a),rate:a.clockRate};a.channels>1&&(s.encoding=a.channels),this._mediaObject.rtp.push(s);const e={payload:a.payloadType,config:""};for(const r of Object.keys(a.parameters))e.config&&(e.config+=";"),e.config+=`${r}=${a.parameters[r]}`;e.config&&this._mediaObject.fmtp.push(e);for(const r of a.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:a.payloadType,type:r.type,subtype:r.parameter})}this._mediaObject.payloads+=` ${_.codecs.filter(a=>!this._mediaObject.payloads.includes(a.payloadType)).map(a=>a.payloadType).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),_.rtcp.cname&&this._mediaObject.ssrcs.push({id:n,attribute:"cname",value:_.rtcp.cname}),this._mediaObject.ssrcs.push({id:n,attribute:"msid",value:`${C??"-"} ${g}`}),y&&(_.rtcp.cname&&this._mediaObject.ssrcs.push({id:y,attribute:"cname",value:_.rtcp.cname}),this._mediaObject.ssrcs.push({id:y,attribute:"msid",value:`${C??"-"} ${g}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${n} ${y}`}))}planBStopReceiving({offerRtpParameters:_}){var n;const C=_.encodings[0],g=C.ssrc,h=(n=C.rtx)==null?void 0:n.ssrc;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(y=>y.id!==g&&y.id!==h),h&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(y=>y.ssrcs!==`${g} ${h}`))}}ke.OfferMediaSection=P;function R(f){const C=new RegExp("^(audio|video)/(.+)","i").exec(f.mimeType);if(!C)throw new TypeError("invalid codec.mimeType");return C[2]}return ke}var Us;function Se(){if(Us)return Lt;Us=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.RemoteSdp=void 0;const w=fe(),D=J(),T=xn(),c=new D.Logger("RemoteSdp");let P=class{constructor({iceParameters:f,iceCandidates:_,dtlsParameters:C,sctpParameters:g,plainRtpParameters:h,planB:n=!1}){E(this,"_iceParameters");E(this,"_iceCandidates");E(this,"_dtlsParameters");E(this,"_sctpParameters");E(this,"_plainRtpParameters");E(this,"_planB");E(this,"_mediaSections",[]);E(this,"_midToIndex",new Map);E(this,"_firstMid");E(this,"_sdpObject");if(this._iceParameters=f,this._iceCandidates=_,this._dtlsParameters=C,this._sctpParameters=g,this._plainRtpParameters=h,this._planB=n,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},f!=null&&f.iceLite&&(this._sdpObject.icelite="ice-lite"),C){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const y=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:C.fingerprints[y-1].algorithm,hash:C.fingerprints[y-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}h&&(this._sdpObject.origin.address=h.ip,this._sdpObject.origin.ipVer=h.ipVersion)}updateIceParameters(f){c.debug("updateIceParameters() [iceParameters:%o]",f),this._iceParameters=f,this._sdpObject.icelite=f.iceLite?"ice-lite":void 0;for(const _ of this._mediaSections)_.setIceParameters(f)}updateDtlsRole(f){c.debug("updateDtlsRole() [role:%s]",f),this._dtlsParameters.role=f;for(const _ of this._mediaSections)_.setDtlsRole(f)}setSessionExtmapAllowMixed(){c.debug("setSessionExtmapAllowMixed()"),this._sdpObject.extmapAllowMixed="extmap-allow-mixed"}getNextMediaSectionIdx(){for(let f=0;f<this._mediaSections.length;++f){const _=this._mediaSections[f];if(_.closed)return{idx:f,reuseMid:_.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:f,reuseMid:_,offerRtpParameters:C,answerRtpParameters:g,codecOptions:h}){const n=new T.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:f,offerRtpParameters:C,answerRtpParameters:g,codecOptions:h});_?this._replaceMediaSection(n,_):this._midToIndex.has(n.mid)?this._replaceMediaSection(n):this._addMediaSection(n)}receive({mid:f,kind:_,offerRtpParameters:C,streamId:g,trackId:h}){const n=this._midToIndex.get(f);let y;if(n!==void 0&&(y=this._mediaSections[n]),y)y.planBReceive({offerRtpParameters:C,streamId:g,trackId:h}),this._replaceMediaSection(y);else{y=new T.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:f,kind:_,offerRtpParameters:C,streamId:g,trackId:h});const u=this._mediaSections.find(v=>v.closed);u?this._replaceMediaSection(y,u.mid):this._addMediaSection(y)}}pauseMediaSection(f){this._findMediaSection(f).pause()}resumeSendingMediaSection(f){this._findMediaSection(f).resume()}resumeReceivingMediaSection(f){this._findMediaSection(f).resume()}disableMediaSection(f){this._findMediaSection(f).disable()}closeMediaSection(f){const _=this._findMediaSection(f);return f===this._firstMid?(c.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",f),this.disableMediaSection(f),!1):(_.close(),this._regenerateBundleMids(),!0)}muxMediaSectionSimulcast(f,_){const C=this._findMediaSection(f);C.muxSimulcastStreams(_),this._replaceMediaSection(C)}planBStopReceiving({mid:f,offerRtpParameters:_}){const C=this._findMediaSection(f);C.planBStopReceiving({offerRtpParameters:_}),this._replaceMediaSection(C)}sendSctpAssociation({offerMediaObject:f}){const _=new T.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:f});this._addMediaSection(_)}receiveSctpAssociation({oldDataChannelSpec:f=!1}={}){const _=new T.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:f});this._addMediaSection(_)}getSdp(){return this._sdpObject.origin.sessionVersion++,w.write(this._sdpObject)}_addMediaSection(f){this._firstMid||(this._firstMid=f.mid),this._mediaSections.push(f),this._midToIndex.set(f.mid,this._mediaSections.length-1),this._sdpObject.media.push(f.getObject()),this._regenerateBundleMids()}_replaceMediaSection(f,_){if(typeof _=="string"){const C=this._midToIndex.get(_);if(C===void 0)throw new Error(`no media section found for reuseMid '${_}'`);const g=this._mediaSections[C];this._mediaSections[C]=f,this._midToIndex.delete(g.mid),this._midToIndex.set(f.mid,C),this._sdpObject.media[C]=f.getObject(),this._regenerateBundleMids()}else{const C=this._midToIndex.get(f.mid);if(C===void 0)throw new Error(`no media section found with mid '${f.mid}'`);this._mediaSections[C]=f,this._sdpObject.media[C]=f.getObject()}}_findMediaSection(f){const _=this._midToIndex.get(f);if(_===void 0)throw new Error(`no media section found with mid '${f}'`);return this._mediaSections[_]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(f=>!f.closed).map(f=>f.mid).join(" "))}};return Lt.RemoteSdp=P,Lt}var yr={},zs;function qe(){if(zs)return yr;zs=1,Object.defineProperty(yr,"__esModule",{value:!0}),yr.parse=D;const w=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function D(T){const c=w.exec(T??"");return c?{spatialLayers:Number(c[1]),temporalLayers:Number(c[2])}:{spatialLayers:1,temporalLayers:1}}return yr}var Hs;function In(){if(Hs)return Pt;Hs=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.Chrome111=void 0;const w=fe(),D=J(),T=re(),c=ae(),P=ye(),R=Ye(),f=Rr(),_=ne(),C=he(),g=Se(),h=qe(),n=new D.Logger("Chrome111"),y="Chrome111",u={OS:1024,MIS:1024};let v=class ji extends C.HandlerInterface{constructor(){super();E(this,"_closed",!1);E(this,"_direction");E(this,"_remoteSdp");E(this,"_sendingRtpParametersByKind");E(this,"_sendingRemoteRtpParametersByKind");E(this,"_forcedLocalDtlsRole");E(this,"_pc");E(this,"_mapMidTransceiver",new Map);E(this,"_sendStream",new MediaStream);E(this,"_hasDataChannelMediaSection",!1);E(this,"_nextSendSctpStreamId",0);E(this,"_transportReady",!1)}static createFactory(){return()=>new ji}get name(){return y}close(){if(n.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){n.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const r=await e.createOffer();try{e.close()}catch{}const t=w.parse(r.sdp),i=P.extractRtpCapabilities({sdpObject:t});return f.addNackSupportForOpus(i),i}catch(r){try{e.close()}catch{}throw r}}async getNativeSctpCapabilities(){return n.debug("getNativeSctpCapabilities()"),{numStreams:u}}run({direction:e,iceParameters:r,iceCandidates:t,dtlsParameters:i,sctpParameters:o,iceServers:d,iceTransportPolicy:p,additionalSettings:m,proprietaryConstraints:l,extendedRtpCapabilities:b}){this.assertNotClosed(),n.debug("run()"),this._direction=e,this._remoteSdp=new g.RemoteSdp({iceParameters:r,iceCandidates:t,dtlsParameters:i,sctpParameters:o}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",b),video:c.getSendingRtpParameters("video",b)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",b),video:c.getSendingRemoteRtpParameters("video",b)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:d??[],iceTransportPolicy:p??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...m},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",k=>{this.emit("@icecandidateerror",k)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(n.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}))}async updateIceServers(e){this.assertNotClosed(),n.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=e,this._pc.setConfiguration(r)}async restartIce(e){if(this.assertNotClosed(),n.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});n.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const t={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const t=await this._pc.createAnswer();n.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:r,codecOptions:t,codec:i,onRtpSender:o}){if(this.assertNotClosed(),this.assertSendDirection(),n.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),r&&r.length>1){let F=1;for(const I of r){const N=I.scalabilityMode?(0,h.parse)(I.scalabilityMode).temporalLayers:3;N>F&&(F=N)}r.forEach((I,N)=>{I.rid=`r${N}`,I.scalabilityMode=`L1T${F}`})}const d=T.clone(this._sendingRtpParametersByKind[e.kind]);d.codecs=c.reduceCodecs(d.codecs,i);const p=T.clone(this._sendingRemoteRtpParametersByKind[e.kind]);p.codecs=c.reduceCodecs(p.codecs,i);const m=this._remoteSdp.getNextMediaSectionIdx(),l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:r});o&&o(l.sender);const b=await this._pc.createOffer();let k=w.parse(b.sdp);k.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:k}),n.debug("send() | calling pc.setLocalDescription() [offer:%o]",b),await this._pc.setLocalDescription(b);const L=l.mid;d.mid=L,k=w.parse(this._pc.localDescription.sdp);const S=k.media[m.idx];if(d.rtcp.cname=P.getCname({offerMediaObject:S}),!r)d.encodings=R.getRtpEncodings({offerMediaObject:S});else if(r.length===1){const F=R.getRtpEncodings({offerMediaObject:S});Object.assign(F[0],r[0]),d.encodings=F}else d.encodings=r;this._remoteSdp.send({offerMediaObject:S,reuseMid:m.reuseMid,offerRtpParameters:d,answerRtpParameters:p,codecOptions:t});const x={type:"answer",sdp:this._remoteSdp.getSdp()};return n.debug("send() | calling pc.setRemoteDescription() [answer:%o]",x),await this._pc.setRemoteDescription(x),this._mapMidTransceiver.set(L,l),{localId:L,rtpParameters:d,rtpSender:l.sender}}async stopSending(e){if(this.assertSendDirection(),n.debug("stopSending() [localId:%s]",e),this._closed)return;const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch{}const i=await this._pc.createOffer();n.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),n.debug("pauseSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(e);const t=await this._pc.createOffer();n.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),n.debug("resumeSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly";const t=await this._pc.createOffer();n.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,r){this.assertNotClosed(),this.assertSendDirection(),r?n.debug("replaceTrack() [localId:%s, track.id:%s]",e,r.id):n.debug("replaceTrack() [localId:%s, no track]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");await t.sender.replaceTrack(r)}async setMaxSpatialLayer(e,r){this.assertNotClosed(),this.assertSendDirection(),n.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const i=t.sender.getParameters();i.encodings.forEach((p,m)=>{m<=r?p.active=!0:p.active=!1}),await t.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const o=await this._pc.createOffer();n.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);const d={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d)}async setRtpEncodingParameters(e,r){this.assertNotClosed(),this.assertSendDirection(),n.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const i=t.sender.getParameters();i.encodings.forEach((p,m)=>{i.encodings[m]={...p,...r}}),await t.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const o=await this._pc.createOffer();n.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);const d={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:r,maxRetransmits:t,label:i,protocol:o}){this.assertNotClosed(),this.assertSendDirection();const d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:r,maxRetransmits:t,protocol:o};n.debug("sendDataChannel() [options:%o]",d);const p=this._pc.createDataChannel(i,d);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%u.MIS,!this._hasDataChannelMediaSection){const l=await this._pc.createOffer(),b=w.parse(l.sdp),k=b.media.find(S=>S.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:b}),n.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:k});const L={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",L),await this._pc.setRemoteDescription(L),this._hasDataChannelMediaSection=!0}const m={streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits};return{dataChannel:p,sctpStreamParameters:m}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const r=[],t=new Map;for(const p of e){const{trackId:m,kind:l,rtpParameters:b,streamId:k}=p;n.debug("receive() [trackId:%s, kind:%s]",m,l);const L=b.mid??String(this._mapMidTransceiver.size);t.set(m,L),this._remoteSdp.receive({mid:L,kind:l,offerRtpParameters:b,streamId:k??b.rtcp.cname,trackId:m})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);for(const p of e){const{trackId:m,onRtpReceiver:l}=p;if(l){const b=t.get(m),k=this._pc.getTransceivers().find(L=>L.mid===b);if(!k)throw new Error("transceiver not found");l(k.receiver)}}let o=await this._pc.createAnswer();const d=w.parse(o.sdp);for(const p of e){const{trackId:m,rtpParameters:l}=p,b=t.get(m),k=d.media.find(L=>String(L.mid)===b);P.applyCodecParameters({offerRtpParameters:l,answerMediaObject:k})}o={type:"answer",sdp:w.write(d)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),n.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);for(const p of e){const{trackId:m}=p,l=t.get(m),b=this._pc.getTransceivers().find(k=>k.mid===l);if(b)this._mapMidTransceiver.set(l,b),r.push({localId:l,track:b.receiver.track,rtpReceiver:b.receiver});else throw new Error("new RTCRtpTransceiver not found")}return r}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const i of e){n.debug("stopReceiving() [localId:%s]",i);const o=this._mapMidTransceiver.get(i);if(!o)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(o.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const t=await this._pc.createAnswer();n.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t);for(const i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const i of e){n.debug("pauseReceiving() [localId:%s]",i);const o=this._mapMidTransceiver.get(i);if(!o)throw new Error("associated RTCRtpTransceiver not found");o.direction="inactive",this._remoteSdp.pauseMediaSection(i)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const t=await this._pc.createAnswer();n.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const i of e){n.debug("resumeReceiving() [localId:%s]",i);const o=this._mapMidTransceiver.get(i);if(!o)throw new Error("associated RTCRtpTransceiver not found");o.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const t=await this._pc.createAnswer();n.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:r,protocol:t}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:i,ordered:o,maxPacketLifeTime:d,maxRetransmits:p}=e,m={negotiated:!0,id:i,ordered:o,maxPacketLifeTime:d,maxRetransmits:p,protocol:t};n.debug("receiveDataChannel() [options:%o]",m);const l=this._pc.createDataChannel(r,m);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const b={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",b),await this._pc.setRemoteDescription(b);const k=await this._pc.createAnswer();if(!this._transportReady){const L=w.parse(k.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:L})}n.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",k),await this._pc.setLocalDescription(k),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:r}){r||(r=w.parse(this._pc.localDescription.sdp));const t=P.extractDtlsParameters({sdpObject:r});t.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,o)=>{this.safeEmit("@connect",{dtlsParameters:t},i,o)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new _.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Pt.Chrome111=v,Pt}var xt={},Vs;function Mn(){if(Vs)return xt;Vs=1,Object.defineProperty(xt,"__esModule",{value:!0}),xt.Chrome74=void 0;const w=fe(),D=J(),T=re(),c=ae(),P=ye(),R=Ye(),f=Rr(),_=ne(),C=he(),g=Se(),h=qe(),n=new D.Logger("Chrome74"),y="Chrome74",u={OS:1024,MIS:1024};let v=class Bi extends C.HandlerInterface{constructor(){super();E(this,"_closed",!1);E(this,"_direction");E(this,"_remoteSdp");E(this,"_sendingRtpParametersByKind");E(this,"_sendingRemoteRtpParametersByKind");E(this,"_forcedLocalDtlsRole");E(this,"_pc");E(this,"_mapMidTransceiver",new Map);E(this,"_sendStream",new MediaStream);E(this,"_hasDataChannelMediaSection",!1);E(this,"_nextSendSctpStreamId",0);E(this,"_transportReady",!1)}static createFactory(){return()=>new Bi}get name(){return y}close(){if(n.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){n.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const r=await e.createOffer();try{e.close()}catch{}const t=w.parse(r.sdp),i=P.extractRtpCapabilities({sdpObject:t});return f.addNackSupportForOpus(i),i}catch(r){try{e.close()}catch{}throw r}}async getNativeSctpCapabilities(){return n.debug("getNativeSctpCapabilities()"),{numStreams:u}}run({direction:e,iceParameters:r,iceCandidates:t,dtlsParameters:i,sctpParameters:o,iceServers:d,iceTransportPolicy:p,additionalSettings:m,proprietaryConstraints:l,extendedRtpCapabilities:b}){n.debug("run()"),this._direction=e,this._remoteSdp=new g.RemoteSdp({iceParameters:r,iceCandidates:t,dtlsParameters:i,sctpParameters:o}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",b),video:c.getSendingRtpParameters("video",b)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",b),video:c.getSendingRemoteRtpParameters("video",b)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:d??[],iceTransportPolicy:p??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...m},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",k=>{this.emit("@icecandidateerror",k)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(n.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}))}async updateIceServers(e){this.assertNotClosed(),n.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=e,this._pc.setConfiguration(r)}async restartIce(e){if(this.assertNotClosed(),n.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});n.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const t={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const t=await this._pc.createAnswer();n.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:r,codecOptions:t,codec:i}){this.assertNotClosed(),this.assertSendDirection(),n.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),r&&r.length>1&&r.forEach((I,N)=>{I.rid=`r${N}`});const o=T.clone(this._sendingRtpParametersByKind[e.kind]);o.codecs=c.reduceCodecs(o.codecs,i);const d=T.clone(this._sendingRemoteRtpParametersByKind[e.kind]);d.codecs=c.reduceCodecs(d.codecs,i);const p=this._remoteSdp.getNextMediaSectionIdx(),m=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:r});let l=await this._pc.createOffer(),b=w.parse(l.sdp);b.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let k;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:b});let L=!1;const S=(0,h.parse)((r??[{}])[0].scalabilityMode);r&&r.length===1&&S.spatialLayers>1&&o.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(n.debug("send() | enabling legacy simulcast for VP9 SVC"),L=!0,b=w.parse(l.sdp),k=b.media[p.idx],R.addLegacySimulcast({offerMediaObject:k,numStreams:S.spatialLayers}),l={type:"offer",sdp:w.write(b)}),n.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const x=m.mid;if(o.mid=x,b=w.parse(this._pc.localDescription.sdp),k=b.media[p.idx],o.rtcp.cname=P.getCname({offerMediaObject:k}),!r)o.encodings=R.getRtpEncodings({offerMediaObject:k});else if(r.length===1){let I=R.getRtpEncodings({offerMediaObject:k});Object.assign(I[0],r[0]),L&&(I=[I[0]]),o.encodings=I}else o.encodings=r;if(o.encodings.length>1&&(o.codecs[0].mimeType.toLowerCase()==="video/vp8"||o.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const I of o.encodings)I.scalabilityMode?I.scalabilityMode=`L1T${S.temporalLayers}`:I.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:k,reuseMid:p.reuseMid,offerRtpParameters:o,answerRtpParameters:d,codecOptions:t});const F={type:"answer",sdp:this._remoteSdp.getSdp()};return n.debug("send() | calling pc.setRemoteDescription() [answer:%o]",F),await this._pc.setRemoteDescription(F),this._mapMidTransceiver.set(x,m),{localId:x,rtpParameters:o,rtpSender:m.sender}}async stopSending(e){if(this.assertSendDirection(),n.debug("stopSending() [localId:%s]",e),this._closed)return;const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch{}const i=await this._pc.createOffer();n.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),n.debug("pauseSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(e);const t=await this._pc.createOffer();n.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),n.debug("resumeSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly";const t=await this._pc.createOffer();n.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,r){this.assertNotClosed(),this.assertSendDirection(),r?n.debug("replaceTrack() [localId:%s, track.id:%s]",e,r.id):n.debug("replaceTrack() [localId:%s, no track]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");await t.sender.replaceTrack(r)}async setMaxSpatialLayer(e,r){this.assertNotClosed(),this.assertSendDirection(),n.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const i=t.sender.getParameters();i.encodings.forEach((p,m)=>{m<=r?p.active=!0:p.active=!1}),await t.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const o=await this._pc.createOffer();n.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);const d={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d)}async setRtpEncodingParameters(e,r){this.assertNotClosed(),this.assertSendDirection(),n.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const i=t.sender.getParameters();i.encodings.forEach((p,m)=>{i.encodings[m]={...p,...r}}),await t.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const o=await this._pc.createOffer();n.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);const d={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:r,maxRetransmits:t,label:i,protocol:o}){this.assertNotClosed(),this.assertSendDirection();const d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:r,maxRetransmits:t,protocol:o};n.debug("sendDataChannel() [options:%o]",d);const p=this._pc.createDataChannel(i,d);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%u.MIS,!this._hasDataChannelMediaSection){const l=await this._pc.createOffer(),b=w.parse(l.sdp),k=b.media.find(S=>S.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:b}),n.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:k});const L={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",L),await this._pc.setRemoteDescription(L),this._hasDataChannelMediaSection=!0}const m={streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits};return{dataChannel:p,sctpStreamParameters:m}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const r=[],t=new Map;for(const p of e){const{trackId:m,kind:l,rtpParameters:b,streamId:k}=p;n.debug("receive() [trackId:%s, kind:%s]",m,l);const L=b.mid??String(this._mapMidTransceiver.size);t.set(m,L),this._remoteSdp.receive({mid:L,kind:l,offerRtpParameters:b,streamId:k??b.rtcp.cname,trackId:m})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let o=await this._pc.createAnswer();const d=w.parse(o.sdp);for(const p of e){const{trackId:m,rtpParameters:l}=p,b=t.get(m),k=d.media.find(L=>String(L.mid)===b);P.applyCodecParameters({offerRtpParameters:l,answerMediaObject:k})}o={type:"answer",sdp:w.write(d)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),n.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);for(const p of e){const{trackId:m}=p,l=t.get(m),b=this._pc.getTransceivers().find(k=>k.mid===l);if(b)this._mapMidTransceiver.set(l,b),r.push({localId:l,track:b.receiver.track,rtpReceiver:b.receiver});else throw new Error("new RTCRtpTransceiver not found")}return r}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const i of e){n.debug("stopReceiving() [localId:%s]",i);const o=this._mapMidTransceiver.get(i);if(!o)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(o.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const t=await this._pc.createAnswer();n.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t);for(const i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const i of e){n.debug("pauseReceiving() [localId:%s]",i);const o=this._mapMidTransceiver.get(i);if(!o)throw new Error("associated RTCRtpTransceiver not found");o.direction="inactive",this._remoteSdp.pauseMediaSection(i)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const t=await this._pc.createAnswer();n.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const i of e){n.debug("resumeReceiving() [localId:%s]",i);const o=this._mapMidTransceiver.get(i);if(!o)throw new Error("associated RTCRtpTransceiver not found");o.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const t=await this._pc.createAnswer();n.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:r,protocol:t}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:i,ordered:o,maxPacketLifeTime:d,maxRetransmits:p}=e,m={negotiated:!0,id:i,ordered:o,maxPacketLifeTime:d,maxRetransmits:p,protocol:t};n.debug("receiveDataChannel() [options:%o]",m);const l=this._pc.createDataChannel(r,m);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const b={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",b),await this._pc.setRemoteDescription(b);const k=await this._pc.createAnswer();if(!this._transportReady){const L=w.parse(k.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:L})}n.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",k),await this._pc.setLocalDescription(k),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:r}){r||(r=w.parse(this._pc.localDescription.sdp));const t=P.extractDtlsParameters({sdpObject:r});t.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,o)=>{this.safeEmit("@connect",{dtlsParameters:t},i,o)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new _.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return xt.Chrome74=v,xt}var It={},Ks;function On(){if(Ks)return It;Ks=1,Object.defineProperty(It,"__esModule",{value:!0}),It.Chrome70=void 0;const w=fe(),D=J(),T=re(),c=ae(),P=ye(),R=Ye(),f=he(),_=Se(),C=qe(),g=new D.Logger("Chrome70"),h="Chrome70",n={OS:1024,MIS:1024};let y=class qi extends f.HandlerInterface{constructor(){super();E(this,"_direction");E(this,"_remoteSdp");E(this,"_sendingRtpParametersByKind");E(this,"_sendingRemoteRtpParametersByKind");E(this,"_forcedLocalDtlsRole");E(this,"_pc");E(this,"_mapMidTransceiver",new Map);E(this,"_sendStream",new MediaStream);E(this,"_hasDataChannelMediaSection",!1);E(this,"_nextSendSctpStreamId",0);E(this,"_transportReady",!1)}static createFactory(){return()=>new qi}get name(){return h}close(){if(g.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){g.debug("getNativeRtpCapabilities()");const a=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{a.addTransceiver("audio"),a.addTransceiver("video");const s=await a.createOffer();try{a.close()}catch{}const e=w.parse(s.sdp);return P.extractRtpCapabilities({sdpObject:e})}catch(s){try{a.close()}catch{}throw s}}async getNativeSctpCapabilities(){return g.debug("getNativeSctpCapabilities()"),{numStreams:n}}run({direction:a,iceParameters:s,iceCandidates:e,dtlsParameters:r,sctpParameters:t,iceServers:i,iceTransportPolicy:o,additionalSettings:d,proprietaryConstraints:p,extendedRtpCapabilities:m}){g.debug("run()"),this._direction=a,this._remoteSdp=new _.RemoteSdp({iceParameters:s,iceCandidates:e,dtlsParameters:r,sctpParameters:t}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",m),video:c.getSendingRtpParameters("video",m)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",m),video:c.getSendingRemoteRtpParameters("video",m)},r.role&&r.role!=="auto"&&(this._forcedLocalDtlsRole=r.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i??[],iceTransportPolicy:o??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...d},p),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",l=>{this.emit("@icecandidateerror",l)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(g.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(a){g.debug("updateIceServers()");const s=this._pc.getConfiguration();s.iceServers=a,this._pc.setConfiguration(s)}async restartIce(a){if(g.debug("restartIce()"),this._remoteSdp.updateIceParameters(a),!!this._transportReady)if(this._direction==="send"){const s=await this._pc.createOffer({iceRestart:!0});g.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const e={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}else{const s={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const e=await this._pc.createAnswer();g.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}}async getTransportStats(){return this._pc.getStats()}async send({track:a,encodings:s,codecOptions:e,codec:r}){this.assertSendDirection(),g.debug("send() [kind:%s, track.id:%s]",a.kind,a.id);const t=T.clone(this._sendingRtpParametersByKind[a.kind]);t.codecs=c.reduceCodecs(t.codecs,r);const i=T.clone(this._sendingRemoteRtpParametersByKind[a.kind]);i.codecs=c.reduceCodecs(i.codecs,r);const o=this._remoteSdp.getNextMediaSectionIdx(),d=this._pc.addTransceiver(a,{direction:"sendonly",streams:[this._sendStream]});let p=await this._pc.createOffer(),m=w.parse(p.sdp);m.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let l;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:m}),s&&s.length>1&&(g.debug("send() | enabling legacy simulcast"),m=w.parse(p.sdp),l=m.media[o.idx],R.addLegacySimulcast({offerMediaObject:l,numStreams:s.length}),p={type:"offer",sdp:w.write(m)});let b=!1;const k=(0,C.parse)((s??[{}])[0].scalabilityMode);if(s&&s.length===1&&k.spatialLayers>1&&t.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(g.debug("send() | enabling legacy simulcast for VP9 SVC"),b=!0,m=w.parse(p.sdp),l=m.media[o.idx],R.addLegacySimulcast({offerMediaObject:l,numStreams:k.spatialLayers}),p={type:"offer",sdp:w.write(m)}),g.debug("send() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p),s){g.debug("send() | applying given encodings");const x=d.sender.getParameters();for(let F=0;F<(x.encodings??[]).length;++F){const I=x.encodings[F],N=s[F];if(!N)break;x.encodings[F]=Object.assign(I,N)}await d.sender.setParameters(x)}const L=d.mid;if(t.mid=L,m=w.parse(this._pc.localDescription.sdp),l=m.media[o.idx],t.rtcp.cname=P.getCname({offerMediaObject:l}),t.encodings=R.getRtpEncodings({offerMediaObject:l}),s)for(let x=0;x<t.encodings.length;++x)s[x]&&Object.assign(t.encodings[x],s[x]);if(b&&(t.encodings=[t.encodings[0]]),t.encodings.length>1&&(t.codecs[0].mimeType.toLowerCase()==="video/vp8"||t.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const x of t.encodings)x.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:l,reuseMid:o.reuseMid,offerRtpParameters:t,answerRtpParameters:i,codecOptions:e});const S={type:"answer",sdp:this._remoteSdp.getSdp()};return g.debug("send() | calling pc.setRemoteDescription() [answer:%o]",S),await this._pc.setRemoteDescription(S),this._mapMidTransceiver.set(L,d),{localId:L,rtpParameters:t,rtpSender:d.sender}}async stopSending(a){this.assertSendDirection(),g.debug("stopSending() [localId:%s]",a);const s=this._mapMidTransceiver.get(a);if(!s)throw new Error("associated RTCRtpTransceiver not found");if(s.sender.replaceTrack(null),this._pc.removeTrack(s.sender),this._remoteSdp.closeMediaSection(s.mid))try{s.stop()}catch{}const r=await this._pc.createOffer();g.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const t={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t),this._mapMidTransceiver.delete(a)}async pauseSending(a){}async resumeSending(a){}async replaceTrack(a,s){this.assertSendDirection(),s?g.debug("replaceTrack() [localId:%s, track.id:%s]",a,s.id):g.debug("replaceTrack() [localId:%s, no track]",a);const e=this._mapMidTransceiver.get(a);if(!e)throw new Error("associated RTCRtpTransceiver not found");await e.sender.replaceTrack(s)}async setMaxSpatialLayer(a,s){this.assertSendDirection(),g.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",a,s);const e=this._mapMidTransceiver.get(a);if(!e)throw new Error("associated RTCRtpTransceiver not found");const r=e.sender.getParameters();r.encodings.forEach((o,d)=>{d<=s?o.active=!0:o.active=!1}),await e.sender.setParameters(r),this._remoteSdp.muxMediaSectionSimulcast(a,r.encodings);const t=await this._pc.createOffer();g.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async setRtpEncodingParameters(a,s){this.assertSendDirection(),g.debug("setRtpEncodingParameters() [localId:%s, params:%o]",a,s);const e=this._mapMidTransceiver.get(a);if(!e)throw new Error("associated RTCRtpTransceiver not found");const r=e.sender.getParameters();r.encodings.forEach((o,d)=>{r.encodings[d]={...o,...s}}),await e.sender.setParameters(r),this._remoteSdp.muxMediaSectionSimulcast(a,r.encodings);const t=await this._pc.createOffer();g.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async getSenderStats(a){this.assertSendDirection();const s=this._mapMidTransceiver.get(a);if(!s)throw new Error("associated RTCRtpTransceiver not found");return s.sender.getStats()}async sendDataChannel({ordered:a,maxPacketLifeTime:s,maxRetransmits:e,label:r,protocol:t}){this.assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:a,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:e,protocol:t};g.debug("sendDataChannel() [options:%o]",i);const o=this._pc.createDataChannel(r,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%n.MIS,!this._hasDataChannelMediaSection){const p=await this._pc.createOffer(),m=w.parse(p.sdp),l=m.media.find(k=>k.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:m}),g.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p),this._remoteSdp.sendSctpAssociation({offerMediaObject:l});const b={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",b),await this._pc.setRemoteDescription(b),this._hasDataChannelMediaSection=!0}const d={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:o,sctpStreamParameters:d}}async receive(a){this.assertRecvDirection();const s=[],e=new Map;for(const o of a){const{trackId:d,kind:p,rtpParameters:m,streamId:l}=o;g.debug("receive() [trackId:%s, kind:%s]",d,p);const b=m.mid??String(this._mapMidTransceiver.size);e.set(d,b),this._remoteSdp.receive({mid:b,kind:p,offerRtpParameters:m,streamId:l??m.rtcp.cname,trackId:d})}const r={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);let t=await this._pc.createAnswer();const i=w.parse(t.sdp);for(const o of a){const{trackId:d,rtpParameters:p}=o,m=e.get(d),l=i.media.find(b=>String(b.mid)===m);P.applyCodecParameters({offerRtpParameters:p,answerMediaObject:l})}t={type:"answer",sdp:w.write(i)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:i}),g.debug("receive() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t);for(const o of a){const{trackId:d}=o,p=e.get(d),m=this._pc.getTransceivers().find(l=>l.mid===p);if(!m)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(p,m),s.push({localId:p,track:m.receiver.track,rtpReceiver:m.receiver})}return s}async stopReceiving(a){this.assertRecvDirection();for(const r of a){g.debug("stopReceiving() [localId:%s]",r);const t=this._mapMidTransceiver.get(r);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid)}const s={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const e=await this._pc.createAnswer();g.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e);for(const r of a)this._mapMidTransceiver.delete(r)}async pauseReceiving(a){}async resumeReceiving(a){}async getReceiverStats(a){this.assertRecvDirection();const s=this._mapMidTransceiver.get(a);if(!s)throw new Error("associated RTCRtpTransceiver not found");return s.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:a,label:s,protocol:e}){this.assertRecvDirection();const{streamId:r,ordered:t,maxPacketLifeTime:i,maxRetransmits:o}=a,d={negotiated:!0,id:r,ordered:t,maxPacketLifeTime:i,maxRetransmitTime:i,maxRetransmits:o,protocol:e};g.debug("receiveDataChannel() [options:%o]",d);const p=this._pc.createDataChannel(s,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const m={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",m),await this._pc.setRemoteDescription(m);const l=await this._pc.createAnswer();if(!this._transportReady){const b=w.parse(l.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:b})}g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setLocalDescription(l),this._hasDataChannelMediaSection=!0}return{dataChannel:p}}async setupTransport({localDtlsRole:a,localSdpObject:s}){s||(s=w.parse(this._pc.localDescription.sdp));const e=P.extractDtlsParameters({sdpObject:s});e.role=a,this._remoteSdp.updateDtlsRole(a==="client"?"server":"client"),await new Promise((r,t)=>{this.safeEmit("@connect",{dtlsParameters:e},r,t)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return It.Chrome70=y,It}var Mt={},Ot={},Gs;function Cr(){if(Gs)return Ot;Gs=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.getRtpEncodings=w,Ot.addLegacySimulcast=D;function w({offerMediaObject:T,track:c}){const P=new Set;for(const _ of T.ssrcs??[]){if(_.attribute!=="msid")continue;if(_.value.split(" ")[1]===c.id){const g=_.id;P.add(g)}}if(P.size===0)throw new Error(`a=ssrc line with msid information not found [track.id:${c.id}]`);const R=new Map;for(const _ of T.ssrcGroups??[]){if(_.semantics!=="FID")continue;let[C,g]=_.ssrcs.split(/\s+/);C=Number(C),g=Number(g),P.has(C)&&(P.delete(C),P.delete(g),R.set(C,g))}for(const _ of P)R.set(_,null);const f=[];for(const[_,C]of R){const g={ssrc:_};C&&(g.rtx={ssrc:C}),f.push(g)}return f}function D({offerMediaObject:T,track:c,numStreams:P}){if(P<=1)throw new TypeError("numStreams must be greater than 1");let R,f,_;if(!(T.ssrcs??[]).find(u=>u.attribute!=="msid"?!1:u.value.split(" ")[1]===c.id?(R=u.id,_=u.value.split(" ")[0],!0):!1))throw new Error(`a=ssrc line with msid information not found [track.id:${c.id}]`);(T.ssrcGroups??[]).some(u=>{if(u.semantics!=="FID")return!1;const v=u.ssrcs.split(/\s+/);return Number(v[0])===R?(f=Number(v[1]),!0):!1});const g=T.ssrcs.find(u=>u.attribute==="cname"&&u.id===R);if(!g)throw new Error(`a=ssrc line with cname information not found [track.id:${c.id}]`);const h=g.value,n=[],y=[];for(let u=0;u<P;++u)n.push(R+u),f&&y.push(f+u);T.ssrcGroups=T.ssrcGroups??[],T.ssrcs=T.ssrcs??[],T.ssrcGroups.push({semantics:"SIM",ssrcs:n.join(" ")});for(const u of n)T.ssrcs.push({id:u,attribute:"cname",value:h}),T.ssrcs.push({id:u,attribute:"msid",value:`${_} ${c.id}`});for(let u=0;u<y.length;++u){const v=n[u],a=y[u];T.ssrcs.push({id:a,attribute:"cname",value:h}),T.ssrcs.push({id:a,attribute:"msid",value:`${_} ${c.id}`}),T.ssrcGroups.push({semantics:"FID",ssrcs:`${v} ${a}`})}}return Ot}var Ws;function Fn(){if(Ws)return Mt;Ws=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.Chrome67=void 0;const w=fe(),D=J(),T=re(),c=ae(),P=ye(),R=Cr(),f=he(),_=Se(),C=new D.Logger("Chrome67"),g="Chrome67",h={OS:1024,MIS:1024};let n=class $i extends f.HandlerInterface{constructor(){super();E(this,"_direction");E(this,"_remoteSdp");E(this,"_sendingRtpParametersByKind");E(this,"_sendingRemoteRtpParametersByKind");E(this,"_forcedLocalDtlsRole");E(this,"_pc");E(this,"_sendStream",new MediaStream);E(this,"_mapSendLocalIdRtpSender",new Map);E(this,"_nextSendLocalId",0);E(this,"_mapRecvLocalIdInfo",new Map);E(this,"_hasDataChannelMediaSection",!1);E(this,"_nextSendSctpStreamId",0);E(this,"_transportReady",!1)}static createFactory(){return()=>new $i}get name(){return g}close(){if(C.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){C.debug("getNativeRtpCapabilities()");const v=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const a=await v.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{v.close()}catch{}const s=w.parse(a.sdp);return P.extractRtpCapabilities({sdpObject:s})}catch(a){try{v.close()}catch{}throw a}}async getNativeSctpCapabilities(){return C.debug("getNativeSctpCapabilities()"),{numStreams:h}}run({direction:v,iceParameters:a,iceCandidates:s,dtlsParameters:e,sctpParameters:r,iceServers:t,iceTransportPolicy:i,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:p}){C.debug("run()"),this._direction=v,this._remoteSdp=new _.RemoteSdp({iceParameters:a,iceCandidates:s,dtlsParameters:e,sctpParameters:r,planB:!0}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",p),video:c.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",p),video:c.getSendingRemoteRtpParameters("video",p)},e.role&&e.role!=="auto"&&(this._forcedLocalDtlsRole=e.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:t??[],iceTransportPolicy:i??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...o},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",m=>{this.emit("@icecandidateerror",m)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(C.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(v){C.debug("updateIceServers()");const a=this._pc.getConfiguration();a.iceServers=v,this._pc.setConfiguration(a)}async restartIce(v){if(C.debug("restartIce()"),this._remoteSdp.updateIceParameters(v),!!this._transportReady)if(this._direction==="send"){const a=await this._pc.createOffer({iceRestart:!0});C.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const s={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{const a={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const s=await this._pc.createAnswer();C.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this._pc.getStats()}async send({track:v,encodings:a,codecOptions:s,codec:e}){this.assertSendDirection(),C.debug("send() [kind:%s, track.id:%s]",v.kind,v.id),e&&C.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(v),this._pc.addTrack(v,this._sendStream);let r=await this._pc.createOffer(),t=w.parse(r.sdp);t.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let i;const o=T.clone(this._sendingRtpParametersByKind[v.kind]);o.codecs=c.reduceCodecs(o.codecs);const d=T.clone(this._sendingRemoteRtpParametersByKind[v.kind]);if(d.codecs=c.reduceCodecs(d.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:t}),v.kind==="video"&&a&&a.length>1&&(C.debug("send() | enabling simulcast"),t=w.parse(r.sdp),i=t.media.find(b=>b.type==="video"),R.addLegacySimulcast({offerMediaObject:i,track:v,numStreams:a.length}),r={type:"offer",sdp:w.write(t)}),C.debug("send() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),t=w.parse(this._pc.localDescription.sdp),i=t.media.find(b=>b.type===v.kind),o.rtcp.cname=P.getCname({offerMediaObject:i}),o.encodings=R.getRtpEncodings({offerMediaObject:i,track:v}),a)for(let b=0;b<o.encodings.length;++b)a[b]&&Object.assign(o.encodings[b],a[b]);if(o.encodings.length>1&&o.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const b of o.encodings)b.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:o,answerRtpParameters:d,codecOptions:s});const p={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("send() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p);const m=String(this._nextSendLocalId);this._nextSendLocalId++;const l=this._pc.getSenders().find(b=>b.track===v);return this._mapSendLocalIdRtpSender.set(m,l),{localId:m,rtpParameters:o,rtpSender:l}}async stopSending(v){this.assertSendDirection(),C.debug("stopSending() [localId:%s]",v);const a=this._mapSendLocalIdRtpSender.get(v);if(!a)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(a),a.track&&this._sendStream.removeTrack(a.track),this._mapSendLocalIdRtpSender.delete(v);const s=await this._pc.createOffer();C.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s);try{await this._pc.setLocalDescription(s)}catch(r){if(this._sendStream.getTracks().length===0){C.warn("stopSending() | ignoring expected error due no sending tracks: %s",r.toString());return}throw r}if(this._pc.signalingState==="stable")return;const e={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}async pauseSending(v){}async resumeSending(v){}async replaceTrack(v,a){this.assertSendDirection(),a?C.debug("replaceTrack() [localId:%s, track.id:%s]",v,a.id):C.debug("replaceTrack() [localId:%s, no track]",v);const s=this._mapSendLocalIdRtpSender.get(v);if(!s)throw new Error("associated RTCRtpSender not found");const e=s.track;await s.replaceTrack(a),e&&this._sendStream.removeTrack(e),a&&this._sendStream.addTrack(a)}async setMaxSpatialLayer(v,a){this.assertSendDirection(),C.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",v,a);const s=this._mapSendLocalIdRtpSender.get(v);if(!s)throw new Error("associated RTCRtpSender not found");const e=s.getParameters();e.encodings.forEach((r,t)=>{t<=a?r.active=!0:r.active=!1}),await s.setParameters(e)}async setRtpEncodingParameters(v,a){this.assertSendDirection(),C.debug("setRtpEncodingParameters() [localId:%s, params:%o]",v,a);const s=this._mapSendLocalIdRtpSender.get(v);if(!s)throw new Error("associated RTCRtpSender not found");const e=s.getParameters();e.encodings.forEach((r,t)=>{e.encodings[t]={...r,...a}}),await s.setParameters(e)}async getSenderStats(v){this.assertSendDirection();const a=this._mapSendLocalIdRtpSender.get(v);if(!a)throw new Error("associated RTCRtpSender not found");return a.getStats()}async sendDataChannel({ordered:v,maxPacketLifeTime:a,maxRetransmits:s,label:e,protocol:r}){this.assertSendDirection();const t={negotiated:!0,id:this._nextSendSctpStreamId,ordered:v,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:s,protocol:r};C.debug("sendDataChannel() [options:%o]",t);const i=this._pc.createDataChannel(e,t);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%h.MIS,!this._hasDataChannelMediaSection){const d=await this._pc.createOffer(),p=w.parse(d.sdp),m=p.media.find(b=>b.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:p}),C.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d),this._remoteSdp.sendSctpAssociation({offerMediaObject:m});const l={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setRemoteDescription(l),this._hasDataChannelMediaSection=!0}const o={streamId:t.id,ordered:t.ordered,maxPacketLifeTime:t.maxPacketLifeTime,maxRetransmits:t.maxRetransmits};return{dataChannel:i,sctpStreamParameters:o}}async receive(v){this.assertRecvDirection();const a=[];for(const t of v){const{trackId:i,kind:o,rtpParameters:d,streamId:p}=t;C.debug("receive() [trackId:%s, kind:%s]",i,o);const m=o;this._remoteSdp.receive({mid:m,kind:o,offerRtpParameters:d,streamId:p??d.rtcp.cname,trackId:i})}const s={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let e=await this._pc.createAnswer();const r=w.parse(e.sdp);for(const t of v){const{kind:i,rtpParameters:o}=t,d=i,p=r.media.find(m=>String(m.mid)===d);P.applyCodecParameters({offerRtpParameters:o,answerMediaObject:p})}e={type:"answer",sdp:w.write(r)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:r}),C.debug("receive() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e);for(const t of v){const{kind:i,trackId:o,rtpParameters:d}=t,p=o,m=i,l=this._pc.getReceivers().find(b=>b.track&&b.track.id===p);if(!l)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(p,{mid:m,rtpParameters:d,rtpReceiver:l}),a.push({localId:p,track:l.track,rtpReceiver:l})}return a}async stopReceiving(v){this.assertRecvDirection();for(const e of v){C.debug("stopReceiving() [localId:%s]",e);const{mid:r,rtpParameters:t}=this._mapRecvLocalIdInfo.get(e)??{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:r,offerRtpParameters:t})}const a={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const s=await this._pc.createAnswer();C.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async pauseReceiving(v){}async resumeReceiving(v){}async getReceiverStats(v){this.assertRecvDirection();const{rtpReceiver:a}=this._mapRecvLocalIdInfo.get(v)??{};if(!a)throw new Error("associated RTCRtpReceiver not found");return a.getStats()}async receiveDataChannel({sctpStreamParameters:v,label:a,protocol:s}){this.assertRecvDirection();const{streamId:e,ordered:r,maxPacketLifeTime:t,maxRetransmits:i}=v,o={negotiated:!0,id:e,ordered:r,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:i,protocol:s};C.debug("receiveDataChannel() [options:%o]",o);const d=this._pc.createDataChannel(a,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const p={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);const m=await this._pc.createAnswer();if(!this._transportReady){const l=w.parse(m.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l})}C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setLocalDescription(m),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:v,localSdpObject:a}){a||(a=w.parse(this._pc.localDescription.sdp));const s=P.extractDtlsParameters({sdpObject:a});s.role=v,this._remoteSdp.updateDtlsRole(v==="client"?"server":"client"),await new Promise((e,r)=>{this.safeEmit("@connect",{dtlsParameters:s},e,r)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Mt.Chrome67=n,Mt}var Ft={},Qs;function An(){if(Qs)return Ft;Qs=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.Chrome55=void 0;const w=fe(),D=J(),T=ne(),c=re(),P=ae(),R=ye(),f=Cr(),_=he(),C=Se(),g=new D.Logger("Chrome55"),h="Chrome55",n={OS:1024,MIS:1024};let y=class Ui extends _.HandlerInterface{constructor(){super();E(this,"_direction");E(this,"_remoteSdp");E(this,"_sendingRtpParametersByKind");E(this,"_sendingRemoteRtpParametersByKind");E(this,"_forcedLocalDtlsRole");E(this,"_pc");E(this,"_sendStream",new MediaStream);E(this,"_mapSendLocalIdTrack",new Map);E(this,"_nextSendLocalId",0);E(this,"_mapRecvLocalIdInfo",new Map);E(this,"_hasDataChannelMediaSection",!1);E(this,"_nextSendSctpStreamId",0);E(this,"_transportReady",!1)}static createFactory(){return()=>new Ui}get name(){return h}close(){if(g.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){g.debug("getNativeRtpCapabilities()");const a=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const s=await a.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{a.close()}catch{}const e=w.parse(s.sdp);return R.extractRtpCapabilities({sdpObject:e})}catch(s){try{a.close()}catch{}throw s}}async getNativeSctpCapabilities(){return g.debug("getNativeSctpCapabilities()"),{numStreams:n}}run({direction:a,iceParameters:s,iceCandidates:e,dtlsParameters:r,sctpParameters:t,iceServers:i,iceTransportPolicy:o,additionalSettings:d,proprietaryConstraints:p,extendedRtpCapabilities:m}){g.debug("run()"),this._direction=a,this._remoteSdp=new C.RemoteSdp({iceParameters:s,iceCandidates:e,dtlsParameters:r,sctpParameters:t,planB:!0}),this._sendingRtpParametersByKind={audio:P.getSendingRtpParameters("audio",m),video:P.getSendingRtpParameters("video",m)},this._sendingRemoteRtpParametersByKind={audio:P.getSendingRemoteRtpParameters("audio",m),video:P.getSendingRemoteRtpParameters("video",m)},r.role&&r.role!=="auto"&&(this._forcedLocalDtlsRole=r.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i??[],iceTransportPolicy:o??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...d},p),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",l=>{this.emit("@icecandidateerror",l)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(g.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(a){g.debug("updateIceServers()");const s=this._pc.getConfiguration();s.iceServers=a,this._pc.setConfiguration(s)}async restartIce(a){if(g.debug("restartIce()"),this._remoteSdp.updateIceParameters(a),!!this._transportReady)if(this._direction==="send"){const s=await this._pc.createOffer({iceRestart:!0});g.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const e={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}else{const s={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const e=await this._pc.createAnswer();g.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}}async getTransportStats(){return this._pc.getStats()}async send({track:a,encodings:s,codecOptions:e,codec:r}){this.assertSendDirection(),g.debug("send() [kind:%s, track.id:%s]",a.kind,a.id),r&&g.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(a),this._pc.addStream(this._sendStream);let t=await this._pc.createOffer(),i=w.parse(t.sdp);i.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let o;const d=c.clone(this._sendingRtpParametersByKind[a.kind]);d.codecs=P.reduceCodecs(d.codecs);const p=c.clone(this._sendingRemoteRtpParametersByKind[a.kind]);if(p.codecs=P.reduceCodecs(p.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:i}),a.kind==="video"&&s&&s.length>1&&(g.debug("send() | enabling simulcast"),i=w.parse(t.sdp),o=i.media.find(b=>b.type==="video"),f.addLegacySimulcast({offerMediaObject:o,track:a,numStreams:s.length}),t={type:"offer",sdp:w.write(i)}),g.debug("send() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),i=w.parse(this._pc.localDescription.sdp),o=i.media.find(b=>b.type===a.kind),d.rtcp.cname=R.getCname({offerMediaObject:o}),d.encodings=f.getRtpEncodings({offerMediaObject:o,track:a}),s)for(let b=0;b<d.encodings.length;++b)s[b]&&Object.assign(d.encodings[b],s[b]);if(d.encodings.length>1&&d.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const b of d.encodings)b.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:o,offerRtpParameters:d,answerRtpParameters:p,codecOptions:e});const m={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("send() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m);const l=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(l,a),{localId:l,rtpParameters:d}}async stopSending(a){this.assertSendDirection(),g.debug("stopSending() [localId:%s]",a);const s=this._mapSendLocalIdTrack.get(a);if(!s)throw new Error("track not found");this._mapSendLocalIdTrack.delete(a),this._sendStream.removeTrack(s),this._pc.addStream(this._sendStream);const e=await this._pc.createOffer();g.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",e);try{await this._pc.setLocalDescription(e)}catch(t){if(this._sendStream.getTracks().length===0){g.warn("stopSending() | ignoring expected error due no sending tracks: %s",t.toString());return}throw t}if(this._pc.signalingState==="stable")return;const r={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async pauseSending(a){}async resumeSending(a){}async replaceTrack(a,s){throw new T.UnsupportedError("not implemented")}async setMaxSpatialLayer(a,s){throw new T.UnsupportedError(" not implemented")}async setRtpEncodingParameters(a,s){throw new T.UnsupportedError("not supported")}async getSenderStats(a){throw new T.UnsupportedError("not implemented")}async sendDataChannel({ordered:a,maxPacketLifeTime:s,maxRetransmits:e,label:r,protocol:t}){this.assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:a,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:e,protocol:t};g.debug("sendDataChannel() [options:%o]",i);const o=this._pc.createDataChannel(r,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%n.MIS,!this._hasDataChannelMediaSection){const p=await this._pc.createOffer(),m=w.parse(p.sdp),l=m.media.find(k=>k.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:m}),g.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p),this._remoteSdp.sendSctpAssociation({offerMediaObject:l});const b={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",b),await this._pc.setRemoteDescription(b),this._hasDataChannelMediaSection=!0}const d={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:o,sctpStreamParameters:d}}async receive(a){this.assertRecvDirection();const s=[];for(const i of a){const{trackId:o,kind:d,rtpParameters:p,streamId:m}=i;g.debug("receive() [trackId:%s, kind:%s]",o,d);const l=d;this._remoteSdp.receive({mid:l,kind:d,offerRtpParameters:p,streamId:m??p.rtcp.cname,trackId:o})}const e={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);let r=await this._pc.createAnswer();const t=w.parse(r.sdp);for(const i of a){const{kind:o,rtpParameters:d}=i,p=o,m=t.media.find(l=>String(l.mid)===p);R.applyCodecParameters({offerRtpParameters:d,answerMediaObject:m})}r={type:"answer",sdp:w.write(t)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:t}),g.debug("receive() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const i of a){const{kind:o,trackId:d,rtpParameters:p}=i,m=o,l=d,b=i.streamId??p.rtcp.cname,L=this._pc.getRemoteStreams().find(S=>S.id===b).getTrackById(l);if(!L)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(l,{mid:m,rtpParameters:p}),s.push({localId:l,track:L})}return s}async stopReceiving(a){this.assertRecvDirection();for(const r of a){g.debug("stopReceiving() [localId:%s]",r);const{mid:t,rtpParameters:i}=this._mapRecvLocalIdInfo.get(r)??{};this._mapRecvLocalIdInfo.delete(r),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:i})}const s={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const e=await this._pc.createAnswer();g.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async pauseReceiving(a){}async resumeReceiving(a){}async getReceiverStats(a){throw new T.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:a,label:s,protocol:e}){this.assertRecvDirection();const{streamId:r,ordered:t,maxPacketLifeTime:i,maxRetransmits:o}=a,d={negotiated:!0,id:r,ordered:t,maxPacketLifeTime:i,maxRetransmitTime:i,maxRetransmits:o,protocol:e};g.debug("receiveDataChannel() [options:%o]",d);const p=this._pc.createDataChannel(s,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const m={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",m),await this._pc.setRemoteDescription(m);const l=await this._pc.createAnswer();if(!this._transportReady){const b=w.parse(l.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:b})}g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setLocalDescription(l),this._hasDataChannelMediaSection=!0}return{dataChannel:p}}async setupTransport({localDtlsRole:a,localSdpObject:s}){s||(s=w.parse(this._pc.localDescription.sdp));const e=R.extractDtlsParameters({sdpObject:s});e.role=a,this._remoteSdp.updateDtlsRole(a==="client"?"server":"client"),await new Promise((r,t)=>{this.safeEmit("@connect",{dtlsParameters:e},r,t)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Ft.Chrome55=y,Ft}var At={},Ys;function Nn(){if(Ys)return At;Ys=1,Object.defineProperty(At,"__esModule",{value:!0}),At.Firefox120=void 0;const w=fe(),D=J(),T=ne(),c=re(),P=ae(),R=ye(),f=Ye(),_=he(),C=Se(),g=qe(),h=new D.Logger("Firefox120"),n="Firefox120",y={OS:16,MIS:2048};let u=class zi extends _.HandlerInterface{constructor(){super();E(this,"_closed",!1);E(this,"_direction");E(this,"_remoteSdp");E(this,"_sendingRtpParametersByKind");E(this,"_sendingRemoteRtpParametersByKind");E(this,"_pc");E(this,"_mapMidTransceiver",new Map);E(this,"_sendStream",new MediaStream);E(this,"_hasDataChannelMediaSection",!1);E(this,"_nextSendSctpStreamId",0);E(this,"_transportReady",!1)}static createFactory(){return()=>new zi}get name(){return n}close(){if(h.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){h.debug("getNativeRtpCapabilities()");const s=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),e=document.createElement("canvas");e.getContext("2d");const t=e.captureStream().getVideoTracks()[0];try{s.addTransceiver("audio",{direction:"sendrecv"}),s.addTransceiver(t,{direction:"sendrecv",sendEncodings:[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}]});const i=await s.createOffer();try{e.remove()}catch{}try{t.stop()}catch{}try{s.close()}catch{}const o=w.parse(i.sdp);return R.extractRtpCapabilities({sdpObject:o})}catch(i){try{e.remove()}catch{}try{t.stop()}catch{}try{s.close()}catch{}throw i}}async getNativeSctpCapabilities(){return h.debug("getNativeSctpCapabilities()"),{numStreams:y}}run({direction:s,iceParameters:e,iceCandidates:r,dtlsParameters:t,sctpParameters:i,iceServers:o,iceTransportPolicy:d,additionalSettings:p,proprietaryConstraints:m,extendedRtpCapabilities:l}){this.assertNotClosed(),h.debug("run()"),this._direction=s,this._remoteSdp=new C.RemoteSdp({iceParameters:e,iceCandidates:r,dtlsParameters:t,sctpParameters:i}),this._sendingRtpParametersByKind={audio:P.getSendingRtpParameters("audio",l),video:P.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:P.getSendingRemoteRtpParameters("audio",l),video:P.getSendingRemoteRtpParameters("video",l)},this._pc=new RTCPeerConnection({iceServers:o??[],iceTransportPolicy:d??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...p},m),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",b=>{this.emit("@icecandidateerror",b)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(h.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(s){throw this.assertNotClosed(),new T.UnsupportedError("not supported")}async restartIce(s){if(this.assertNotClosed(),h.debug("restartIce()"),this._remoteSdp.updateIceParameters(s),!!this._transportReady)if(this._direction==="send"){const e=await this._pc.createOffer({iceRestart:!0});h.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const r={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const r=await this._pc.createAnswer();h.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:s,encodings:e,codecOptions:r,codec:t,onRtpSender:i}){this.assertNotClosed(),this.assertSendDirection(),h.debug("send() [kind:%s, track.id:%s]",s.kind,s.id),e&&e.length>1&&e.forEach((x,F)=>{x.rid=`r${F}`});const o=c.clone(this._sendingRtpParametersByKind[s.kind]);o.codecs=P.reduceCodecs(o.codecs,t);const d=c.clone(this._sendingRemoteRtpParametersByKind[s.kind]);d.codecs=P.reduceCodecs(d.codecs,t);const p=this._pc.addTransceiver(s,{direction:"sendonly",streams:[this._sendStream],sendEncodings:e});i&&i(p.sender);const m=await this._pc.createOffer();let l=w.parse(m.sdp);l.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:l});const b=(0,g.parse)((e??[{}])[0].scalabilityMode);h.debug("send() | calling pc.setLocalDescription() [offer:%o]",m),await this._pc.setLocalDescription(m);const k=p.mid;o.mid=k,l=w.parse(this._pc.localDescription.sdp);const L=l.media[l.media.length-1];if(o.rtcp.cname=R.getCname({offerMediaObject:L}),!e)o.encodings=f.getRtpEncodings({offerMediaObject:L});else if(e.length===1){const x=f.getRtpEncodings({offerMediaObject:L});Object.assign(x[0],e[0]),o.encodings=x}else o.encodings=e;if(o.encodings.length>1&&(o.codecs[0].mimeType.toLowerCase()==="video/vp8"||o.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const x of o.encodings)x.scalabilityMode?x.scalabilityMode=`L1T${b.temporalLayers}`:x.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:L,offerRtpParameters:o,answerRtpParameters:d,codecOptions:r});const S={type:"answer",sdp:this._remoteSdp.getSdp()};return h.debug("send() | calling pc.setRemoteDescription() [answer:%o]",S),await this._pc.setRemoteDescription(S),this._mapMidTransceiver.set(k,p),{localId:k,rtpParameters:o,rtpSender:p.sender}}async stopSending(s){if(this.assertSendDirection(),h.debug("stopSending() [localId:%s]",s),this._closed)return;const e=this._mapMidTransceiver.get(s);if(!e)throw new Error("associated transceiver not found");e.sender.replaceTrack(null),this._pc.removeTrack(e.sender),this._remoteSdp.disableMediaSection(e.mid);const r=await this._pc.createOffer();h.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const t={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t),this._mapMidTransceiver.delete(s)}async pauseSending(s){this.assertNotClosed(),this.assertSendDirection(),h.debug("pauseSending() [localId:%s]",s);const e=this._mapMidTransceiver.get(s);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(s);const r=await this._pc.createOffer();h.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const t={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}async resumeSending(s){this.assertNotClosed(),this.assertSendDirection(),h.debug("resumeSending() [localId:%s]",s);const e=this._mapMidTransceiver.get(s);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(s);const r=await this._pc.createOffer();h.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const t={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}async replaceTrack(s,e){this.assertNotClosed(),this.assertSendDirection(),e?h.debug("replaceTrack() [localId:%s, track.id:%s]",s,e.id):h.debug("replaceTrack() [localId:%s, no track]",s);const r=this._mapMidTransceiver.get(s);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(e)}async setMaxSpatialLayer(s,e){this.assertNotClosed(),this.assertSendDirection(),h.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",s,e);const r=this._mapMidTransceiver.get(s);if(!r)throw new Error("associated transceiver not found");const t=r.sender.getParameters();t.encodings.forEach((d,p)=>{p<=e?d.active=!0:d.active=!1}),await r.sender.setParameters(t),this._remoteSdp.muxMediaSectionSimulcast(s,t.encodings);const i=await this._pc.createOffer();h.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async setRtpEncodingParameters(s,e){this.assertNotClosed(),this.assertSendDirection(),h.debug("setRtpEncodingParameters() [localId:%s, params:%o]",s,e);const r=this._mapMidTransceiver.get(s);if(!r)throw new Error("associated RTCRtpTransceiver not found");const t=r.sender.getParameters();t.encodings.forEach((d,p)=>{t.encodings[p]={...d,...e}}),await r.sender.setParameters(t),this._remoteSdp.muxMediaSectionSimulcast(s,t.encodings);const i=await this._pc.createOffer();h.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async getSenderStats(s){this.assertNotClosed(),this.assertSendDirection();const e=this._mapMidTransceiver.get(s);if(!e)throw new Error("associated RTCRtpTransceiver not found");return e.sender.getStats()}async sendDataChannel({ordered:s,maxPacketLifeTime:e,maxRetransmits:r,label:t,protocol:i}){this.assertNotClosed(),this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:s,maxPacketLifeTime:e,maxRetransmits:r,protocol:i};h.debug("sendDataChannel() [options:%o]",o);const d=this._pc.createDataChannel(t,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%y.MIS,!this._hasDataChannelMediaSection){const m=await this._pc.createOffer(),l=w.parse(m.sdp),b=l.media.find(L=>L.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:l}),h.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",m),await this._pc.setLocalDescription(m),this._remoteSdp.sendSctpAssociation({offerMediaObject:b});const k={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",k),await this._pc.setRemoteDescription(k),this._hasDataChannelMediaSection=!0}const p={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:d,sctpStreamParameters:p}}async receive(s){this.assertNotClosed(),this.assertRecvDirection();const e=[],r=new Map;for(const d of s){const{trackId:p,kind:m,rtpParameters:l,streamId:b}=d;h.debug("receive() [trackId:%s, kind:%s]",p,m);const k=l.mid??String(this._mapMidTransceiver.size);r.set(p,k),this._remoteSdp.receive({mid:k,kind:m,offerRtpParameters:l,streamId:b??l.rtcp.cname,trackId:p})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);for(const d of s){const{trackId:p,onRtpReceiver:m}=d;if(m){const l=r.get(p),b=this._pc.getTransceivers().find(k=>k.mid===l);if(!b)throw new Error("transceiver not found");m(b.receiver)}}let i=await this._pc.createAnswer();const o=w.parse(i.sdp);for(const d of s){const{trackId:p,rtpParameters:m}=d,l=r.get(p),b=o.media.find(k=>String(k.mid)===l);R.applyCodecParameters({offerRtpParameters:m,answerMediaObject:b}),i={type:"answer",sdp:w.write(o)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:o}),h.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const d of s){const{trackId:p}=d,m=r.get(p),l=this._pc.getTransceivers().find(b=>b.mid===m);if(!l)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(m,l),e.push({localId:m,track:l.receiver.track,rtpReceiver:l.receiver})}return e}async stopReceiving(s){if(this.assertRecvDirection(),this._closed)return;for(const t of s){h.debug("stopReceiving() [localId:%s]",t);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(i.mid)}const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const r=await this._pc.createAnswer();h.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const t of s)this._mapMidTransceiver.delete(t)}async pauseReceiving(s){this.assertNotClosed(),this.assertRecvDirection();for(const t of s){h.debug("pauseReceiving() [localId:%s]",t);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="inactive",this._remoteSdp.pauseMediaSection(t)}const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const r=await this._pc.createAnswer();h.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async resumeReceiving(s){this.assertNotClosed(),this.assertRecvDirection();for(const t of s){h.debug("resumeReceiving() [localId:%s]",t);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(t)}const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const r=await this._pc.createAnswer();h.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(s){this.assertRecvDirection();const e=this._mapMidTransceiver.get(s);if(!e)throw new Error("associated RTCRtpTransceiver not found");return e.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:s,label:e,protocol:r}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:t,ordered:i,maxPacketLifeTime:o,maxRetransmits:d}=s,p={negotiated:!0,id:t,ordered:i,maxPacketLifeTime:o,maxRetransmits:d,protocol:r};h.debug("receiveDataChannel() [options:%o]",p);const m=this._pc.createDataChannel(e,p);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const l={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const b=await this._pc.createAnswer();if(!this._transportReady){const k=w.parse(b.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:k})}h.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",b),await this._pc.setLocalDescription(b),this._hasDataChannelMediaSection=!0}return{dataChannel:m}}async setupTransport({localDtlsRole:s,localSdpObject:e}){e||(e=w.parse(this._pc.localDescription.sdp));const r=R.extractDtlsParameters({sdpObject:e});r.role=s,this._remoteSdp.updateDtlsRole(s==="client"?"server":"client"),await new Promise((t,i)=>{this.safeEmit("@connect",{dtlsParameters:r},t,i)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new T.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return At.Firefox120=u,At}var Nt={},Xs;function jn(){if(Xs)return Nt;Xs=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.Firefox60=void 0;const w=fe(),D=J(),T=ne(),c=re(),P=ae(),R=ye(),f=Ye(),_=he(),C=Se(),g=qe(),h=new D.Logger("Firefox60"),n="Firefox60",y={OS:16,MIS:2048};let u=class Hi extends _.HandlerInterface{constructor(){super();E(this,"_closed",!1);E(this,"_direction");E(this,"_remoteSdp");E(this,"_sendingRtpParametersByKind");E(this,"_sendingRemoteRtpParametersByKind");E(this,"_pc");E(this,"_mapMidTransceiver",new Map);E(this,"_sendStream",new MediaStream);E(this,"_hasDataChannelMediaSection",!1);E(this,"_nextSendSctpStreamId",0);E(this,"_transportReady",!1)}static createFactory(){return()=>new Hi}get name(){return n}close(){if(h.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){h.debug("getNativeRtpCapabilities()");const s=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),e=document.createElement("canvas");e.getContext("2d");const t=e.captureStream().getVideoTracks()[0];try{s.addTransceiver("audio",{direction:"sendrecv"});const i=s.addTransceiver(t,{direction:"sendrecv"}),o=i.sender.getParameters(),d=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];o.encodings=d,await i.sender.setParameters(o);const p=await s.createOffer();try{e.remove()}catch{}try{t.stop()}catch{}try{s.close()}catch{}const m=w.parse(p.sdp);return R.extractRtpCapabilities({sdpObject:m})}catch(i){try{e.remove()}catch{}try{t.stop()}catch{}try{s.close()}catch{}throw i}}async getNativeSctpCapabilities(){return h.debug("getNativeSctpCapabilities()"),{numStreams:y}}run({direction:s,iceParameters:e,iceCandidates:r,dtlsParameters:t,sctpParameters:i,iceServers:o,iceTransportPolicy:d,additionalSettings:p,proprietaryConstraints:m,extendedRtpCapabilities:l}){this.assertNotClosed(),h.debug("run()"),this._direction=s,this._remoteSdp=new C.RemoteSdp({iceParameters:e,iceCandidates:r,dtlsParameters:t,sctpParameters:i}),this._sendingRtpParametersByKind={audio:P.getSendingRtpParameters("audio",l),video:P.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:P.getSendingRemoteRtpParameters("audio",l),video:P.getSendingRemoteRtpParameters("video",l)},this._pc=new RTCPeerConnection({iceServers:o??[],iceTransportPolicy:d??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...p},m),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",b=>{this.emit("@icecandidateerror",b)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(h.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(s){throw this.assertNotClosed(),new T.UnsupportedError("not supported")}async restartIce(s){if(this.assertNotClosed(),h.debug("restartIce()"),this._remoteSdp.updateIceParameters(s),!!this._transportReady)if(this._direction==="send"){const e=await this._pc.createOffer({iceRestart:!0});h.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const r={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const r=await this._pc.createAnswer();h.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:s,encodings:e,codecOptions:r,codec:t}){this.assertNotClosed(),this.assertSendDirection(),h.debug("send() [kind:%s, track.id:%s]",s.kind,s.id),e&&(e=c.clone(e),e.forEach((S,x)=>{S.rid=`r${x}`}),e.reverse());const i=c.clone(this._sendingRtpParametersByKind[s.kind]);i.codecs=P.reduceCodecs(i.codecs,t);const o=c.clone(this._sendingRemoteRtpParametersByKind[s.kind]);o.codecs=P.reduceCodecs(o.codecs,t);const d=this._pc.addTransceiver(s,{direction:"sendonly",streams:[this._sendStream]});if(e){const S=d.sender.getParameters();S.encodings=e,await d.sender.setParameters(S)}const p=await this._pc.createOffer();let m=w.parse(p.sdp);m.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:m});const l=(0,g.parse)((e??[{}])[0].scalabilityMode);h.debug("send() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);const b=d.mid;i.mid=b,m=w.parse(this._pc.localDescription.sdp);const k=m.media[m.media.length-1];if(i.rtcp.cname=R.getCname({offerMediaObject:k}),!e)i.encodings=f.getRtpEncodings({offerMediaObject:k});else if(e.length===1){const S=f.getRtpEncodings({offerMediaObject:k});Object.assign(S[0],e[0]),i.encodings=S}else i.encodings=e.reverse();if(i.encodings.length>1&&(i.codecs[0].mimeType.toLowerCase()==="video/vp8"||i.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const S of i.encodings)S.scalabilityMode?S.scalabilityMode=`L1T${l.temporalLayers}`:S.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:k,offerRtpParameters:i,answerRtpParameters:o,codecOptions:r});const L={type:"answer",sdp:this._remoteSdp.getSdp()};return h.debug("send() | calling pc.setRemoteDescription() [answer:%o]",L),await this._pc.setRemoteDescription(L),this._mapMidTransceiver.set(b,d),{localId:b,rtpParameters:i,rtpSender:d.sender}}async stopSending(s){if(this.assertSendDirection(),h.debug("stopSending() [localId:%s]",s),this._closed)return;const e=this._mapMidTransceiver.get(s);if(!e)throw new Error("associated transceiver not found");e.sender.replaceTrack(null),this._pc.removeTrack(e.sender),this._remoteSdp.disableMediaSection(e.mid);const r=await this._pc.createOffer();h.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const t={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t),this._mapMidTransceiver.delete(s)}async pauseSending(s){this.assertNotClosed(),this.assertSendDirection(),h.debug("pauseSending() [localId:%s]",s);const e=this._mapMidTransceiver.get(s);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(s);const r=await this._pc.createOffer();h.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const t={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}async resumeSending(s){this.assertNotClosed(),this.assertSendDirection(),h.debug("resumeSending() [localId:%s]",s);const e=this._mapMidTransceiver.get(s);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(s);const r=await this._pc.createOffer();h.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const t={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}async replaceTrack(s,e){this.assertNotClosed(),this.assertSendDirection(),e?h.debug("replaceTrack() [localId:%s, track.id:%s]",s,e.id):h.debug("replaceTrack() [localId:%s, no track]",s);const r=this._mapMidTransceiver.get(s);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(e)}async setMaxSpatialLayer(s,e){this.assertNotClosed(),this.assertSendDirection(),h.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",s,e);const r=this._mapMidTransceiver.get(s);if(!r)throw new Error("associated transceiver not found");const t=r.sender.getParameters();e=t.encodings.length-1-e,t.encodings.forEach((d,p)=>{p>=e?d.active=!0:d.active=!1}),await r.sender.setParameters(t),this._remoteSdp.muxMediaSectionSimulcast(s,t.encodings);const i=await this._pc.createOffer();h.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async setRtpEncodingParameters(s,e){this.assertNotClosed(),this.assertSendDirection(),h.debug("setRtpEncodingParameters() [localId:%s, params:%o]",s,e);const r=this._mapMidTransceiver.get(s);if(!r)throw new Error("associated RTCRtpTransceiver not found");const t=r.sender.getParameters();t.encodings.forEach((d,p)=>{t.encodings[p]={...d,...e}}),await r.sender.setParameters(t),this._remoteSdp.muxMediaSectionSimulcast(s,t.encodings);const i=await this._pc.createOffer();h.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async getSenderStats(s){this.assertNotClosed(),this.assertSendDirection();const e=this._mapMidTransceiver.get(s);if(!e)throw new Error("associated RTCRtpTransceiver not found");return e.sender.getStats()}async sendDataChannel({ordered:s,maxPacketLifeTime:e,maxRetransmits:r,label:t,protocol:i}){this.assertNotClosed(),this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:s,maxPacketLifeTime:e,maxRetransmits:r,protocol:i};h.debug("sendDataChannel() [options:%o]",o);const d=this._pc.createDataChannel(t,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%y.MIS,!this._hasDataChannelMediaSection){const m=await this._pc.createOffer(),l=w.parse(m.sdp),b=l.media.find(L=>L.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:l}),h.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",m),await this._pc.setLocalDescription(m),this._remoteSdp.sendSctpAssociation({offerMediaObject:b});const k={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",k),await this._pc.setRemoteDescription(k),this._hasDataChannelMediaSection=!0}const p={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:d,sctpStreamParameters:p}}async receive(s){this.assertNotClosed(),this.assertRecvDirection();const e=[],r=new Map;for(const d of s){const{trackId:p,kind:m,rtpParameters:l,streamId:b}=d;h.debug("receive() [trackId:%s, kind:%s]",p,m);const k=l.mid??String(this._mapMidTransceiver.size);r.set(p,k),this._remoteSdp.receive({mid:k,kind:m,offerRtpParameters:l,streamId:b??l.rtcp.cname,trackId:p})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let i=await this._pc.createAnswer();const o=w.parse(i.sdp);for(const d of s){const{trackId:p,rtpParameters:m}=d,l=r.get(p),b=o.media.find(k=>String(k.mid)===l);R.applyCodecParameters({offerRtpParameters:m,answerMediaObject:b}),i={type:"answer",sdp:w.write(o)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:o}),h.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const d of s){const{trackId:p}=d,m=r.get(p),l=this._pc.getTransceivers().find(b=>b.mid===m);if(!l)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(m,l),e.push({localId:m,track:l.receiver.track,rtpReceiver:l.receiver})}return e}async stopReceiving(s){if(this.assertRecvDirection(),this._closed)return;for(const t of s){h.debug("stopReceiving() [localId:%s]",t);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(i.mid)}const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const r=await this._pc.createAnswer();h.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const t of s)this._mapMidTransceiver.delete(t)}async pauseReceiving(s){this.assertNotClosed(),this.assertRecvDirection();for(const t of s){h.debug("pauseReceiving() [localId:%s]",t);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="inactive",this._remoteSdp.pauseMediaSection(t)}const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const r=await this._pc.createAnswer();h.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async resumeReceiving(s){this.assertNotClosed(),this.assertRecvDirection();for(const t of s){h.debug("resumeReceiving() [localId:%s]",t);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(t)}const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const r=await this._pc.createAnswer();h.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(s){this.assertRecvDirection();const e=this._mapMidTransceiver.get(s);if(!e)throw new Error("associated RTCRtpTransceiver not found");return e.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:s,label:e,protocol:r}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:t,ordered:i,maxPacketLifeTime:o,maxRetransmits:d}=s,p={negotiated:!0,id:t,ordered:i,maxPacketLifeTime:o,maxRetransmits:d,protocol:r};h.debug("receiveDataChannel() [options:%o]",p);const m=this._pc.createDataChannel(e,p);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const l={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const b=await this._pc.createAnswer();if(!this._transportReady){const k=w.parse(b.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:k})}h.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",b),await this._pc.setLocalDescription(b),this._hasDataChannelMediaSection=!0}return{dataChannel:m}}async setupTransport({localDtlsRole:s,localSdpObject:e}){e||(e=w.parse(this._pc.localDescription.sdp));const r=R.extractDtlsParameters({sdpObject:e});r.role=s,this._remoteSdp.updateDtlsRole(s==="client"?"server":"client"),await new Promise((t,i)=>{this.safeEmit("@connect",{dtlsParameters:r},t,i)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new T.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Nt.Firefox60=u,Nt}var jt={},Js;function Bn(){if(Js)return jt;Js=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.Safari12=void 0;const w=fe(),D=J(),T=re(),c=ae(),P=ye(),R=Ye(),f=Rr(),_=ne(),C=he(),g=Se(),h=qe(),n=new D.Logger("Safari12"),y="Safari12",u={OS:1024,MIS:1024};let v=class Vi extends C.HandlerInterface{constructor(){super();E(this,"_closed",!1);E(this,"_direction");E(this,"_remoteSdp");E(this,"_sendingRtpParametersByKind");E(this,"_sendingRemoteRtpParametersByKind");E(this,"_forcedLocalDtlsRole");E(this,"_pc");E(this,"_mapMidTransceiver",new Map);E(this,"_sendStream",new MediaStream);E(this,"_hasDataChannelMediaSection",!1);E(this,"_nextSendSctpStreamId",0);E(this,"_transportReady",!1)}static createFactory(){return()=>new Vi}get name(){return y}close(){if(n.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){n.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const r=await e.createOffer();try{e.close()}catch{}const t=w.parse(r.sdp),i=P.extractRtpCapabilities({sdpObject:t});return f.addNackSupportForOpus(i),i}catch(r){try{e.close()}catch{}throw r}}async getNativeSctpCapabilities(){return n.debug("getNativeSctpCapabilities()"),{numStreams:u}}run({direction:e,iceParameters:r,iceCandidates:t,dtlsParameters:i,sctpParameters:o,iceServers:d,iceTransportPolicy:p,additionalSettings:m,proprietaryConstraints:l,extendedRtpCapabilities:b}){this.assertNotClosed(),n.debug("run()"),this._direction=e,this._remoteSdp=new g.RemoteSdp({iceParameters:r,iceCandidates:t,dtlsParameters:i,sctpParameters:o}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",b),video:c.getSendingRtpParameters("video",b)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",b),video:c.getSendingRemoteRtpParameters("video",b)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:d??[],iceTransportPolicy:p??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...m},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",k=>{this.emit("@icecandidateerror",k)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(n.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(e){this.assertNotClosed(),n.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=e,this._pc.setConfiguration(r)}async restartIce(e){if(this.assertNotClosed(),n.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});n.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const t={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const t=await this._pc.createAnswer();n.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:r,codecOptions:t,codec:i,onRtpSender:o}){this.assertNotClosed(),this.assertSendDirection(),n.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const d=T.clone(this._sendingRtpParametersByKind[e.kind]);d.codecs=c.reduceCodecs(d.codecs,i);const p=T.clone(this._sendingRemoteRtpParametersByKind[e.kind]);p.codecs=c.reduceCodecs(p.codecs,i);const m=this._remoteSdp.getNextMediaSectionIdx(),l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});o&&o(l.sender);let b=await this._pc.createOffer(),k=w.parse(b.sdp);k.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let L;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:k});const S=(0,h.parse)((r??[{}])[0].scalabilityMode);r&&r.length>1&&(n.debug("send() | enabling legacy simulcast"),k=w.parse(b.sdp),L=k.media[m.idx],R.addLegacySimulcast({offerMediaObject:L,numStreams:r.length}),b={type:"offer",sdp:w.write(k)}),n.debug("send() | calling pc.setLocalDescription() [offer:%o]",b),await this._pc.setLocalDescription(b);const x=l.mid;if(d.mid=x,k=w.parse(this._pc.localDescription.sdp),L=k.media[m.idx],d.rtcp.cname=P.getCname({offerMediaObject:L}),d.encodings=R.getRtpEncodings({offerMediaObject:L}),r)for(let I=0;I<d.encodings.length;++I)r[I]&&Object.assign(d.encodings[I],r[I]);if(d.encodings.length>1&&(d.codecs[0].mimeType.toLowerCase()==="video/vp8"||d.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const I of d.encodings)I.scalabilityMode?I.scalabilityMode=`L1T${S.temporalLayers}`:I.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:L,reuseMid:m.reuseMid,offerRtpParameters:d,answerRtpParameters:p,codecOptions:t});const F={type:"answer",sdp:this._remoteSdp.getSdp()};return n.debug("send() | calling pc.setRemoteDescription() [answer:%o]",F),await this._pc.setRemoteDescription(F),this._mapMidTransceiver.set(x,l),{localId:x,rtpParameters:d,rtpSender:l.sender}}async stopSending(e){if(this.assertSendDirection(),this._closed)return;n.debug("stopSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch{}const i=await this._pc.createOffer();n.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),n.debug("pauseSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(e);const t=await this._pc.createOffer();n.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),n.debug("resumeSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);const t=await this._pc.createOffer();n.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,r){this.assertNotClosed(),this.assertSendDirection(),r?n.debug("replaceTrack() [localId:%s, track.id:%s]",e,r.id):n.debug("replaceTrack() [localId:%s, no track]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");await t.sender.replaceTrack(r)}async setMaxSpatialLayer(e,r){this.assertNotClosed(),this.assertSendDirection(),n.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const i=t.sender.getParameters();i.encodings.forEach((p,m)=>{m<=r?p.active=!0:p.active=!1}),await t.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const o=await this._pc.createOffer();n.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);const d={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d)}async setRtpEncodingParameters(e,r){this.assertNotClosed(),this.assertSendDirection(),n.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const i=t.sender.getParameters();i.encodings.forEach((p,m)=>{i.encodings[m]={...p,...r}}),await t.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const o=await this._pc.createOffer();n.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);const d={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:r,maxRetransmits:t,label:i,protocol:o}){this.assertNotClosed(),this.assertSendDirection();const d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:r,maxRetransmits:t,protocol:o};n.debug("sendDataChannel() [options:%o]",d);const p=this._pc.createDataChannel(i,d);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%u.MIS,!this._hasDataChannelMediaSection){const l=await this._pc.createOffer(),b=w.parse(l.sdp),k=b.media.find(S=>S.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:b}),n.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:k});const L={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",L),await this._pc.setRemoteDescription(L),this._hasDataChannelMediaSection=!0}const m={streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits};return{dataChannel:p,sctpStreamParameters:m}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const r=[],t=new Map;for(const p of e){const{trackId:m,kind:l,rtpParameters:b,streamId:k}=p;n.debug("receive() [trackId:%s, kind:%s]",m,l);const L=b.mid??String(this._mapMidTransceiver.size);t.set(m,L),this._remoteSdp.receive({mid:L,kind:l,offerRtpParameters:b,streamId:k??b.rtcp.cname,trackId:m})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);for(const p of e){const{trackId:m,onRtpReceiver:l}=p;if(l){const b=t.get(m),k=this._pc.getTransceivers().find(L=>L.mid===b);if(!k)throw new Error("transceiver not found");l(k.receiver)}}let o=await this._pc.createAnswer();const d=w.parse(o.sdp);for(const p of e){const{trackId:m,rtpParameters:l}=p,b=t.get(m),k=d.media.find(L=>String(L.mid)===b);P.applyCodecParameters({offerRtpParameters:l,answerMediaObject:k})}o={type:"answer",sdp:w.write(d)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),n.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);for(const p of e){const{trackId:m}=p,l=t.get(m),b=this._pc.getTransceivers().find(k=>k.mid===l);if(!b)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(l,b),r.push({localId:l,track:b.receiver.track,rtpReceiver:b.receiver})}return r}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const i of e){n.debug("stopReceiving() [localId:%s]",i);const o=this._mapMidTransceiver.get(i);if(!o)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(o.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const t=await this._pc.createAnswer();n.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t);for(const i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const i of e){n.debug("pauseReceiving() [localId:%s]",i);const o=this._mapMidTransceiver.get(i);if(!o)throw new Error("associated RTCRtpTransceiver not found");o.direction="inactive",this._remoteSdp.pauseMediaSection(i)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const t=await this._pc.createAnswer();n.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const i of e){n.debug("resumeReceiving() [localId:%s]",i);const o=this._mapMidTransceiver.get(i);if(!o)throw new Error("associated RTCRtpTransceiver not found");o.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const t=await this._pc.createAnswer();n.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:r,protocol:t}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:i,ordered:o,maxPacketLifeTime:d,maxRetransmits:p}=e,m={negotiated:!0,id:i,ordered:o,maxPacketLifeTime:d,maxRetransmits:p,protocol:t};n.debug("receiveDataChannel() [options:%o]",m);const l=this._pc.createDataChannel(r,m);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const b={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",b),await this._pc.setRemoteDescription(b);const k=await this._pc.createAnswer();if(!this._transportReady){const L=w.parse(k.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:L})}n.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",k),await this._pc.setLocalDescription(k),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:r}){r||(r=w.parse(this._pc.localDescription.sdp));const t=P.extractDtlsParameters({sdpObject:r});t.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,o)=>{this.safeEmit("@connect",{dtlsParameters:t},i,o)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new _.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return jt.Safari12=v,jt}var Bt={},Zs;function qn(){if(Zs)return Bt;Zs=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.Safari11=void 0;const w=fe(),D=J(),T=re(),c=ae(),P=ye(),R=Cr(),f=he(),_=Se(),C=new D.Logger("Safari11"),g="Safari11",h={OS:1024,MIS:1024};let n=class Ki extends f.HandlerInterface{constructor(){super();E(this,"_direction");E(this,"_remoteSdp");E(this,"_sendingRtpParametersByKind");E(this,"_sendingRemoteRtpParametersByKind");E(this,"_forcedLocalDtlsRole");E(this,"_pc");E(this,"_sendStream",new MediaStream);E(this,"_mapSendLocalIdRtpSender",new Map);E(this,"_nextSendLocalId",0);E(this,"_mapRecvLocalIdInfo",new Map);E(this,"_hasDataChannelMediaSection",!1);E(this,"_nextSendSctpStreamId",0);E(this,"_transportReady",!1)}static createFactory(){return()=>new Ki}get name(){return g}close(){if(C.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){C.debug("getNativeRtpCapabilities()");const v=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const a=await v.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{v.close()}catch{}const s=w.parse(a.sdp);return P.extractRtpCapabilities({sdpObject:s})}catch(a){try{v.close()}catch{}throw a}}async getNativeSctpCapabilities(){return C.debug("getNativeSctpCapabilities()"),{numStreams:h}}run({direction:v,iceParameters:a,iceCandidates:s,dtlsParameters:e,sctpParameters:r,iceServers:t,iceTransportPolicy:i,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:p}){C.debug("run()"),this._direction=v,this._remoteSdp=new _.RemoteSdp({iceParameters:a,iceCandidates:s,dtlsParameters:e,sctpParameters:r,planB:!0}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",p),video:c.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",p),video:c.getSendingRemoteRtpParameters("video",p)},e.role&&e.role!=="auto"&&(this._forcedLocalDtlsRole=e.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:t??[],iceTransportPolicy:i??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...o},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",m=>{this.emit("@icecandidateerror",m)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(C.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(v){C.debug("updateIceServers()");const a=this._pc.getConfiguration();a.iceServers=v,this._pc.setConfiguration(a)}async restartIce(v){if(C.debug("restartIce()"),this._remoteSdp.updateIceParameters(v),!!this._transportReady)if(this._direction==="send"){const a=await this._pc.createOffer({iceRestart:!0});C.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const s={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{const a={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const s=await this._pc.createAnswer();C.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this._pc.getStats()}async send({track:v,encodings:a,codecOptions:s,codec:e}){this.assertSendDirection(),C.debug("send() [kind:%s, track.id:%s]",v.kind,v.id),e&&C.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(v),this._pc.addTrack(v,this._sendStream);let r=await this._pc.createOffer(),t=w.parse(r.sdp);t.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let i;const o=T.clone(this._sendingRtpParametersByKind[v.kind]);o.codecs=c.reduceCodecs(o.codecs);const d=T.clone(this._sendingRemoteRtpParametersByKind[v.kind]);if(d.codecs=c.reduceCodecs(d.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:t}),v.kind==="video"&&a&&a.length>1&&(C.debug("send() | enabling simulcast"),t=w.parse(r.sdp),i=t.media.find(b=>b.type==="video"),R.addLegacySimulcast({offerMediaObject:i,track:v,numStreams:a.length}),r={type:"offer",sdp:w.write(t)}),C.debug("send() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),t=w.parse(this._pc.localDescription.sdp),i=t.media.find(b=>b.type===v.kind),o.rtcp.cname=P.getCname({offerMediaObject:i}),o.encodings=R.getRtpEncodings({offerMediaObject:i,track:v}),a)for(let b=0;b<o.encodings.length;++b)a[b]&&Object.assign(o.encodings[b],a[b]);if(o.encodings.length>1&&o.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const b of o.encodings)b.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:o,answerRtpParameters:d,codecOptions:s});const p={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("send() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p);const m=String(this._nextSendLocalId);this._nextSendLocalId++;const l=this._pc.getSenders().find(b=>b.track===v);return this._mapSendLocalIdRtpSender.set(m,l),{localId:m,rtpParameters:o,rtpSender:l}}async stopSending(v){this.assertSendDirection();const a=this._mapSendLocalIdRtpSender.get(v);if(!a)throw new Error("associated RTCRtpSender not found");a.track&&this._sendStream.removeTrack(a.track),this._mapSendLocalIdRtpSender.delete(v);const s=await this._pc.createOffer();C.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s);try{await this._pc.setLocalDescription(s)}catch(r){if(this._sendStream.getTracks().length===0){C.warn("stopSending() | ignoring expected error due no sending tracks: %s",r.toString());return}throw r}if(this._pc.signalingState==="stable")return;const e={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}async pauseSending(v){}async resumeSending(v){}async replaceTrack(v,a){this.assertSendDirection(),a?C.debug("replaceTrack() [localId:%s, track.id:%s]",v,a.id):C.debug("replaceTrack() [localId:%s, no track]",v);const s=this._mapSendLocalIdRtpSender.get(v);if(!s)throw new Error("associated RTCRtpSender not found");const e=s.track;await s.replaceTrack(a),e&&this._sendStream.removeTrack(e),a&&this._sendStream.addTrack(a)}async setMaxSpatialLayer(v,a){this.assertSendDirection(),C.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",v,a);const s=this._mapSendLocalIdRtpSender.get(v);if(!s)throw new Error("associated RTCRtpSender not found");const e=s.getParameters();e.encodings.forEach((r,t)=>{t<=a?r.active=!0:r.active=!1}),await s.setParameters(e)}async setRtpEncodingParameters(v,a){this.assertSendDirection(),C.debug("setRtpEncodingParameters() [localId:%s, params:%o]",v,a);const s=this._mapSendLocalIdRtpSender.get(v);if(!s)throw new Error("associated RTCRtpSender not found");const e=s.getParameters();e.encodings.forEach((r,t)=>{e.encodings[t]={...r,...a}}),await s.setParameters(e)}async getSenderStats(v){this.assertSendDirection();const a=this._mapSendLocalIdRtpSender.get(v);if(!a)throw new Error("associated RTCRtpSender not found");return a.getStats()}async sendDataChannel({ordered:v,maxPacketLifeTime:a,maxRetransmits:s,label:e,protocol:r}){this.assertSendDirection();const t={negotiated:!0,id:this._nextSendSctpStreamId,ordered:v,maxPacketLifeTime:a,maxRetransmits:s,protocol:r};C.debug("sendDataChannel() [options:%o]",t);const i=this._pc.createDataChannel(e,t);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%h.MIS,!this._hasDataChannelMediaSection){const d=await this._pc.createOffer(),p=w.parse(d.sdp),m=p.media.find(b=>b.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:p}),C.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d),this._remoteSdp.sendSctpAssociation({offerMediaObject:m});const l={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setRemoteDescription(l),this._hasDataChannelMediaSection=!0}const o={streamId:t.id,ordered:t.ordered,maxPacketLifeTime:t.maxPacketLifeTime,maxRetransmits:t.maxRetransmits};return{dataChannel:i,sctpStreamParameters:o}}async receive(v){this.assertRecvDirection();const a=[];for(const t of v){const{trackId:i,kind:o,rtpParameters:d,streamId:p}=t;C.debug("receive() [trackId:%s, kind:%s]",i,o);const m=o;this._remoteSdp.receive({mid:m,kind:o,offerRtpParameters:d,streamId:p??d.rtcp.cname,trackId:i})}const s={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let e=await this._pc.createAnswer();const r=w.parse(e.sdp);for(const t of v){const{kind:i,rtpParameters:o}=t,d=i,p=r.media.find(m=>String(m.mid)===d);P.applyCodecParameters({offerRtpParameters:o,answerMediaObject:p})}e={type:"answer",sdp:w.write(r)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:r}),C.debug("receive() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e);for(const t of v){const{kind:i,trackId:o,rtpParameters:d}=t,p=i,m=o,l=this._pc.getReceivers().find(b=>b.track&&b.track.id===m);if(!l)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(m,{mid:p,rtpParameters:d,rtpReceiver:l}),a.push({localId:m,track:l.track,rtpReceiver:l})}return a}async stopReceiving(v){this.assertRecvDirection();for(const e of v){C.debug("stopReceiving() [localId:%s]",e);const{mid:r,rtpParameters:t}=this._mapRecvLocalIdInfo.get(e)??{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:r,offerRtpParameters:t})}const a={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const s=await this._pc.createAnswer();C.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(v){this.assertRecvDirection();const{rtpReceiver:a}=this._mapRecvLocalIdInfo.get(v)??{};if(!a)throw new Error("associated RTCRtpReceiver not found");return a.getStats()}async pauseReceiving(v){}async resumeReceiving(v){}async receiveDataChannel({sctpStreamParameters:v,label:a,protocol:s}){this.assertRecvDirection();const{streamId:e,ordered:r,maxPacketLifeTime:t,maxRetransmits:i}=v,o={negotiated:!0,id:e,ordered:r,maxPacketLifeTime:t,maxRetransmits:i,protocol:s};C.debug("receiveDataChannel() [options:%o]",o);const d=this._pc.createDataChannel(a,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const p={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);const m=await this._pc.createAnswer();if(!this._transportReady){const l=w.parse(m.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l})}C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setLocalDescription(m),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:v,localSdpObject:a}){a||(a=w.parse(this._pc.localDescription.sdp));const s=P.extractDtlsParameters({sdpObject:a});s.role=v,this._remoteSdp.updateDtlsRole(v==="client"?"server":"client"),await new Promise((e,r)=>{this.safeEmit("@connect",{dtlsParameters:s},e,r)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Bt.Safari11=n,Bt}var qt={},$t={},ei;function $n(){if(ei)return $t;ei=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.getCapabilities=D,$t.mangleRtpParameters=T;const w=re();function D(){const c=RTCRtpReceiver.getCapabilities(),P=w.clone(c);for(const R of P.codecs??[]){if(R.channels=R.numChannels,delete R.numChannels,R.mimeType=R.mimeType??`${R.kind}/${R.name}`,R.parameters){const f=R.parameters;f.apt&&(f.apt=Number(f.apt)),f["packetization-mode"]&&(f["packetization-mode"]=Number(f["packetization-mode"]))}for(const f of R.rtcpFeedback??[])f.parameter||(f.parameter="")}return P}function T(c){const P=w.clone(c);P.mid&&(P.muxId=P.mid,delete P.mid);for(const R of P.codecs)R.channels&&(R.numChannels=R.channels,delete R.channels),R.mimeType&&!R.name&&(R.name=R.mimeType.split("/")[1]),delete R.mimeType;return P}return $t}var ti;function Un(){if(ti)return qt;ti=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.Edge11=void 0;const w=J(),D=ne(),T=re(),c=ae(),P=$n(),R=he(),f=new w.Logger("Edge11"),_="Edge11";let C=class Gi extends R.HandlerInterface{constructor(){super();E(this,"_sendingRtpParametersByKind");E(this,"_remoteIceParameters");E(this,"_remoteIceCandidates");E(this,"_remoteDtlsParameters");E(this,"_iceGatherer");E(this,"_iceTransport");E(this,"_dtlsTransport");E(this,"_rtpSenders",new Map);E(this,"_rtpReceivers",new Map);E(this,"_nextSendLocalId",0);E(this,"_cname");E(this,"_transportReady",!1)}static createFactory(){return()=>new Gi}get name(){return _}close(){f.debug("close()");try{this._iceGatherer.close()}catch{}try{this._iceTransport.stop()}catch{}try{this._dtlsTransport.stop()}catch{}for(const n of this._rtpSenders.values())try{n.stop()}catch{}for(const n of this._rtpReceivers.values())try{n.stop()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){return f.debug("getNativeRtpCapabilities()"),P.getCapabilities()}async getNativeSctpCapabilities(){return f.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:n,iceParameters:y,iceCandidates:u,dtlsParameters:v,sctpParameters:a,iceServers:s,iceTransportPolicy:e,additionalSettings:r,proprietaryConstraints:t,extendedRtpCapabilities:i}){f.debug("run()"),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",i),video:c.getSendingRtpParameters("video",i)},this._remoteIceParameters=y,this._remoteIceCandidates=u,this._remoteDtlsParameters=v,this._cname=`CNAME-${T.generateRandomNumber()}`,this.setIceGatherer({iceServers:s,iceTransportPolicy:e}),this.setIceTransport(),this.setDtlsTransport()}async updateIceServers(n){throw new D.UnsupportedError("not supported")}async restartIce(n){if(f.debug("restartIce()"),this._remoteIceParameters=n,!!this._transportReady){f.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,n,"controlling");for(const y of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(y);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:n,encodings:y,codecOptions:u,codec:v}){f.debug("send() [kind:%s, track.id:%s]",n.kind,n.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),f.debug("send() | calling new RTCRtpSender()");const a=new RTCRtpSender(n,this._dtlsTransport),s=T.clone(this._sendingRtpParametersByKind[n.kind]);s.codecs=c.reduceCodecs(s.codecs,v);const e=s.codecs.some(i=>/.+\/rtx$/i.test(i.mimeType));y||(y=[{}]);for(const i of y)i.ssrc=T.generateRandomNumber(),e&&(i.rtx={ssrc:T.generateRandomNumber()});s.encodings=y,s.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const r=P.mangleRtpParameters(s);f.debug("send() | calling rtpSender.send() [params:%o]",r),await a.send(r);const t=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(t,a),{localId:t,rtpParameters:s,rtpSender:a}}async stopSending(n){f.debug("stopSending() [localId:%s]",n);const y=this._rtpSenders.get(n);if(!y)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(n);try{f.debug("stopSending() | calling rtpSender.stop()"),y.stop()}catch(u){throw f.warn("stopSending() | rtpSender.stop() failed:%o",u),u}}async pauseSending(n){}async resumeSending(n){}async replaceTrack(n,y){y?f.debug("replaceTrack() [localId:%s, track.id:%s]",n,y.id):f.debug("replaceTrack() [localId:%s, no track]",n);const u=this._rtpSenders.get(n);if(!u)throw new Error("RTCRtpSender not found");u.setTrack(y)}async setMaxSpatialLayer(n,y){f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",n,y);const u=this._rtpSenders.get(n);if(!u)throw new Error("RTCRtpSender not found");const v=u.getParameters();v.encodings.forEach((a,s)=>{s<=y?a.active=!0:a.active=!1}),await u.setParameters(v)}async setRtpEncodingParameters(n,y){f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",n,y);const u=this._rtpSenders.get(n);if(!u)throw new Error("RTCRtpSender not found");const v=u.getParameters();v.encodings.forEach((a,s)=>{v.encodings[s]={...a,...y}}),await u.setParameters(v)}async getSenderStats(n){const y=this._rtpSenders.get(n);if(!y)throw new Error("RTCRtpSender not found");return y.getStats()}async sendDataChannel(n){throw new D.UnsupportedError("not implemented")}async receive(n){const y=[];for(const u of n){const{trackId:v,kind:a}=u;f.debug("receive() [trackId:%s, kind:%s]",v,a)}this._transportReady||await this.setupTransport({localDtlsRole:"server"});for(const u of n){const{trackId:v,kind:a,rtpParameters:s}=u;f.debug("receive() | calling new RTCRtpReceiver()");const e=new RTCRtpReceiver(this._dtlsTransport,a);e.addEventListener("error",i=>{f.error('rtpReceiver "error" event [event:%o]',i)});const r=P.mangleRtpParameters(s);f.debug("receive() | calling rtpReceiver.receive() [params:%o]",r),await e.receive(r);const t=v;this._rtpReceivers.set(t,e),y.push({localId:t,track:e.track,rtpReceiver:e})}return y}async stopReceiving(n){for(const y of n){f.debug("stopReceiving() [localId:%s]",y);const u=this._rtpReceivers.get(y);if(!u)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(y);try{f.debug("stopReceiving() | calling rtpReceiver.stop()"),u.stop()}catch(v){f.warn("stopReceiving() | rtpReceiver.stop() failed:%o",v)}}}async pauseReceiving(n){}async resumeReceiving(n){}async getReceiverStats(n){const y=this._rtpReceivers.get(n);if(!y)throw new Error("RTCRtpReceiver not found");return y.getStats()}async receiveDataChannel(n){throw new D.UnsupportedError("not implemented")}setIceGatherer({iceServers:n,iceTransportPolicy:y}){const u=new RTCIceGatherer({iceServers:n??[],gatherPolicy:y??"all"});u.addEventListener("error",v=>{f.error('iceGatherer "error" event [event:%o]',v)});try{u.gather()}catch(v){f.debug("setIceGatherer() | iceGatherer.gather() failed: %s",v.toString())}this._iceGatherer=u}setIceTransport(){const n=new RTCIceTransport(this._iceGatherer);n.addEventListener("statechange",()=>{switch(n.state){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}),n.addEventListener("icestatechange",()=>{switch(n.state){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}),n.addEventListener("candidatepairchange",y=>{f.debug('iceTransport "candidatepairchange" event [pair:%o]',y.pair)}),this._iceTransport=n}setDtlsTransport(){const n=new RTCDtlsTransport(this._iceTransport);n.addEventListener("statechange",()=>{f.debug('dtlsTransport "statechange" event [state:%s]',n.state)}),n.addEventListener("dtlsstatechange",()=>{f.debug('dtlsTransport "dtlsstatechange" event [state:%s]',n.state),n.state==="closed"&&this.emit("@connectionstatechange","closed")}),n.addEventListener("error",y=>{f.error('dtlsTransport "error" event [event:%o]',y)}),this._dtlsTransport=n}async setupTransport({localDtlsRole:n}){f.debug("setupTransport()");const y=this._dtlsTransport.getLocalParameters();y.role=n,await new Promise((u,v)=>{this.safeEmit("@connect",{dtlsParameters:y},u,v)}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const u of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(u);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(u=>u.algorithm==="sha-256"||u.algorithm==="sha-384"||u.algorithm==="sha-512"),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}};return qt.Edge11=C,qt}var Ut={},ri;function zn(){if(ri)return Ut;ri=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.ReactNativeUnifiedPlan=void 0;const w=fe(),D=J(),T=re(),c=ae(),P=ye(),R=Ye(),f=Rr(),_=ne(),C=he(),g=Se(),h=qe(),n=new D.Logger("ReactNativeUnifiedPlan"),y="ReactNativeUnifiedPlan",u={OS:1024,MIS:1024};let v=class Wi extends C.HandlerInterface{constructor(){super();E(this,"_closed",!1);E(this,"_direction");E(this,"_remoteSdp");E(this,"_sendingRtpParametersByKind");E(this,"_sendingRemoteRtpParametersByKind");E(this,"_forcedLocalDtlsRole");E(this,"_pc");E(this,"_mapMidTransceiver",new Map);E(this,"_sendStream",new MediaStream);E(this,"_hasDataChannelMediaSection",!1);E(this,"_nextSendSctpStreamId",0);E(this,"_transportReady",!1)}static createFactory(){return()=>new Wi}get name(){return y}close(){if(n.debug("close()"),!this._closed){if(this._closed=!0,this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){n.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const r=await e.createOffer();try{e.close()}catch{}const t=w.parse(r.sdp),i=P.extractRtpCapabilities({sdpObject:t});return f.addNackSupportForOpus(i),i}catch(r){try{e.close()}catch{}throw r}}async getNativeSctpCapabilities(){return n.debug("getNativeSctpCapabilities()"),{numStreams:u}}run({direction:e,iceParameters:r,iceCandidates:t,dtlsParameters:i,sctpParameters:o,iceServers:d,iceTransportPolicy:p,additionalSettings:m,proprietaryConstraints:l,extendedRtpCapabilities:b}){this.assertNotClosed(),n.debug("run()"),this._direction=e,this._remoteSdp=new g.RemoteSdp({iceParameters:r,iceCandidates:t,dtlsParameters:i,sctpParameters:o}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",b),video:c.getSendingRtpParameters("video",b)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",b),video:c.getSendingRemoteRtpParameters("video",b)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:d??[],iceTransportPolicy:p??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...m},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",k=>{this.emit("@icecandidateerror",k)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(n.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(e){this.assertNotClosed(),n.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=e,this._pc.setConfiguration(r)}async restartIce(e){if(this.assertNotClosed(),n.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});n.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const t={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const t=await this._pc.createAnswer();n.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:r,codecOptions:t,codec:i,onRtpSender:o}){this.assertNotClosed(),this.assertSendDirection(),n.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),r&&r.length>1&&r.forEach((N,V)=>{N.rid=`r${V}`});const d=T.clone(this._sendingRtpParametersByKind[e.kind]);d.codecs=c.reduceCodecs(d.codecs,i);const p=T.clone(this._sendingRemoteRtpParametersByKind[e.kind]);p.codecs=c.reduceCodecs(p.codecs,i);const m=this._remoteSdp.getNextMediaSectionIdx(),l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:r});o&&o(l.sender);let b=await this._pc.createOffer(),k=w.parse(b.sdp);k.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let L;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:k});let S=!1;const x=(0,h.parse)((r??[{}])[0].scalabilityMode);r&&r.length===1&&x.spatialLayers>1&&d.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(n.debug("send() | enabling legacy simulcast for VP9 SVC"),S=!0,k=w.parse(b.sdp),L=k.media[m.idx],R.addLegacySimulcast({offerMediaObject:L,numStreams:x.spatialLayers}),b={type:"offer",sdp:w.write(k)}),n.debug("send() | calling pc.setLocalDescription() [offer:%o]",b),await this._pc.setLocalDescription(b);let F=l.mid??void 0;if(F||n.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),d.mid=F,k=w.parse(this._pc.localDescription.sdp),L=k.media[m.idx],d.rtcp.cname=P.getCname({offerMediaObject:L}),!r)d.encodings=R.getRtpEncodings({offerMediaObject:L});else if(r.length===1){let N=R.getRtpEncodings({offerMediaObject:L});Object.assign(N[0],r[0]),S&&(N=[N[0]]),d.encodings=N}else d.encodings=r;if(d.encodings.length>1&&(d.codecs[0].mimeType.toLowerCase()==="video/vp8"||d.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const N of d.encodings)N.scalabilityMode?N.scalabilityMode=`L1T${x.temporalLayers}`:N.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:L,reuseMid:m.reuseMid,offerRtpParameters:d,answerRtpParameters:p,codecOptions:t});const I={type:"answer",sdp:this._remoteSdp.getSdp()};return n.debug("send() | calling pc.setRemoteDescription() [answer:%o]",I),await this._pc.setRemoteDescription(I),F||(F=l.mid,d.mid=F),this._mapMidTransceiver.set(F,l),{localId:F,rtpParameters:d,rtpSender:l.sender}}async stopSending(e){if(this.assertSendDirection(),this._closed)return;n.debug("stopSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch{}const i=await this._pc.createOffer();n.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),n.debug("pauseSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(e);const t=await this._pc.createOffer();n.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),n.debug("resumeSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly";const t=await this._pc.createOffer();n.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,r){this.assertNotClosed(),this.assertSendDirection(),r?n.debug("replaceTrack() [localId:%s, track.id:%s]",e,r.id):n.debug("replaceTrack() [localId:%s, no track]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");await t.sender.replaceTrack(r)}async setMaxSpatialLayer(e,r){this.assertNotClosed(),this.assertSendDirection(),n.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const i=t.sender.getParameters();i.encodings.forEach((p,m)=>{m<=r?p.active=!0:p.active=!1}),await t.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const o=await this._pc.createOffer();n.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);const d={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d)}async setRtpEncodingParameters(e,r){this.assertNotClosed(),this.assertSendDirection(),n.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const i=t.sender.getParameters();i.encodings.forEach((p,m)=>{i.encodings[m]={...p,...r}}),await t.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const o=await this._pc.createOffer();n.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);const d={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:r,maxRetransmits:t,label:i,protocol:o}){this.assertNotClosed(),this.assertSendDirection();const d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:r,maxRetransmits:t,protocol:o};n.debug("sendDataChannel() [options:%o]",d);const p=this._pc.createDataChannel(i,d);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%u.MIS,!this._hasDataChannelMediaSection){const l=await this._pc.createOffer(),b=w.parse(l.sdp),k=b.media.find(S=>S.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:b}),n.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:k});const L={type:"answer",sdp:this._remoteSdp.getSdp()};n.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",L),await this._pc.setRemoteDescription(L),this._hasDataChannelMediaSection=!0}const m={streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits};return{dataChannel:p,sctpStreamParameters:m}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const r=[],t=new Map;for(const p of e){const{trackId:m,kind:l,rtpParameters:b,streamId:k}=p;n.debug("receive() [trackId:%s, kind:%s]",m,l);const L=b.mid??String(this._mapMidTransceiver.size);t.set(m,L),this._remoteSdp.receive({mid:L,kind:l,offerRtpParameters:b,streamId:k??b.rtcp.cname,trackId:m})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);for(const p of e){const{trackId:m,onRtpReceiver:l}=p;if(l){const b=t.get(m),k=this._pc.getTransceivers().find(L=>L.mid===b);if(!k)throw new Error("transceiver not found");l(k.receiver)}}let o=await this._pc.createAnswer();const d=w.parse(o.sdp);for(const p of e){const{trackId:m,rtpParameters:l}=p,b=t.get(m),k=d.media.find(L=>String(L.mid)===b);P.applyCodecParameters({offerRtpParameters:l,answerMediaObject:k})}o={type:"answer",sdp:w.write(d)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),n.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);for(const p of e){const{trackId:m}=p,l=t.get(m),b=this._pc.getTransceivers().find(k=>k.mid===l);if(b)this._mapMidTransceiver.set(l,b),r.push({localId:l,track:b.receiver.track,rtpReceiver:b.receiver});else throw new Error("new RTCRtpTransceiver not found")}return r}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const i of e){n.debug("stopReceiving() [localId:%s]",i);const o=this._mapMidTransceiver.get(i);if(!o)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(o.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const t=await this._pc.createAnswer();n.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t);for(const i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const i of e){n.debug("pauseReceiving() [localId:%s]",i);const o=this._mapMidTransceiver.get(i);if(!o)throw new Error("associated RTCRtpTransceiver not found");o.direction="inactive",this._remoteSdp.pauseMediaSection(i)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const t=await this._pc.createAnswer();n.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const i of e){n.debug("resumeReceiving() [localId:%s]",i);const o=this._mapMidTransceiver.get(i);if(!o)throw new Error("associated RTCRtpTransceiver not found");o.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const t=await this._pc.createAnswer();n.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:r,protocol:t}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:i,ordered:o,maxPacketLifeTime:d,maxRetransmits:p}=e,m={negotiated:!0,id:i,ordered:o,maxPacketLifeTime:d,maxRetransmits:p,protocol:t};n.debug("receiveDataChannel() [options:%o]",m);const l=this._pc.createDataChannel(r,m);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const b={type:"offer",sdp:this._remoteSdp.getSdp()};n.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",b),await this._pc.setRemoteDescription(b);const k=await this._pc.createAnswer();if(!this._transportReady){const L=w.parse(k.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:L})}n.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",k),await this._pc.setLocalDescription(k),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:r}){r||(r=w.parse(this._pc.localDescription.sdp));const t=P.extractDtlsParameters({sdpObject:r});t.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,o)=>{this.safeEmit("@connect",{dtlsParameters:t},i,o)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new _.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Ut.ReactNativeUnifiedPlan=v,Ut}var zt={},si;function Hn(){if(si)return zt;si=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.ReactNative=void 0;const w=fe(),D=J(),T=ne(),c=re(),P=ae(),R=ye(),f=Cr(),_=he(),C=Se(),g=new D.Logger("ReactNative"),h="ReactNative",n={OS:1024,MIS:1024};let y=class Qi extends _.HandlerInterface{constructor(){super();E(this,"_direction");E(this,"_remoteSdp");E(this,"_sendingRtpParametersByKind");E(this,"_sendingRemoteRtpParametersByKind");E(this,"_forcedLocalDtlsRole");E(this,"_pc");E(this,"_sendStream",new MediaStream);E(this,"_mapSendLocalIdTrack",new Map);E(this,"_nextSendLocalId",0);E(this,"_mapRecvLocalIdInfo",new Map);E(this,"_hasDataChannelMediaSection",!1);E(this,"_nextSendSctpStreamId",0);E(this,"_transportReady",!1)}static createFactory(){return()=>new Qi}get name(){return h}close(){if(g.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){g.debug("getNativeRtpCapabilities()");const a=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const s=await a.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{a.close()}catch{}const e=w.parse(s.sdp);return R.extractRtpCapabilities({sdpObject:e})}catch(s){try{a.close()}catch{}throw s}}async getNativeSctpCapabilities(){return g.debug("getNativeSctpCapabilities()"),{numStreams:n}}run({direction:a,iceParameters:s,iceCandidates:e,dtlsParameters:r,sctpParameters:t,iceServers:i,iceTransportPolicy:o,additionalSettings:d,proprietaryConstraints:p,extendedRtpCapabilities:m}){g.debug("run()"),this._direction=a,this._remoteSdp=new C.RemoteSdp({iceParameters:s,iceCandidates:e,dtlsParameters:r,sctpParameters:t,planB:!0}),this._sendingRtpParametersByKind={audio:P.getSendingRtpParameters("audio",m),video:P.getSendingRtpParameters("video",m)},this._sendingRemoteRtpParametersByKind={audio:P.getSendingRemoteRtpParameters("audio",m),video:P.getSendingRemoteRtpParameters("video",m)},r.role&&r.role!=="auto"&&(this._forcedLocalDtlsRole=r.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i??[],iceTransportPolicy:o??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...d},p),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",l=>{this.emit("@icecandidateerror",l)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(g.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(a){g.debug("updateIceServers()");const s=this._pc.getConfiguration();s.iceServers=a,this._pc.setConfiguration(s)}async restartIce(a){if(g.debug("restartIce()"),this._remoteSdp.updateIceParameters(a),!!this._transportReady)if(this._direction==="send"){const s=await this._pc.createOffer({iceRestart:!0});g.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const e={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}else{const s={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const e=await this._pc.createAnswer();g.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}}async getTransportStats(){return this._pc.getStats()}async send({track:a,encodings:s,codecOptions:e,codec:r}){this.assertSendDirection(),g.debug("send() [kind:%s, track.id:%s]",a.kind,a.id),r&&g.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(a),this._pc.addStream(this._sendStream);let t=await this._pc.createOffer(),i=w.parse(t.sdp);i.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let o;const d=c.clone(this._sendingRtpParametersByKind[a.kind]);d.codecs=P.reduceCodecs(d.codecs);const p=c.clone(this._sendingRemoteRtpParametersByKind[a.kind]);if(p.codecs=P.reduceCodecs(p.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:i}),a.kind==="video"&&s&&s.length>1&&(g.debug("send() | enabling simulcast"),i=w.parse(t.sdp),o=i.media.find(b=>b.type==="video"),f.addLegacySimulcast({offerMediaObject:o,track:a,numStreams:s.length}),t={type:"offer",sdp:w.write(i)}),g.debug("send() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),i=w.parse(this._pc.localDescription.sdp),o=i.media.find(b=>b.type===a.kind),d.rtcp.cname=R.getCname({offerMediaObject:o}),d.encodings=f.getRtpEncodings({offerMediaObject:o,track:a}),s)for(let b=0;b<d.encodings.length;++b)s[b]&&Object.assign(d.encodings[b],s[b]);if(d.encodings.length>1&&(d.codecs[0].mimeType.toLowerCase()==="video/vp8"||d.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const b of d.encodings)b.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:o,offerRtpParameters:d,answerRtpParameters:p,codecOptions:e});const m={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("send() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m);const l=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(l,a),{localId:l,rtpParameters:d}}async stopSending(a){this.assertSendDirection(),g.debug("stopSending() [localId:%s]",a);const s=this._mapSendLocalIdTrack.get(a);if(!s)throw new Error("track not found");this._mapSendLocalIdTrack.delete(a),this._sendStream.removeTrack(s),this._pc.addStream(this._sendStream);const e=await this._pc.createOffer();g.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",e);try{await this._pc.setLocalDescription(e)}catch(t){if(this._sendStream.getTracks().length===0){g.warn("stopSending() | ignoring expected error due no sending tracks: %s",t.toString());return}throw t}if(this._pc.signalingState==="stable")return;const r={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async pauseSending(a){}async resumeSending(a){}async replaceTrack(a,s){throw new T.UnsupportedError("not implemented")}async setMaxSpatialLayer(a,s){throw new T.UnsupportedError("not implemented")}async setRtpEncodingParameters(a,s){throw new T.UnsupportedError("not implemented")}async getSenderStats(a){throw new T.UnsupportedError("not implemented")}async sendDataChannel({ordered:a,maxPacketLifeTime:s,maxRetransmits:e,label:r,protocol:t}){this.assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:a,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:e,protocol:t};g.debug("sendDataChannel() [options:%o]",i);const o=this._pc.createDataChannel(r,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%n.MIS,!this._hasDataChannelMediaSection){const p=await this._pc.createOffer(),m=w.parse(p.sdp),l=m.media.find(k=>k.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:m}),g.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p),this._remoteSdp.sendSctpAssociation({offerMediaObject:l});const b={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",b),await this._pc.setRemoteDescription(b),this._hasDataChannelMediaSection=!0}const d={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:o,sctpStreamParameters:d}}async receive(a){this.assertRecvDirection();const s=[],e=new Map;for(const o of a){const{trackId:d,kind:p,rtpParameters:m}=o;g.debug("receive() [trackId:%s, kind:%s]",d,p);const l=p;let b=o.streamId??m.rtcp.cname;g.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),b+=`-hack-${c.generateRandomNumber()}`,e.set(d,b),this._remoteSdp.receive({mid:l,kind:p,offerRtpParameters:m,streamId:b,trackId:d})}const r={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);let t=await this._pc.createAnswer();const i=w.parse(t.sdp);for(const o of a){const{kind:d,rtpParameters:p}=o,m=d,l=i.media.find(b=>String(b.mid)===m);R.applyCodecParameters({offerRtpParameters:p,answerMediaObject:l})}t={type:"answer",sdp:w.write(i)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:i}),g.debug("receive() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t);for(const o of a){const{kind:d,trackId:p,rtpParameters:m}=o,l=p,b=d,k=e.get(p),S=this._pc.getRemoteStreams().find(x=>x.id===k).getTrackById(l);if(!S)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(l,{mid:b,rtpParameters:m}),s.push({localId:l,track:S})}return s}async stopReceiving(a){this.assertRecvDirection();for(const r of a){g.debug("stopReceiving() [localId:%s]",r);const{mid:t,rtpParameters:i}=this._mapRecvLocalIdInfo.get(r)??{};this._mapRecvLocalIdInfo.delete(r),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:i})}const s={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const e=await this._pc.createAnswer();g.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async pauseReceiving(a){}async resumeReceiving(a){}async getReceiverStats(a){throw new T.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:a,label:s,protocol:e}){this.assertRecvDirection();const{streamId:r,ordered:t,maxPacketLifeTime:i,maxRetransmits:o}=a,d={negotiated:!0,id:r,ordered:t,maxPacketLifeTime:i,maxRetransmitTime:i,maxRetransmits:o,protocol:e};g.debug("receiveDataChannel() [options:%o]",d);const p=this._pc.createDataChannel(s,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const m={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",m),await this._pc.setRemoteDescription(m);const l=await this._pc.createAnswer();if(!this._transportReady){const b=w.parse(l.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:b})}g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setLocalDescription(l),this._hasDataChannelMediaSection=!0}return{dataChannel:p}}async setupTransport({localDtlsRole:a,localSdpObject:s}){s||(s=w.parse(this._pc.localDescription.sdp));const e=R.extractDtlsParameters({sdpObject:s});e.role=a,this._remoteSdp.updateDtlsRole(a==="client"?"server":"client"),await new Promise((r,t)=>{this.safeEmit("@connect",{dtlsParameters:e},r,t)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return zt.ReactNative=y,zt}var ii;function Yi(){if(ii)return nt;ii=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.Device=void 0,nt.detectDevice=i;const w=gn(),D=J(),T=Be(),c=ne(),P=re(),R=ae(),f=Ni(),_=In(),C=Mn(),g=On(),h=Fn(),n=An(),y=Nn(),u=jn(),v=Bn(),a=qn(),s=Un(),e=zn(),r=Hn(),t=new D.Logger("Device");function i(d){var p,m,l,b;if(!d&&typeof navigator=="object"&&navigator.product==="ReactNative"){if(t.debug("detectDevice() | React-Native detected"),typeof RTCPeerConnection>"u"){t.warn("detectDevice() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?");return}return typeof RTCRtpTransceiver<"u"?(t.debug("detectDevice() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(t.debug("detectDevice() | ReactNative PlanB handler chosen"),"ReactNative")}else if(d||typeof navigator=="object"&&typeof navigator.userAgent=="string"){d??(d=navigator.userAgent);const k=new w.UAParser(d);t.debug("detectDevice() | browser detected [userAgent:%s, parsed:%o]",d,k.getResult());const L=k.getBrowser(),S=(p=L.name)==null?void 0:p.toLowerCase(),x=parseInt(L.major??"0"),I=(m=k.getEngine().name)==null?void 0:m.toLowerCase(),N=k.getOS(),V=(l=N.name)==null?void 0:l.toLowerCase(),Q=parseFloat(N.version??"0"),oe=(b=k.getDevice().model)==null?void 0:b.toLowerCase(),ee=V==="ios"||oe==="ipad",me=S&&["chrome","chromium","mobile chrome","chrome webview","chrome headless"].includes(S),de=S&&["firefox","mobile firefox","mobile focus"].includes(S),$e=S&&["safari","mobile safari"].includes(S),Le=S&&["edge"].includes(S);if((me||Le)&&!ee&&x>=111)return"Chrome111";if(me&&!ee&&x>=74||Le&&!ee&&x>=88)return"Chrome74";if(me&&!ee&&x>=70)return"Chrome70";if(me&&!ee&&x>=67)return"Chrome67";if(me&&!ee&&x>=55)return"Chrome55";if(de&&!ee&&x>=120)return"Firefox120";if(de&&!ee&&x>=60)return"Firefox60";if(de&&ee&&Q>=14.3)return"Safari12";if($e&&x>=12&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if($e&&x>=11)return"Safari11";if(Le&&!ee&&x>=11&&x<=18)return"Edge11";if(I==="webkit"&&ee&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(I==="blink"){const Ue=d.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(Ue){const xe=Number(Ue[1]);return xe>=111?"Chrome111":xe>=74?"Chrome74":xe>=70?"Chrome70":xe>=67?"Chrome67":"Chrome55"}else return"Chrome111"}else{t.warn("detectDevice() | browser not supported [name:%s, version:%s]",S,x);return}}else{t.warn("detectDevice() | unknown device");return}}let o=class{constructor({handlerName:p,handlerFactory:m}={}){E(this,"_handlerFactory");E(this,"_handlerName");E(this,"_loaded",!1);E(this,"_extendedRtpCapabilities");E(this,"_recvRtpCapabilities");E(this,"_canProduceByKind");E(this,"_sctpCapabilities");E(this,"_observer",new T.EnhancedEventEmitter);if(t.debug("constructor()"),p&&m)throw new TypeError("just one of handlerName or handlerInterface can be given");if(m)this._handlerFactory=m;else{if(p)t.debug("constructor() | handler given: %s",p);else if(p=i(),p)t.debug("constructor() | detected handler: %s",p);else throw new c.UnsupportedError("device not supported");switch(p){case"Chrome111":{this._handlerFactory=_.Chrome111.createFactory();break}case"Chrome74":{this._handlerFactory=C.Chrome74.createFactory();break}case"Chrome70":{this._handlerFactory=g.Chrome70.createFactory();break}case"Chrome67":{this._handlerFactory=h.Chrome67.createFactory();break}case"Chrome55":{this._handlerFactory=n.Chrome55.createFactory();break}case"Firefox120":{this._handlerFactory=y.Firefox120.createFactory();break}case"Firefox60":{this._handlerFactory=u.Firefox60.createFactory();break}case"Safari12":{this._handlerFactory=v.Safari12.createFactory();break}case"Safari11":{this._handlerFactory=a.Safari11.createFactory();break}case"Edge11":{this._handlerFactory=s.Edge11.createFactory();break}case"ReactNativeUnifiedPlan":{this._handlerFactory=e.ReactNativeUnifiedPlan.createFactory();break}case"ReactNative":{this._handlerFactory=r.ReactNative.createFactory();break}default:throw new TypeError(`unknown handlerName "${p}"`)}}const l=this._handlerFactory();this._handlerName=l.name,l.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new c.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new c.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:p}){t.debug("load() [routerRtpCapabilities:%o]",p);let m;try{if(this._loaded)throw new c.InvalidStateError("already loaded");const l=P.clone(p);R.validateRtpCapabilities(l),m=this._handlerFactory();const b=await m.getNativeRtpCapabilities();t.debug("load() | got native RTP capabilities:%o",b);const k=P.clone(b);R.validateRtpCapabilities(k),this._extendedRtpCapabilities=R.getExtendedRtpCapabilities(k,l),t.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=R.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=R.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=R.getRecvRtpCapabilities(this._extendedRtpCapabilities),R.validateRtpCapabilities(this._recvRtpCapabilities),t.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await m.getNativeSctpCapabilities(),t.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),R.validateSctpCapabilities(this._sctpCapabilities),t.debug("load() succeeded"),this._loaded=!0,m.close()}catch(l){throw m&&m.close(),l}}canProduce(p){if(this._loaded){if(p!=="audio"&&p!=="video")throw new TypeError(`invalid kind "${p}"`)}else throw new c.InvalidStateError("not loaded");return this._canProduceByKind[p]}createSendTransport({id:p,iceParameters:m,iceCandidates:l,dtlsParameters:b,sctpParameters:k,iceServers:L,iceTransportPolicy:S,additionalSettings:x,proprietaryConstraints:F,appData:I}){return t.debug("createSendTransport()"),this.createTransport({direction:"send",id:p,iceParameters:m,iceCandidates:l,dtlsParameters:b,sctpParameters:k,iceServers:L,iceTransportPolicy:S,additionalSettings:x,proprietaryConstraints:F,appData:I})}createRecvTransport({id:p,iceParameters:m,iceCandidates:l,dtlsParameters:b,sctpParameters:k,iceServers:L,iceTransportPolicy:S,additionalSettings:x,proprietaryConstraints:F,appData:I}){return t.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:p,iceParameters:m,iceCandidates:l,dtlsParameters:b,sctpParameters:k,iceServers:L,iceTransportPolicy:S,additionalSettings:x,proprietaryConstraints:F,appData:I})}createTransport({direction:p,id:m,iceParameters:l,iceCandidates:b,dtlsParameters:k,sctpParameters:L,iceServers:S,iceTransportPolicy:x,additionalSettings:F,proprietaryConstraints:I,appData:N}){if(this._loaded){if(typeof m!="string")throw new TypeError("missing id");if(typeof l!="object")throw new TypeError("missing iceParameters");if(Array.isArray(b)){if(typeof k!="object")throw new TypeError("missing dtlsParameters");if(L&&typeof L!="object")throw new TypeError("wrong sctpParameters");if(N&&typeof N!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing iceCandidates")}else throw new c.InvalidStateError("not loaded");const V=new f.Transport({direction:p,id:m,iceParameters:l,iceCandidates:b,dtlsParameters:k,sctpParameters:L,iceServers:S,iceTransportPolicy:x,additionalSettings:F,proprietaryConstraints:I,appData:N,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",V),V}};return nt.Device=o,nt}var Kr={},ni;function Vn(){return ni||(ni=1,Object.defineProperty(Kr,"__esModule",{value:!0})),Kr}var Gr={},ai;function Kn(){return ai||(ai=1,Object.defineProperty(Gr,"__esModule",{value:!0})),Gr}var oi;function Gn(){return oi||(oi=1,function(w){var D=Ve&&Ve.__createBinding||(Object.create?function(c,P,R,f){f===void 0&&(f=R);var _=Object.getOwnPropertyDescriptor(P,R);(!_||("get"in _?!P.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return P[R]}}),Object.defineProperty(c,f,_)}:function(c,P,R,f){f===void 0&&(f=R),c[f]=P[R]}),T=Ve&&Ve.__exportStar||function(c,P){for(var R in c)R!=="default"&&!Object.prototype.hasOwnProperty.call(P,R)&&D(P,c,R)};Object.defineProperty(w,"__esModule",{value:!0}),T(Yi(),w),T(Ni(),w),T(Mi(),w),T(Oi(),w),T(Fi(),w),T(Ai(),w),T(Vn(),w),T(Kn(),w),T(he(),w),T(ne(),w)}(Ve)),Ve}var Ht={},Wr={},ge={},ci;function Wn(){if(ci)return ge;ci=1,Object.defineProperty(ge,"__esModule",{value:!0});function w(O,M,...A){if(!O)throw new TypeError(D(M,A))}function D(O,M){let A=0;return O.replace(/%[os]/gu,()=>T(M[A++]))}function T(O){return typeof O!="object"||O===null?String(O):Object.prototype.toString.call(O)}let c;function P(O){w(typeof O=="function"||O===void 0,"The error handler must be a function or undefined, but got %o.",O),c=O}function R(O){try{const M=O instanceof Error?O:new Error(T(O));if(c){c(M);return}if(typeof dispatchEvent=="function"&&typeof ErrorEvent=="function")dispatchEvent(new ErrorEvent("error",{error:M,message:M.message}));else if(typeof process<"u"&&typeof process.emit=="function"){process.emit("uncaughtException",M);return}console.error(M)}catch{}}const f=typeof window<"u"?window:typeof self<"u"?self:typeof ns<"u"?ns:typeof globalThis<"u"?globalThis:void 0;let _;function C(O){w(typeof O=="function"||O===void 0,"The warning handler must be a function or undefined, but got %o.",O),_=O}class g{constructor(M,A){this.code=M,this.message=A}warn(...M){var A;try{if(_){_({...this,args:M});return}const B=((A=new Error().stack)!==null&&A!==void 0?A:"").replace(/^(?:.+?\n){2}/gu,`
`);console.warn(this.message,...M,B)}catch{}}}const h=new g("W01","Unable to initialize event under dispatching."),n=new g("W02","Assigning any falsy value to 'cancelBubble' property has no effect."),y=new g("W03","Assigning any truthy value to 'returnValue' property has no effect."),u=new g("W04","Unable to preventDefault on non-cancelable events."),v=new g("W05","Unable to preventDefault inside passive event listener invocation."),a=new g("W06","An event listener wasn't added because it has been added already: %o, %o"),s=new g("W07","The %o option value was abandoned because the event listener wasn't added as duplicated."),e=new g("W08","The 'callback' argument must be a function or an object that has 'handleEvent' method: %o"),r=new g("W09","Event attribute handler must be a function: %o");class t{static get NONE(){return i}static get CAPTURING_PHASE(){return o}static get AT_TARGET(){return d}static get BUBBLING_PHASE(){return p}constructor(M,A){Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});const B=A??{};m.set(this,{type:String(M),bubbles:!!B.bubbles,cancelable:!!B.cancelable,composed:!!B.composed,target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1,inPassiveListenerFlag:!1,dispatchFlag:!1,timeStamp:Date.now()})}get type(){return l(this).type}get target(){return l(this).target}get srcElement(){return l(this).target}get currentTarget(){return l(this).currentTarget}composedPath(){const M=l(this).currentTarget;return M?[M]:[]}get NONE(){return i}get CAPTURING_PHASE(){return o}get AT_TARGET(){return d}get BUBBLING_PHASE(){return p}get eventPhase(){return l(this).dispatchFlag?2:0}stopPropagation(){l(this).stopPropagationFlag=!0}get cancelBubble(){return l(this).stopPropagationFlag}set cancelBubble(M){M?l(this).stopPropagationFlag=!0:n.warn()}stopImmediatePropagation(){const M=l(this);M.stopPropagationFlag=M.stopImmediatePropagationFlag=!0}get bubbles(){return l(this).bubbles}get cancelable(){return l(this).cancelable}get returnValue(){return!l(this).canceledFlag}set returnValue(M){M?y.warn():b(l(this))}preventDefault(){b(l(this))}get defaultPrevented(){return l(this).canceledFlag}get composed(){return l(this).composed}get isTrusted(){return!1}get timeStamp(){return l(this).timeStamp}initEvent(M,A=!1,B=!1){const U=l(this);if(U.dispatchFlag){h.warn();return}m.set(this,{...U,type:String(M),bubbles:!!A,cancelable:!!B,target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1})}}const i=0,o=1,d=2,p=3,m=new WeakMap;function l(O,M="this"){const A=m.get(O);return w(A!=null,"'%s' must be an object that Event constructor created, but got another one: %o",M,O),A}function b(O){if(O.inPassiveListenerFlag){v.warn();return}if(!O.cancelable){u.warn();return}O.canceledFlag=!0}Object.defineProperty(t,"NONE",{enumerable:!0}),Object.defineProperty(t,"CAPTURING_PHASE",{enumerable:!0}),Object.defineProperty(t,"AT_TARGET",{enumerable:!0}),Object.defineProperty(t,"BUBBLING_PHASE",{enumerable:!0});const k=Object.getOwnPropertyNames(t.prototype);for(let O=0;O<k.length;++O)k[O]!=="constructor"&&Object.defineProperty(t.prototype,k[O],{enumerable:!0});typeof f<"u"&&typeof f.Event<"u"&&Object.setPrototypeOf(t.prototype,f.Event.prototype);function L(O){return f.DOMException?new f.DOMException(O,"InvalidStateError"):(S==null&&(S=class Xi extends Error{constructor(A){super(A),Error.captureStackTrace&&Error.captureStackTrace(this,Xi)}get code(){return 11}get name(){return"InvalidStateError"}},Object.defineProperties(S.prototype,{code:{enumerable:!0},name:{enumerable:!0}}),F(S),F(S.prototype)),new S(O))}let S;const x={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function F(O){const M=Object.keys(x);for(let A=0;A<M.length;++A){const B=M[A],U=x[B];Object.defineProperty(O,B,{get(){return U},configurable:!0,enumerable:!0})}}class I extends t{static wrap(M){return new(we(M))(M)}constructor(M){super(M.type,{bubbles:M.bubbles,cancelable:M.cancelable,composed:M.composed}),M.cancelBubble&&super.stopPropagation(),M.defaultPrevented&&super.preventDefault(),N.set(this,{original:M});const A=Object.keys(M);for(let B=0;B<A.length;++B){const U=A[B];U in this||Object.defineProperty(this,U,ee(M,U))}}stopPropagation(){super.stopPropagation();const{original:M}=V(this);"stopPropagation"in M&&M.stopPropagation()}get cancelBubble(){return super.cancelBubble}set cancelBubble(M){super.cancelBubble=M;const{original:A}=V(this);"cancelBubble"in A&&(A.cancelBubble=M)}stopImmediatePropagation(){super.stopImmediatePropagation();const{original:M}=V(this);"stopImmediatePropagation"in M&&M.stopImmediatePropagation()}get returnValue(){return super.returnValue}set returnValue(M){super.returnValue=M;const{original:A}=V(this);"returnValue"in A&&(A.returnValue=M)}preventDefault(){super.preventDefault();const{original:M}=V(this);"preventDefault"in M&&M.preventDefault()}get timeStamp(){const{original:M}=V(this);return"timeStamp"in M?M.timeStamp:super.timeStamp}}const N=new WeakMap;function V(O){const M=N.get(O);return w(M!=null,"'this' is expected an Event object, but got",O),M}const Q=new WeakMap;Q.set(Object.prototype,I),typeof f<"u"&&typeof f.Event<"u"&&Q.set(f.Event.prototype,I);function we(O){const M=Object.getPrototypeOf(O);if(M==null)return I;let A=Q.get(M);return A==null&&(A=oe(we(M),M),Q.set(M,A)),A}function oe(O,M){class A extends O{}const B=Object.keys(M);for(let U=0;U<B.length;++U)Object.defineProperty(A.prototype,B[U],ee(M,B[U]));return A}function ee(O,M){const A=Object.getOwnPropertyDescriptor(O,M);return{get(){const B=V(this).original,U=B[M];return typeof U=="function"?U.bind(B):U},set(B){const U=V(this).original;U[M]=B},configurable:A.configurable,enumerable:A.enumerable}}function me(O,M,A,B,U,te){return{callback:O,flags:(M?1:0)|(A?2:0)|(B?4:0),signal:U,signalListener:te}}function de(O){O.flags|=8}function $e(O){return(O.flags&1)===1}function Le(O){return(O.flags&2)===2}function Ue(O){return(O.flags&4)===4}function xe(O){return(O.flags&8)===8}function Er({callback:O},M,A){try{typeof O=="function"?O.call(M,A):typeof O.handleEvent=="function"&&O.handleEvent(A)}catch(B){R(B)}}function ar({listeners:O},M,A){for(let B=0;B<O.length;++B)if(O[B].callback===M&&$e(O[B])===A)return B;return-1}function ct(O,M,A,B,U,te){let ie;te&&(ie=dt.bind(null,O,M,A),te.addEventListener("abort",ie));const Z=me(M,A,B,U,te,ie);return O.cow?(O.cow=!1,O.listeners=[...O.listeners,Z]):O.listeners.push(Z),Z}function dt(O,M,A){const B=ar(O,M,A);return B!==-1?pt(O,B):!1}function pt(O,M,A=!1){const B=O.listeners[M];return de(B),B.signal&&B.signal.removeEventListener("abort",B.signalListener),O.cow&&!A?(O.cow=!1,O.listeners=O.listeners.filter((U,te)=>te!==M),!1):(O.listeners.splice(M,1),!0)}function Xe(){return Object.create(null)}function Re(O,M){var A;return(A=O[M])!==null&&A!==void 0?A:O[M]={attrCallback:void 0,attrListener:void 0,cow:!1,listeners:[]}}class Ce{constructor(){lt.set(this,Xe())}addEventListener(M,A,B){const U=pe(this),{callback:te,capture:ie,once:Z,passive:le,signal:Me,type:Oe}=or(M,A,B);if(te==null||Me!=null&&Me.aborted)return;const Te=Re(U,Oe),tt=ar(Te,te,ie);if(tt!==-1){Je(Te.listeners[tt],le,Z,Me);return}ct(Te,te,ie,le,Z,Me)}removeEventListener(M,A,B){const U=pe(this),{callback:te,capture:ie,type:Z}=cr(M,A,B),le=U[Z];te!=null&&le&&dt(le,te,ie)}dispatchEvent(M){const A=pe(this)[String(M.type)];if(A==null)return!0;const B=M instanceof t?M:I.wrap(M),U=l(B,"event");if(U.dispatchFlag)throw L("This event has been in dispatching.");if(U.dispatchFlag=!0,U.target=U.currentTarget=this,!U.stopPropagationFlag){const{cow:te,listeners:ie}=A;A.cow=!0;for(let Z=0;Z<ie.length;++Z){const le=ie[Z];if(!xe(le)&&(Ue(le)&&pt(A,Z,!te)&&(Z-=1),U.inPassiveListenerFlag=Le(le),Er(le,this,B),U.inPassiveListenerFlag=!1,U.stopImmediatePropagationFlag))break}te||(A.cow=!1)}return U.target=null,U.currentTarget=null,U.stopImmediatePropagationFlag=!1,U.stopPropagationFlag=!1,U.dispatchFlag=!1,!U.canceledFlag}}const lt=new WeakMap;function pe(O,M="this"){const A=lt.get(O);return w(A!=null,"'%s' must be an object that EventTarget constructor created, but got another one: %o",M,O),A}function or(O,M,A){var B;return ut(M),typeof A=="object"&&A!==null?{type:String(O),callback:M??void 0,capture:!!A.capture,passive:!!A.passive,once:!!A.once,signal:(B=A.signal)!==null&&B!==void 0?B:void 0}:{type:String(O),callback:M??void 0,capture:!!A,passive:!1,once:!1,signal:void 0}}function cr(O,M,A){return ut(M),typeof A=="object"&&A!==null?{type:String(O),callback:M??void 0,capture:!!A.capture}:{type:String(O),callback:M??void 0,capture:!!A}}function ut(O){if(!(typeof O=="function"||typeof O=="object"&&O!==null&&typeof O.handleEvent=="function")){if(O==null||typeof O=="object"){e.warn(O);return}throw new TypeError(D(e.message,[O]))}}function Je(O,M,A,B){a.warn($e(O)?"capture":"bubble",O.callback),Le(O)!==M&&s.warn("passive"),Ue(O)!==A&&s.warn("once"),O.signal!==B&&s.warn("signal")}const ze=Object.getOwnPropertyNames(Ce.prototype);for(let O=0;O<ze.length;++O)ze[O]!=="constructor"&&Object.defineProperty(Ce.prototype,ze[O],{enumerable:!0});typeof f<"u"&&typeof f.EventTarget<"u"&&Object.setPrototypeOf(Ce.prototype,f.EventTarget.prototype);function Ze(O,M){var A,B;return(B=(A=pe(O,"target")[M])===null||A===void 0?void 0:A.attrCallback)!==null&&B!==void 0?B:null}function et(O,M,A){A!=null&&typeof A!="function"&&r.warn(A),typeof A=="function"||typeof A=="object"&&A!==null?dr(O,M,A):ft(O,M)}function dr(O,M,A){const B=Re(pe(O,"target"),String(M));B.attrCallback=A,B.attrListener==null&&(B.attrListener=ct(B,He(B),!1,!1,!1,void 0))}function ft(O,M){const B=pe(O,"target")[String(M)];B&&B.attrListener&&(dt(B,B.attrListener.callback,!1),B.attrCallback=B.attrListener=void 0)}function He(O){return function(M){const A=O.attrCallback;typeof A=="function"&&A.call(this,M)}}function pr(...O){class M extends Ce{}for(let A=0;A<O.length;++A)Ie(M.prototype,O[A]);return M}function Ie(O,M,A){Object.defineProperty(O,`on${M}`,{get(){return Ze(this,M)},set(B){et(this,M,B)},configurable:!0,enumerable:!0})}return ge.Event=t,ge.EventTarget=Ce,ge.default=Ce,ge.defineCustomEventTarget=pr,ge.defineEventAttribute=Ie,ge.getEventAttributeValue=Ze,ge.setErrorHandler=P,ge.setEventAttributeValue=et,ge.setWarningHandler=C,ge}var Qr={},Vt={},Sr={},di;function Ji(){if(di)return Sr;di=1,Object.defineProperty(Sr,"__esModule",{value:!0}),Sr.default=T;let w;const D=new Uint8Array(16);function T(){if(!w&&(w=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!w))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return w(D)}return Sr}var ot={},Kt={},Gt={},pi;function Qn(){if(pi)return Gt;pi=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.default=void 0;var w=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;return Gt.default=w,Gt}var li;function Tr(){if(li)return Kt;li=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.default=void 0;var w=D(Qn());function D(P){return P&&P.__esModule?P:{default:P}}function T(P){return typeof P=="string"&&w.default.test(P)}var c=T;return Kt.default=c,Kt}var ui;function Dr(){if(ui)return ot;ui=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.default=void 0,ot.unsafeStringify=c;var w=D(Tr());function D(f){return f&&f.__esModule?f:{default:f}}const T=[];for(let f=0;f<256;++f)T.push((f+256).toString(16).slice(1));function c(f,_=0){return T[f[_+0]]+T[f[_+1]]+T[f[_+2]]+T[f[_+3]]+"-"+T[f[_+4]]+T[f[_+5]]+"-"+T[f[_+6]]+T[f[_+7]]+"-"+T[f[_+8]]+T[f[_+9]]+"-"+T[f[_+10]]+T[f[_+11]]+T[f[_+12]]+T[f[_+13]]+T[f[_+14]]+T[f[_+15]]}function P(f,_=0){const C=c(f,_);if(!(0,w.default)(C))throw TypeError("Stringified UUID is invalid");return C}var R=P;return ot.default=R,ot}var fi;function Yn(){if(fi)return Vt;fi=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.default=void 0;var w=T(Ji()),D=Dr();function T(g){return g&&g.__esModule?g:{default:g}}let c,P,R=0,f=0;function _(g,h,n){let y=h&&n||0;const u=h||new Array(16);g=g||{};let v=g.node||c,a=g.clockseq!==void 0?g.clockseq:P;if(v==null||a==null){const o=g.random||(g.rng||w.default)();v==null&&(v=c=[o[0]|1,o[1],o[2],o[3],o[4],o[5]]),a==null&&(a=P=(o[6]<<8|o[7])&16383)}let s=g.msecs!==void 0?g.msecs:Date.now(),e=g.nsecs!==void 0?g.nsecs:f+1;const r=s-R+(e-f)/1e4;if(r<0&&g.clockseq===void 0&&(a=a+1&16383),(r<0||s>R)&&g.nsecs===void 0&&(e=0),e>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");R=s,f=e,P=a,s+=122192928e5;const t=((s&268435455)*1e4+e)%4294967296;u[y++]=t>>>24&255,u[y++]=t>>>16&255,u[y++]=t>>>8&255,u[y++]=t&255;const i=s/4294967296*1e4&268435455;u[y++]=i>>>8&255,u[y++]=i&255,u[y++]=i>>>24&15|16,u[y++]=i>>>16&255,u[y++]=a>>>8|128,u[y++]=a&255;for(let o=0;o<6;++o)u[y+o]=v[o];return h||(0,D.unsafeStringify)(u)}var C=_;return Vt.default=C,Vt}var Wt={},je={},Qt={},hi;function Zi(){if(hi)return Qt;hi=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.default=void 0;var w=D(Tr());function D(P){return P&&P.__esModule?P:{default:P}}function T(P){if(!(0,w.default)(P))throw TypeError("Invalid UUID");let R;const f=new Uint8Array(16);return f[0]=(R=parseInt(P.slice(0,8),16))>>>24,f[1]=R>>>16&255,f[2]=R>>>8&255,f[3]=R&255,f[4]=(R=parseInt(P.slice(9,13),16))>>>8,f[5]=R&255,f[6]=(R=parseInt(P.slice(14,18),16))>>>8,f[7]=R&255,f[8]=(R=parseInt(P.slice(19,23),16))>>>8,f[9]=R&255,f[10]=(R=parseInt(P.slice(24,36),16))/1099511627776&255,f[11]=R/4294967296&255,f[12]=R>>>24&255,f[13]=R>>>16&255,f[14]=R>>>8&255,f[15]=R&255,f}var c=T;return Qt.default=c,Qt}var mi;function en(){if(mi)return je;mi=1,Object.defineProperty(je,"__esModule",{value:!0}),je.URL=je.DNS=void 0,je.default=f;var w=Dr(),D=T(Zi());function T(_){return _&&_.__esModule?_:{default:_}}function c(_){_=unescape(encodeURIComponent(_));const C=[];for(let g=0;g<_.length;++g)C.push(_.charCodeAt(g));return C}const P="6ba7b810-9dad-11d1-80b4-00c04fd430c8";je.DNS=P;const R="6ba7b811-9dad-11d1-80b4-00c04fd430c8";je.URL=R;function f(_,C,g){function h(n,y,u,v){var a;if(typeof n=="string"&&(n=c(n)),typeof y=="string"&&(y=(0,D.default)(y)),((a=y)===null||a===void 0?void 0:a.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let s=new Uint8Array(16+n.length);if(s.set(y),s.set(n,y.length),s=g(s),s[6]=s[6]&15|C,s[8]=s[8]&63|128,u){v=v||0;for(let e=0;e<16;++e)u[v+e]=s[e];return u}return(0,w.unsafeStringify)(s)}try{h.name=_}catch{}return h.DNS=P,h.URL=R,h}return je}var Yt={},gi;function Xn(){if(gi)return Yt;gi=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.default=void 0;function w(u){if(typeof u=="string"){const v=unescape(encodeURIComponent(u));u=new Uint8Array(v.length);for(let a=0;a<v.length;++a)u[a]=v.charCodeAt(a)}return D(c(P(u),u.length*8))}function D(u){const v=[],a=u.length*32,s="0123456789abcdef";for(let e=0;e<a;e+=8){const r=u[e>>5]>>>e%32&255,t=parseInt(s.charAt(r>>>4&15)+s.charAt(r&15),16);v.push(t)}return v}function T(u){return(u+64>>>9<<4)+14+1}function c(u,v){u[v>>5]|=128<<v%32,u[T(v)-1]=v;let a=1732584193,s=-271733879,e=-1732584194,r=271733878;for(let t=0;t<u.length;t+=16){const i=a,o=s,d=e,p=r;a=C(a,s,e,r,u[t],7,-680876936),r=C(r,a,s,e,u[t+1],12,-389564586),e=C(e,r,a,s,u[t+2],17,606105819),s=C(s,e,r,a,u[t+3],22,-1044525330),a=C(a,s,e,r,u[t+4],7,-176418897),r=C(r,a,s,e,u[t+5],12,1200080426),e=C(e,r,a,s,u[t+6],17,-1473231341),s=C(s,e,r,a,u[t+7],22,-45705983),a=C(a,s,e,r,u[t+8],7,1770035416),r=C(r,a,s,e,u[t+9],12,-1958414417),e=C(e,r,a,s,u[t+10],17,-42063),s=C(s,e,r,a,u[t+11],22,-1990404162),a=C(a,s,e,r,u[t+12],7,1804603682),r=C(r,a,s,e,u[t+13],12,-40341101),e=C(e,r,a,s,u[t+14],17,-1502002290),s=C(s,e,r,a,u[t+15],22,1236535329),a=g(a,s,e,r,u[t+1],5,-165796510),r=g(r,a,s,e,u[t+6],9,-1069501632),e=g(e,r,a,s,u[t+11],14,643717713),s=g(s,e,r,a,u[t],20,-373897302),a=g(a,s,e,r,u[t+5],5,-701558691),r=g(r,a,s,e,u[t+10],9,38016083),e=g(e,r,a,s,u[t+15],14,-660478335),s=g(s,e,r,a,u[t+4],20,-405537848),a=g(a,s,e,r,u[t+9],5,568446438),r=g(r,a,s,e,u[t+14],9,-1019803690),e=g(e,r,a,s,u[t+3],14,-187363961),s=g(s,e,r,a,u[t+8],20,1163531501),a=g(a,s,e,r,u[t+13],5,-1444681467),r=g(r,a,s,e,u[t+2],9,-51403784),e=g(e,r,a,s,u[t+7],14,1735328473),s=g(s,e,r,a,u[t+12],20,-1926607734),a=h(a,s,e,r,u[t+5],4,-378558),r=h(r,a,s,e,u[t+8],11,-2022574463),e=h(e,r,a,s,u[t+11],16,1839030562),s=h(s,e,r,a,u[t+14],23,-35309556),a=h(a,s,e,r,u[t+1],4,-1530992060),r=h(r,a,s,e,u[t+4],11,1272893353),e=h(e,r,a,s,u[t+7],16,-155497632),s=h(s,e,r,a,u[t+10],23,-1094730640),a=h(a,s,e,r,u[t+13],4,681279174),r=h(r,a,s,e,u[t],11,-358537222),e=h(e,r,a,s,u[t+3],16,-722521979),s=h(s,e,r,a,u[t+6],23,76029189),a=h(a,s,e,r,u[t+9],4,-640364487),r=h(r,a,s,e,u[t+12],11,-421815835),e=h(e,r,a,s,u[t+15],16,530742520),s=h(s,e,r,a,u[t+2],23,-995338651),a=n(a,s,e,r,u[t],6,-198630844),r=n(r,a,s,e,u[t+7],10,1126891415),e=n(e,r,a,s,u[t+14],15,-1416354905),s=n(s,e,r,a,u[t+5],21,-57434055),a=n(a,s,e,r,u[t+12],6,1700485571),r=n(r,a,s,e,u[t+3],10,-1894986606),e=n(e,r,a,s,u[t+10],15,-1051523),s=n(s,e,r,a,u[t+1],21,-2054922799),a=n(a,s,e,r,u[t+8],6,1873313359),r=n(r,a,s,e,u[t+15],10,-30611744),e=n(e,r,a,s,u[t+6],15,-1560198380),s=n(s,e,r,a,u[t+13],21,1309151649),a=n(a,s,e,r,u[t+4],6,-145523070),r=n(r,a,s,e,u[t+11],10,-1120210379),e=n(e,r,a,s,u[t+2],15,718787259),s=n(s,e,r,a,u[t+9],21,-343485551),a=R(a,i),s=R(s,o),e=R(e,d),r=R(r,p)}return[a,s,e,r]}function P(u){if(u.length===0)return[];const v=u.length*8,a=new Uint32Array(T(v));for(let s=0;s<v;s+=8)a[s>>5]|=(u[s/8]&255)<<s%32;return a}function R(u,v){const a=(u&65535)+(v&65535);return(u>>16)+(v>>16)+(a>>16)<<16|a&65535}function f(u,v){return u<<v|u>>>32-v}function _(u,v,a,s,e,r){return R(f(R(R(v,u),R(s,r)),e),a)}function C(u,v,a,s,e,r,t){return _(v&a|~v&s,u,v,e,r,t)}function g(u,v,a,s,e,r,t){return _(v&s|a&~s,u,v,e,r,t)}function h(u,v,a,s,e,r,t){return _(v^a^s,u,v,e,r,t)}function n(u,v,a,s,e,r,t){return _(a^(v|~s),u,v,e,r,t)}var y=w;return Yt.default=y,Yt}var _i;function Jn(){if(_i)return Wt;_i=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.default=void 0;var w=T(en()),D=T(Xn());function T(R){return R&&R.__esModule?R:{default:R}}var P=(0,w.default)("v3",48,D.default);return Wt.default=P,Wt}var Xt={},Jt={},wi;function Zn(){if(wi)return Jt;wi=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.default=void 0;var D={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};return Jt.default=D,Jt}var vi;function ea(){if(vi)return Xt;vi=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.default=void 0;var w=c(Zn()),D=c(Ji()),T=Dr();function c(f){return f&&f.__esModule?f:{default:f}}function P(f,_,C){if(w.default.randomUUID&&!_&&!f)return w.default.randomUUID();f=f||{};const g=f.random||(f.rng||D.default)();if(g[6]=g[6]&15|64,g[8]=g[8]&63|128,_){C=C||0;for(let h=0;h<16;++h)_[C+h]=g[h];return _}return(0,T.unsafeStringify)(g)}var R=P;return Xt.default=R,Xt}var Zt={},er={},bi;function ta(){if(bi)return er;bi=1,Object.defineProperty(er,"__esModule",{value:!0}),er.default=void 0;function w(P,R,f,_){switch(P){case 0:return R&f^~R&_;case 1:return R^f^_;case 2:return R&f^R&_^f&_;case 3:return R^f^_}}function D(P,R){return P<<R|P>>>32-R}function T(P){const R=[1518500249,1859775393,2400959708,3395469782],f=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof P=="string"){const h=unescape(encodeURIComponent(P));P=[];for(let n=0;n<h.length;++n)P.push(h.charCodeAt(n))}else Array.isArray(P)||(P=Array.prototype.slice.call(P));P.push(128);const _=P.length/4+2,C=Math.ceil(_/16),g=new Array(C);for(let h=0;h<C;++h){const n=new Uint32Array(16);for(let y=0;y<16;++y)n[y]=P[h*64+y*4]<<24|P[h*64+y*4+1]<<16|P[h*64+y*4+2]<<8|P[h*64+y*4+3];g[h]=n}g[C-1][14]=(P.length-1)*8/Math.pow(2,32),g[C-1][14]=Math.floor(g[C-1][14]),g[C-1][15]=(P.length-1)*8&4294967295;for(let h=0;h<C;++h){const n=new Uint32Array(80);for(let e=0;e<16;++e)n[e]=g[h][e];for(let e=16;e<80;++e)n[e]=D(n[e-3]^n[e-8]^n[e-14]^n[e-16],1);let y=f[0],u=f[1],v=f[2],a=f[3],s=f[4];for(let e=0;e<80;++e){const r=Math.floor(e/20),t=D(y,5)+w(r,u,v,a)+s+R[r]+n[e]>>>0;s=a,a=v,v=D(u,30)>>>0,u=y,y=t}f[0]=f[0]+y>>>0,f[1]=f[1]+u>>>0,f[2]=f[2]+v>>>0,f[3]=f[3]+a>>>0,f[4]=f[4]+s>>>0}return[f[0]>>24&255,f[0]>>16&255,f[0]>>8&255,f[0]&255,f[1]>>24&255,f[1]>>16&255,f[1]>>8&255,f[1]&255,f[2]>>24&255,f[2]>>16&255,f[2]>>8&255,f[2]&255,f[3]>>24&255,f[3]>>16&255,f[3]>>8&255,f[3]&255,f[4]>>24&255,f[4]>>16&255,f[4]>>8&255,f[4]&255]}var c=T;return er.default=c,er}var yi;function ra(){if(yi)return Zt;yi=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.default=void 0;var w=T(en()),D=T(ta());function T(R){return R&&R.__esModule?R:{default:R}}var P=(0,w.default)("v5",80,D.default);return Zt.default=P,Zt}var tr={},Si;function sa(){if(Si)return tr;Si=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.default=void 0;var w="00000000-0000-0000-0000-000000000000";return tr.default=w,tr}var rr={},Ri;function ia(){if(Ri)return rr;Ri=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.default=void 0;var w=D(Tr());function D(P){return P&&P.__esModule?P:{default:P}}function T(P){if(!(0,w.default)(P))throw TypeError("Invalid UUID");return parseInt(P.slice(14,15),16)}var c=T;return rr.default=c,rr}var Ci;function na(){return Ci||(Ci=1,function(w){Object.defineProperty(w,"__esModule",{value:!0}),Object.defineProperty(w,"NIL",{enumerable:!0,get:function(){return R.default}}),Object.defineProperty(w,"parse",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(w,"stringify",{enumerable:!0,get:function(){return C.default}}),Object.defineProperty(w,"v1",{enumerable:!0,get:function(){return D.default}}),Object.defineProperty(w,"v3",{enumerable:!0,get:function(){return T.default}}),Object.defineProperty(w,"v4",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(w,"v5",{enumerable:!0,get:function(){return P.default}}),Object.defineProperty(w,"validate",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(w,"version",{enumerable:!0,get:function(){return f.default}});var D=h(Yn()),T=h(Jn()),c=h(ea()),P=h(ra()),R=h(sa()),f=h(ia()),_=h(Tr()),C=h(Dr()),g=h(Zi());function h(n){return n&&n.__esModule?n:{default:n}}}(Qr)),Qr}var Ti;function aa(){if(Ti)return Wr;Ti=1;const{EventTarget:w,defineEventAttribute:D}=Wn(),T=na().v4;class c extends w{constructor({kind:R,id:f,label:_,isolated:C,muted:g,readyState:h,constraints:n,data:y}={}){if(super(),!R)throw new TypeError("missing kind");this._id=f||T(),this._kind=R,this._label=_||"",this._isolated=C||!1,this._enabled=!0,this._muted=g||!1,this._readyState=h||"live",this._constraints=n||{},this._data=y||{}}get id(){return this._id}get kind(){return this._kind}get label(){return this._label}get isolated(){return this._isolated}get enabled(){return this._enabled}set enabled(R){const f=this._enabled!==R;this._enabled=R,f&&this.dispatchEvent({type:"@enabledchange"})}get muted(){return this._muted}get readyState(){return this._readyState}get data(){return this._data}set data(R){throw new TypeError("cannot replace data object")}clone({id:R,data:f}={}){return new c({id:R||T(),kind:this._kind,label:this._label,isolated:this._isolated,enabled:this._enabled,muted:this._muted,readyState:this._readyState,constraints:this._constraints,data:f!==void 0?f:this._data})}stop(){this._readyState!=="ended"&&(this._readyState="ended",this.dispatchEvent({type:"@stop"}))}getConstraints(){return this._constraints}applyConstraints(R){this._readyState!=="ended"&&(this._constraints=R)}remoteStop(){this._readyState!=="ended"&&(this._readyState="ended",this.dispatchEvent({type:"@stop"}),this.dispatchEvent({type:"ended"}))}remoteMute(){this._muted||(this._muted=!0,this.dispatchEvent({type:"mute"}))}remoteUnmute(){this._muted&&(this._muted=!1,this.dispatchEvent({type:"unmute"}))}}return D(c.prototype,"ended"),D(c.prototype,"mute"),D(c.prototype,"unmute"),D(c.prototype,"@enabledchange"),D(c.prototype,"@stop"),D(c.prototype,"isolationchange"),D(c.prototype,"overconstrained"),Wr.FakeMediaStreamTrack=c,Wr}var Di;function oa(){if(Di)return Ht;Di=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.FakeHandler=void 0;const w=aa(),D=Be(),T=J(),c=re(),P=ae(),R=ne(),f=he(),_=new T.Logger("FakeHandler"),C="FakeHandler";class g extends D.EnhancedEventEmitter{constructor({id:u,ordered:v,maxPacketLifeTime:a,maxRetransmits:s,label:e,protocol:r}){super();E(this,"id");E(this,"ordered");E(this,"maxPacketLifeTime");E(this,"maxRetransmits");E(this,"label");E(this,"protocol");this.id=u,this.ordered=v,this.maxPacketLifeTime=a,this.maxRetransmits=s,this.label=e,this.protocol=r}close(){this.safeEmit("close"),this.emit("@close")}send(u){this.safeEmit("message",u)}addEventListener(u,v){this.on(u,v)}}let h=class tn extends f.HandlerInterface{constructor(u){super();E(this,"_closed",!1);E(this,"fakeParameters");E(this,"_rtpParametersByKind");E(this,"_cname",`CNAME-${c.generateRandomNumber()}`);E(this,"_transportReady",!1);E(this,"_nextLocalId",1);E(this,"_tracks",new Map);E(this,"_nextSctpStreamId",0);this.fakeParameters=u}static createFactory(u){return()=>new tn(u)}get name(){return C}close(){_.debug("close()"),!this._closed&&(this._closed=!0)}setIceGatheringState(u){this.emit("@icegatheringstatechange",u)}setConnectionState(u){this.emit("@connectionstatechange",u)}async getNativeRtpCapabilities(){return _.debug("getNativeRtpCapabilities()"),this.fakeParameters.generateNativeRtpCapabilities()}async getNativeSctpCapabilities(){return _.debug("getNativeSctpCapabilities()"),this.fakeParameters.generateNativeSctpCapabilities()}run({direction:u,iceParameters:v,iceCandidates:a,dtlsParameters:s,sctpParameters:e,iceServers:r,iceTransportPolicy:t,proprietaryConstraints:i,extendedRtpCapabilities:o}){this.assertNotClosed(),_.debug("run()"),this._rtpParametersByKind={audio:P.getSendingRtpParameters("audio",o),video:P.getSendingRtpParameters("video",o)}}async updateIceServers(u){this.assertNotClosed(),_.debug("updateIceServers()")}async restartIce(u){this.assertNotClosed(),_.debug("restartIce()")}async getTransportStats(){return this.assertNotClosed(),new Map}async send({track:u,encodings:v,codecOptions:a,codec:s}){this.assertNotClosed(),_.debug("send() [kind:%s, track.id:%s]",u.kind,u.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"});const e=c.clone(this._rtpParametersByKind[u.kind]),r=e.codecs.some(i=>/.+\/rtx$/i.test(i.mimeType));e.mid=`mid-${c.generateRandomNumber()}`,v||(v=[{}]);for(const i of v)i.ssrc=c.generateRandomNumber(),r&&(i.rtx={ssrc:c.generateRandomNumber()});e.encodings=v,e.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const t=this._nextLocalId++;return this._tracks.set(t,u),{localId:String(t),rtpParameters:e}}async stopSending(u){if(_.debug("stopSending() [localId:%s]",u),!this._closed){if(!this._tracks.has(Number(u)))throw new Error("local track not found");this._tracks.delete(Number(u))}}async pauseSending(u){this.assertNotClosed()}async resumeSending(u){this.assertNotClosed()}async replaceTrack(u,v){this.assertNotClosed(),v?_.debug("replaceTrack() [localId:%s, track.id:%s]",u,v.id):_.debug("replaceTrack() [localId:%s, no track]",u),this._tracks.delete(Number(u)),this._tracks.set(Number(u),v)}async setMaxSpatialLayer(u,v){this.assertNotClosed(),_.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",u,v)}async setRtpEncodingParameters(u,v){this.assertNotClosed(),_.debug("setRtpEncodingParameters() [localId:%s, params:%o]",u,v)}async getSenderStats(u){return this.assertNotClosed(),new Map}async sendDataChannel({ordered:u,maxPacketLifeTime:v,maxRetransmits:a,label:s,protocol:e}){this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),_.debug("sendDataChannel()");const r=new g({id:this._nextSctpStreamId++,ordered:u,maxPacketLifeTime:v,maxRetransmits:a,label:s,protocol:e}),t={streamId:this._nextSctpStreamId,ordered:u,maxPacketLifeTime:v,maxRetransmits:a};return{dataChannel:r,sctpStreamParameters:t}}async receive(u){this.assertNotClosed();const v=[];for(const a of u){const{trackId:s,kind:e}=a;this._transportReady||await this.setupTransport({localDtlsRole:"client"}),_.debug("receive() [trackId:%s, kind:%s]",s,e);const r=this._nextLocalId++,t=new w.FakeMediaStreamTrack({kind:e});this._tracks.set(r,t),v.push({localId:String(r),track:t})}return v}async stopReceiving(u){if(!this._closed)for(const v of u)_.debug("stopReceiving() [localId:%s]",v),this._tracks.delete(Number(v))}async pauseReceiving(u){this.assertNotClosed()}async resumeReceiving(u){this.assertNotClosed()}async getReceiverStats(u){return this.assertNotClosed(),new Map}async receiveDataChannel({sctpStreamParameters:u,label:v,protocol:a}){return this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"client"}),_.debug("receiveDataChannel()"),{dataChannel:new g({id:u.streamId,ordered:u.ordered,maxPacketLifeTime:u.maxPacketLifeTime,maxRetransmits:u.maxRetransmits,label:v,protocol:a})}}async setupTransport({localDtlsRole:u,localSdpObject:v}){const a=c.clone(this.fakeParameters.generateLocalDtlsParameters());u&&(a.role=u),this.emit("@connectionstatechange","connecting"),await new Promise((s,e)=>this.emit("@connect",{dtlsParameters:a},s,e)),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new R.InvalidStateError("method called in a closed handler")}};return Ht.FakeHandler=h,Ht}var _e={},Pi;function ca(){if(Pi)return _e;Pi=1,Object.defineProperty(_e,"__esModule",{value:!0}),_e.generateRouterRtpCapabilities=T,_e.generateNativeRtpCapabilities=c,_e.generateNativeSctpCapabilities=P,_e.generateLocalDtlsParameters=R,_e.generateTransportRemoteParameters=f,_e.generateProducerRemoteParameters=_,_e.generateConsumerRemoteParameters=C,_e.generateDataProducerRemoteParameters=g,_e.generateDataConsumerRemoteParameters=h;const w=re();function D(){return String(w.generateRandomNumber())}function T(){return w.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}},{mimeType:"video/H264",kind:"video",preferredPayloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",preferredId:2,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",preferredId:3,preferredEncrypt:!1,direction:"recvonly"},{kind:"audio",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://tools.ietf.org/html/draft-ietf-avtext-framemarking-07",preferredId:6,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:framemarking",preferredId:7,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:11,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:12,preferredEncrypt:!1,direction:"sendrecv"}]})}function c(){return w.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:111,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{minptime:10,useinbandfec:1}},{mimeType:"audio/ISAC",kind:"audio",preferredPayloadType:103,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/CN",kind:"audio",preferredPayloadType:106,clockRate:32e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:96,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:97,clockRate:9e4,rtcpFeedback:[],parameters:{apt:96}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:2},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:3},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:4},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay",preferredId:6},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type",preferredId:7},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing",preferredId:8},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10}]})}function P(){return w.deepFreeze({numStreams:{OS:2048,MIS:2048}})}function R(){return w.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"82:5A:68:3D:36:C3:0A:DE:AF:E7:32:43:D2:88:83:57:AC:2D:65:E5:80:C4:B6:FB:AF:1A:A0:21:9F:6D:0C:AD"}],role:"auto"})}function f(){return{id:D(),iceParameters:w.deepFreeze({iceLite:!0,password:"yku5ej8nvfaor28lvtrabcx0wkrpkztz",usernameFragment:"h3hk1iz6qqlnqlne"}),iceCandidates:w.deepFreeze([{foundation:"udpcandidate",address:"9.9.9.9",ip:"9.9.9.9",port:40533,priority:1078862079,protocol:"udp",type:"host",tcpType:"passive"},{foundation:"udpcandidate",address:"9.9.9.9",ip:"9:9:9:9:9:9",port:41333,priority:1078862089,protocol:"udp",type:"host",tcpType:"passive"}]),dtlsParameters:w.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"A9:F4:E0:D2:74:D3:0F:D9:CA:A5:2F:9F:7F:47:FA:F0:C4:72:DD:73:49:D0:3B:14:90:20:51:30:1B:90:8E:71"},{algorithm:"sha-384",value:"03:D9:0B:87:13:98:F6:6D:BC:FC:92:2E:39:D4:E1:97:32:61:30:56:84:70:81:6E:D1:82:97:EA:D9:C1:21:0F:6B:C5:E7:7F:E1:97:0C:17:97:6E:CF:B3:EF:2E:74:B0"},{algorithm:"sha-512",value:"84:27:A4:28:A4:73:AF:43:02:2A:44:68:FF:2F:29:5C:3B:11:9A:60:F4:A8:F0:F5:AC:A0:E3:49:3E:B1:34:53:A9:85:CE:51:9B:ED:87:5E:B8:F4:8E:3D:FA:20:51:B8:96:EE:DA:56:DC:2F:5C:62:79:15:23:E0:21:82:2B:2C"}],role:"auto"}),sctpParameters:w.deepFreeze({port:5e3,OS:2048,MIS:2048,maxMessageSize:2e6})}}function _(){return w.deepFreeze({id:D()})}function C({id:n,codecMimeType:y}={}){switch(y){case"audio/opus":return{id:n??D(),producerId:D(),kind:"audio",rtpParameters:w.deepFreeze({codecs:[{mimeType:"audio/opus",payloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}}],encodings:[{ssrc:46687003}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",id:10}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"audio/ISAC":return{id:n??D(),producerId:D(),kind:"audio",rtpParameters:w.deepFreeze({codecs:[{mimeType:"audio/ISAC",payloadType:111,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}}],encodings:[{ssrc:46687004}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/VP8":return{id:n??D(),producerId:D(),kind:"video",rtpParameters:w.deepFreeze({codecs:[{mimeType:"video/VP8",payloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",payloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}}],encodings:[{ssrc:99991111,rtx:{ssrc:99991112}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/H264":return{id:n??D(),producerId:D(),kind:"video",rtpParameters:w.deepFreeze({codecs:[{mimeType:"video/H264",payloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",payloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}}],encodings:[{ssrc:99991113,rtx:{ssrc:99991114}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};default:throw new TypeError(`unknown codecMimeType '${y}'`)}}function g(){return w.deepFreeze({id:D()})}function h({id:n}={}){return{id:n??D(),dataProducerId:D(),sctpStreamParameters:w.deepFreeze({streamId:666,maxPacketLifeTime:5e3,maxRetransmits:void 0})}}return _e}var Ei;function da(){return Ei||(Ei=1,function(w){Object.defineProperty(w,"__esModule",{value:!0}),w.debug=w.testFakeParameters=w.FakeHandler=w.ortc=w.parseScalabilityMode=w.detectDevice=w.Device=w.version=w.types=void 0;const D=xi();w.debug=D.default,w.types=Gn(),w.version="3.9.5";var T=Yi();Object.defineProperty(w,"Device",{enumerable:!0,get:function(){return T.Device}}),Object.defineProperty(w,"detectDevice",{enumerable:!0,get:function(){return T.detectDevice}});var c=qe();Object.defineProperty(w,"parseScalabilityMode",{enumerable:!0,get:function(){return c.parse}}),w.ortc=ae();var P=oa();Object.defineProperty(w,"FakeHandler",{enumerable:!0,get:function(){return P.FakeHandler}}),w.testFakeParameters=ca()}(Fr)),Fr}var pa=da();let Pr,sr,ki,Li,Xr,rn,sn,nn;function nr(w,D={}){Pr.send(JSON.stringify({action:w,data:D}))}const an=new URLSearchParams(location.search);rn=an.get("room")||"demo-room";sn=an.get("key")||"demo-key";nn=location.pathname.includes("producer")?"moderator":"viewer";Pr=new WebSocket(`wss://${location.host}`);Pr.onopen=()=>{nr("join",{room:rn,streamKey:sn,role:nn})};Pr.onmessage=async({data:w})=>{const D=JSON.parse(w),{action:T,data:c}=D;if(T==="joined"&&(sr=new pa.Device,await sr.load({routerRtpCapabilities:c.rtpCapabilities}),nr("createTransport",{direction:Xr})),T==="transportCreated"){const{direction:P,...R}=c,f=P==="producer"?sr.createSendTransport(R):sr.createRecvTransport(R);f.on("connect",({dtlsParameters:_},C)=>{nr("connectTransport",{direction:P,dtlsParameters:_}),C()}),P==="producer"?(ki=f,navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(_=>{document.getElementById("preview").srcObject=_;const C=_.getVideoTracks()[0];ki.produce({track:C}).then(({id:g})=>{nr("produce",{kind:"video",rtpParameters:C.getSettings()})})})):(Li=f,nr("consume",{rtpCapabilities:sr.rtpCapabilities}))}if(T==="consumed"){const{kind:P,rtpParameters:R}=c;Li.consume({id:c.id,producerId:c.producerId,kind:P,rtpParameters:R}).then(f=>{const _=new MediaStream;_.addTrack(f.track),document.getElementById("remote").srcObject=_})}T==="error"&&alert(" Error: "+c.message)};window.startProducer=()=>{Xr="producer"};window.startConsumer=()=>{Xr="consumer"};
